{"version":3,"sources":["../src/index.ts","../src/defaults.ts","../src/types.ts","../src/utils.ts","../src/colors.ts","../src/constants.ts","../src/plants/variations.ts","../src/plants/generator.ts","../src/plants/renderers.ts","../src/Renderer.ts","../src/Garden.ts","../src/Color.ts","../src/Vec2.ts","../src/GrowthProgress.ts","../src/SeededRandom.ts","../src/CanvasHelper.ts","../src/EventEmitter.ts","../src/Environment.ts","../src/presets.ts"],"sourcesContent":["// Main class export\nexport { Garten } from './Garden';\n\n// Type exports\nexport type {\n  GardenOptions,\n  GardenController,\n  GardenEvents,\n  PlaybackState,\n  ColorOptions,\n  ColorPalette,\n  Density,\n  PlantData,\n  PlantVariation,\n  TimingCurve,\n  ResolvedOptions,\n  GardenPreset,\n  GardenTheme,\n  PlantRenderContext,\n  FloweringPlantContext,\n  PlantRenderer,\n  GardenEventType,\n  GardenEventData,\n} from './types';\n\nexport { PlantType, PlantCategory } from './types';\n\n// Utility exports (for advanced usage)\nexport { seededRandom, createRandom } from './utils';\nexport { flowerPalettes, foliagePalettes } from './colors';\nexport { PLANT_CATEGORIES, getPlantCategory, getPlantVariation } from './plants';\n\n// New abstractions\nexport { Color, hexToRgb, rgbToHex, lightenColor, darkenColor } from './Color';\nexport { Vec2, MutableVec2, type Point } from './Vec2';\nexport { GrowthProgress, calculateGrowthPhases, isPlantActive, calculateRawProgress } from './GrowthProgress';\nexport { SeededRandom } from './SeededRandom';\nexport { CanvasHelper, drawStem, drawLeaf, drawLeafPair } from './CanvasHelper';\nexport { EventEmitter, SimpleEventEmitter } from './EventEmitter';\nexport { Environment, prefersReducedMotion, getPixelRatio, isBrowser, hasCanvasSupport } from './Environment';\n\n// Presets and themes\nexport {\n  themes,\n  presets,\n  applyTheme,\n  applyPreset,\n  createConfig,\n  getThemeNames,\n  getPresetNames,\n  createTheme,\n  createPreset,\n  densityPreset,\n  speedPreset,\n} from './presets';\n\n// Constants (for advanced customization)\nexport * from './constants';\n\n// Default export for convenience\nexport { Garten as default } from './Garden';\n","import type { GardenOptions, ResolvedOptions, ColorOptions, GardenEvents, Density } from './types';\n\n/**\n * Default color options\n */\nexport const defaultColorOptions: Required<ColorOptions> = {\n  accent: '#F6821F',\n  palette: 'natural',\n  flowerColors: [],\n  foliageColors: [],\n  accentWeight: 0.4,\n};\n\n/**\n * Default event handlers (empty - all properties are optional)\n */\nexport const defaultEvents: GardenEvents = {};\n\n/**\n * Default garden options\n */\nexport const defaultOptions: Omit<ResolvedOptions, 'container'> = {\n  duration: 600,\n  generations: 47,\n  maxHeight: 0.35,\n  colors: defaultColorOptions,\n  density: 'normal',\n  categories: null,\n  loop: false,\n  speed: 1,\n  autoplay: true,\n  respectReducedMotion: true,\n  seed: Math.random() * 100000,\n  maxPixelRatio: 2,\n  targetFPS: 30,\n  timingCurve: 'linear',\n  zIndex: -1,\n  opacity: 1,\n  fadeHeight: 0,\n  fadeColor: '#ffffff',\n  events: defaultEvents,\n};\n\n/**\n * Bounds for numeric options to prevent resource exhaustion\n */\nconst numericBounds = {\n  duration: { min: 1, max: 86400 },        // 1 second to 24 hours\n  generations: { min: 1, max: 1000 },      // Reasonable upper limit\n  maxHeight: { min: 0.05, max: 1 },        // 5% to 100%\n  speed: { min: 0.01, max: 100 },          // Reasonable speed range\n  maxPixelRatio: { min: 0.5, max: 4 },     // Device pixel ratio\n  targetFPS: { min: 1, max: 120 },         // Frame rate\n  opacity: { min: 0, max: 1 },             // CSS opacity\n  fadeHeight: { min: 0, max: 1 },          // Fade zone height\n  zIndex: { min: -9999, max: 9999 },       // CSS z-index\n  seed: { min: 0, max: 1e9 },              // Random seed\n};\n\n/**\n * Clamp a number to bounds\n */\nfunction clampOption(value: number, key: keyof typeof numericBounds): number {\n  const { min, max } = numericBounds[key];\n  return Math.min(max, Math.max(min, value));\n}\n\n/**\n * Plants per generation by density\n */\nexport const plantsPerGeneration: Record<Density, [number, number]> = {\n  sparse: [4, 6],\n  normal: [8, 13],\n  dense: [14, 20],\n  lush: [22, 30],\n};\n\n/**\n * Validate CSS selector format (basic validation for common selectors)\n */\nfunction isValidSelector(selector: string): boolean {\n  // Allow simple ID, class, or tag selectors, and common combinations\n  // This prevents unusual selectors while allowing flexibility\n  return /^[#.]?[\\w-]+(\\s*[>+~]?\\s*[#.]?[\\w-]+)*$/.test(selector);\n}\n\n/**\n * Resolve partial options into complete options\n */\nexport function resolveOptions(options: GardenOptions): ResolvedOptions {\n  // Resolve container with selector validation\n  let container: HTMLElement;\n  if (typeof options.container === 'string') {\n    // Validate selector format to prevent unusual selectors\n    if (!isValidSelector(options.container)) {\n      throw new Error(`Garten: Invalid selector format \"${options.container}\". Use simple selectors like \"#id\" or \".class\".`);\n    }\n    const el = document.querySelector(options.container);\n    if (!el || !(el instanceof HTMLElement)) {\n      throw new Error(`Garten: Container \"${options.container}\" not found`);\n    }\n    container = el;\n  } else {\n    container = options.container;\n  }\n\n  // Merge color options\n  const colors: Required<ColorOptions> = {\n    ...defaultColorOptions,\n    ...options.colors,\n  };\n\n  // Merge events\n  const events: GardenEvents = {\n    ...defaultEvents,\n    ...options.events,\n  };\n\n  // Resolve and clamp numeric options\n  return {\n    container,\n    duration: clampOption(options.duration ?? defaultOptions.duration, 'duration'),\n    generations: clampOption(options.generations ?? defaultOptions.generations, 'generations'),\n    maxHeight: clampOption(options.maxHeight ?? defaultOptions.maxHeight, 'maxHeight'),\n    colors,\n    density: options.density ?? defaultOptions.density,\n    categories: options.categories ?? defaultOptions.categories,\n    loop: options.loop ?? defaultOptions.loop,\n    speed: clampOption(options.speed ?? defaultOptions.speed, 'speed'),\n    autoplay: options.autoplay ?? defaultOptions.autoplay,\n    respectReducedMotion: options.respectReducedMotion ?? defaultOptions.respectReducedMotion,\n    seed: clampOption(\n      Number.isFinite(options.seed) ? options.seed! : defaultOptions.seed,\n      'seed'\n    ),\n    maxPixelRatio: clampOption(options.maxPixelRatio ?? defaultOptions.maxPixelRatio, 'maxPixelRatio'),\n    targetFPS: clampOption(options.targetFPS ?? defaultOptions.targetFPS, 'targetFPS'),\n    timingCurve: options.timingCurve ?? defaultOptions.timingCurve,\n    zIndex: clampOption(options.zIndex ?? defaultOptions.zIndex, 'zIndex'),\n    opacity: clampOption(options.opacity ?? defaultOptions.opacity, 'opacity'),\n    fadeHeight: clampOption(options.fadeHeight ?? defaultOptions.fadeHeight, 'fadeHeight'),\n    fadeColor: options.fadeColor ?? defaultOptions.fadeColor,\n    events,\n  };\n}\n\n","/**\n * Plant category for efficient type grouping\n * Categories determine rendering approach and height ranges\n */\nexport enum PlantCategory {\n  SimpleFlower = 0,\n  Tulip = 1,\n  Daisy = 2,\n  Wildflower = 3,\n  Grass = 4,\n  Fern = 5,\n  Bush = 6,\n  Rose = 7,\n  Lily = 8,\n  Orchid = 9,\n  Succulent = 10,\n  Herb = 11,\n  Specialty = 12,\n  // Tall categories (30-100% height range)\n  TallFlower = 13,\n  GiantGrass = 14,\n  Climber = 15,\n  SmallTree = 16,\n  Tropical = 17,\n  Conifer = 18,\n}\n\n/**\n * Plant variation parameters derived from type\n * Used to create visual differences without separate render functions\n */\nexport interface PlantVariation {\n  sizeMultiplier: number;\n  heightMultiplier: number;\n  petalCountModifier: number;\n  thicknessMultiplier: number;\n  leanMultiplier: number;\n  complexity: number; // 0-1, affects detail level\n}\n\n/**\n * Plant type enumeration - 147 distinct plant types\n * Organized by category for efficient rendering\n */\nexport enum PlantType {\n  // === SIMPLE FLOWERS (0-9) ===\n  SimpleFlower = 'simple-flower',\n  SimpleFlowerSmall = 'simple-flower-small',\n  SimpleFlowerLarge = 'simple-flower-large',\n  SimpleFlowerTall = 'simple-flower-tall',\n  SimpleFlowerShort = 'simple-flower-short',\n  SimpleFlowerWide = 'simple-flower-wide',\n  SimpleFlowerNarrow = 'simple-flower-narrow',\n  SimpleFlowerDouble = 'simple-flower-double',\n  SimpleFlowerClustered = 'simple-flower-clustered',\n  SimpleFlowerSpiral = 'simple-flower-spiral',\n\n  // === TULIPS (10-19) ===\n  Tulip = 'tulip',\n  TulipTall = 'tulip-tall',\n  TulipShort = 'tulip-short',\n  TulipDouble = 'tulip-double',\n  TulipFringed = 'tulip-fringed',\n  TulipParrot = 'tulip-parrot',\n  TulipLily = 'tulip-lily',\n  TulipRembrandt = 'tulip-rembrandt',\n  TulipDarwin = 'tulip-darwin',\n  TulipTriumph = 'tulip-triumph',\n\n  // === DAISIES (20-29) ===\n  Daisy = 'daisy',\n  DaisySmall = 'daisy-small',\n  DaisyLarge = 'daisy-large',\n  DaisyDouble = 'daisy-double',\n  DaisyGerbera = 'daisy-gerbera',\n  DaisyShasta = 'daisy-shasta',\n  DaisyAfrican = 'daisy-african',\n  DaisyOxeye = 'daisy-oxeye',\n  DaisyPainted = 'daisy-painted',\n  DaisyMarguerite = 'daisy-marguerite',\n\n  // === WILDFLOWERS (30-39) ===\n  Wildflower = 'wildflower',\n  WildflowerClustered = 'wildflower-clustered',\n  WildflowerScattered = 'wildflower-scattered',\n  WildflowerTall = 'wildflower-tall',\n  WildflowerMeadow = 'wildflower-meadow',\n  WildflowerPrairie = 'wildflower-prairie',\n  WildflowerAlpine = 'wildflower-alpine',\n  WildflowerWoodland = 'wildflower-woodland',\n  WildflowerCoastal = 'wildflower-coastal',\n  WildflowerDesert = 'wildflower-desert',\n\n  // === GRASSES (40-49) ===\n  Grass = 'grass',\n  GrassTall = 'grass-tall',\n  GrassShort = 'grass-short',\n  GrassWispy = 'grass-wispy',\n  GrassThick = 'grass-thick',\n  GrassPampas = 'grass-pampas',\n  GrassFountain = 'grass-fountain',\n  GrassBlue = 'grass-blue',\n  GrassFeather = 'grass-feather',\n  GrassReed = 'grass-reed',\n\n  // === FERNS (50-59) ===\n  Fern = 'fern',\n  FernSmall = 'fern-small',\n  FernLarge = 'fern-large',\n  FernCurly = 'fern-curly',\n  FernStraight = 'fern-straight',\n  FernMaidenhair = 'fern-maidenhair',\n  FernBoston = 'fern-boston',\n  FernStaghorn = 'fern-staghorn',\n  FernBird = 'fern-bird',\n  FernTree = 'fern-tree',\n\n  // === BUSHES (60-69) ===\n  Bush = 'bush',\n  BushSmall = 'bush-small',\n  BushLarge = 'bush-large',\n  BushFlowering = 'bush-flowering',\n  BushBerry = 'bush-berry',\n  BushRound = 'bush-round',\n  BushSpreading = 'bush-spreading',\n  BushCompact = 'bush-compact',\n  BushWild = 'bush-wild',\n  BushOrnamental = 'bush-ornamental',\n\n  // === ROSES (70-74) ===\n  Rose = 'rose',\n  RoseClimbing = 'rose-climbing',\n  RoseMiniature = 'rose-miniature',\n  RoseWild = 'rose-wild',\n  RoseDouble = 'rose-double',\n\n  // === LILIES (75-79) ===\n  Lily = 'lily',\n  LilyTiger = 'lily-tiger',\n  LilyCalla = 'lily-calla',\n  LilyDaylily = 'lily-daylily',\n  LilyStargazer = 'lily-stargazer',\n\n  // === ORCHIDS (80-84) ===\n  Orchid = 'orchid',\n  OrchidMoth = 'orchid-moth',\n  OrchidDendrobium = 'orchid-dendrobium',\n  OrchidCattleya = 'orchid-cattleya',\n  OrchidVanda = 'orchid-vanda',\n\n  // === SUCCULENTS (85-89) ===\n  Succulent = 'succulent',\n  SucculentRosette = 'succulent-rosette',\n  SucculentSpiky = 'succulent-spiky',\n  SucculentTrailing = 'succulent-trailing',\n  SucculentFlowering = 'succulent-flowering',\n\n  // === HERBS (90-94) ===\n  Lavender = 'lavender',\n  LavenderTall = 'lavender-tall',\n  Sage = 'sage',\n  Thyme = 'thyme',\n  Rosemary = 'rosemary',\n\n  // === SPECIALTY FLOWERS (95-100) ===\n  Poppy = 'poppy',\n  Sunflower = 'sunflower',\n  Iris = 'iris',\n  Peony = 'peony',\n  Hydrangea = 'hydrangea',\n  Dahlia = 'dahlia',\n\n  // === TALL FLOWERS (101-108) - Height: 30-50% ===\n  Hollyhock = 'hollyhock',\n  HollyhockDouble = 'hollyhock-double',\n  Delphinium = 'delphinium',\n  DelphiniumTall = 'delphinium-tall',\n  Foxglove = 'foxglove',\n  FoxgloveTall = 'foxglove-tall',\n  Gladiolus = 'gladiolus',\n  Lupine = 'lupine',\n\n  // === GIANT GRASSES (109-116) - Height: 40-70% ===\n  Bamboo = 'bamboo',\n  BambooTall = 'bamboo-tall',\n  BambooClump = 'bamboo-clump',\n  GiantReed = 'giant-reed',\n  ElephantGrass = 'elephant-grass',\n  Miscanthus = 'miscanthus',\n  MiscanthusTall = 'miscanthus-tall',\n  Cortaderia = 'cortaderia',\n\n  // === CLIMBERS (117-124) - Height: 50-90% ===\n  Vine = 'vine',\n  VineFlowering = 'vine-flowering',\n  VineIvy = 'vine-ivy',\n  Wisteria = 'wisteria',\n  WisteriaCascade = 'wisteria-cascade',\n  Clematis = 'clematis',\n  ClematisLarge = 'clematis-large',\n  MorningGlory = 'morning-glory',\n\n  // === SMALL TREES (125-134) - Height: 60-100% ===\n  Sapling = 'sapling',\n  SaplingOak = 'sapling-oak',\n  SaplingMaple = 'sapling-maple',\n  SaplingBirch = 'sapling-birch',\n  TreeYoung = 'tree-young',\n  TreeOrnamental = 'tree-ornamental',\n  Birch = 'birch',\n  Willow = 'willow',\n  WillowWeeping = 'willow-weeping',\n  CherryBlossom = 'cherry-blossom',\n\n  // === TROPICAL (135-140) - Height: 50-85% ===\n  PalmSmall = 'palm-small',\n  PalmFan = 'palm-fan',\n  BirdOfParadise = 'bird-of-paradise',\n  BirdOfParadiseTall = 'bird-of-paradise-tall',\n  Banana = 'banana',\n  BananaSmall = 'banana-small',\n\n  // === CONIFERS (141-146) - Height: 55-100% ===\n  Pine = 'pine',\n  PineYoung = 'pine-young',\n  Cypress = 'cypress',\n  CypressTall = 'cypress-tall',\n  Juniper = 'juniper',\n  JuniperTall = 'juniper-tall',\n}\n\n/**\n * Color palette presets\n */\nexport type ColorPalette = 'natural' | 'warm' | 'cool' | 'monochrome' | 'vibrant';\n\n/**\n * Timing curve presets for generation pacing\n * - 'linear': Equal time per generation (default)\n * - 'ease-out': Fast start, slow end (early gens grow quickly)\n * - 'ease-in': Slow start, fast end\n * - 'ease-in-out': Slow-fast-slow\n * - number: Custom exponent (>1 = ease-out effect, <1 = ease-in effect)\n */\nexport type TimingCurve = 'linear' | 'ease-out' | 'ease-in' | 'ease-in-out' | number;\n\n/**\n * Animation density options\n */\nexport type Density = 'sparse' | 'normal' | 'dense' | 'lush';\n\n/**\n * Playback state\n */\nexport type PlaybackState = 'idle' | 'playing' | 'paused' | 'complete';\n\n/**\n * Color configuration options\n */\nexport interface ColorOptions {\n  /**\n   * Primary accent color (hex string)\n   * @default '#F6821F' (Cloudflare orange)\n   */\n  accent?: string;\n\n  /**\n   * Color palette preset\n   * @default 'natural'\n   */\n  palette?: ColorPalette;\n\n  /**\n   * Custom flower colors (overrides palette)\n   */\n  flowerColors?: string[];\n\n  /**\n   * Custom leaf/stem colors (overrides palette)\n   */\n  foliageColors?: string[];\n\n  /**\n   * How much to favor the accent color (0-1)\n   * @default 0.4\n   */\n  accentWeight?: number;\n}\n\n/**\n * Event callbacks\n */\nexport interface GardenEvents {\n  /**\n   * Called when a generation completes\n   */\n  onGenerationComplete?: (generation: number, totalGenerations: number) => void;\n\n  /**\n   * Called when all generations have bloomed\n   */\n  onComplete?: () => void;\n\n  /**\n   * Called when playback state changes\n   */\n  onStateChange?: (state: PlaybackState) => void;\n\n  /**\n   * Called on each animation frame with current progress\n   */\n  onProgress?: (progress: number, elapsedTime: number) => void;\n}\n\n/**\n * Main configuration options for Garten\n */\nexport interface GardenOptions {\n  /**\n   * Container element or CSS selector\n   */\n  container: string | HTMLElement;\n\n  /**\n   * Total animation duration in seconds\n   * @default 600 (10 minutes)\n   */\n  duration?: number;\n\n  /**\n   * Number of growth generations\n   * @default 47\n   */\n  generations?: number;\n\n  /**\n   * Maximum height as fraction of container (0-1)\n   * Also controls which plant categories appear:\n   * - 0.35 (default): Ground plants only (grass, flowers, bushes)\n   * - 0.5+: Adds tall flowers and giant grasses\n   * - 0.7+: Adds climbers and tropical plants\n   * - 1.0: Full garden with trees and conifers\n   * @default 0.35\n   */\n  maxHeight?: number;\n\n  /**\n   * Color configuration\n   */\n  colors?: ColorOptions;\n\n  /**\n   * Plant density\n   * @default 'normal'\n   */\n  density?: Density;\n\n  /**\n   * Plant categories to include\n   * If specified, only these categories will appear in the garden.\n   * Use PLANT_CATEGORIES constant for available category names.\n   * @example ['rose', 'tulip', 'grass'] // Only roses, tulips, and grass\n   * @example ['small-tree', 'conifer', 'climber'] // Only tall plants\n   * @default undefined (all categories)\n   */\n  categories?: string[];\n\n  /**\n   * Whether to loop the animation\n   * @default false\n   */\n  loop?: boolean;\n\n  /**\n   * Initial playback speed multiplier\n   * @default 1\n   */\n  speed?: number;\n\n  /**\n   * Whether to start playing automatically\n   * @default true\n   */\n  autoplay?: boolean;\n\n  /**\n   * Whether to respect prefers-reduced-motion\n   * @default true\n   */\n  respectReducedMotion?: boolean;\n\n  /**\n   * Random seed for deterministic generation\n   * @default undefined (random)\n   */\n  seed?: number;\n\n  /**\n   * Device pixel ratio limit (for performance)\n   * @default 2\n   */\n  maxPixelRatio?: number;\n\n  /**\n   * Target frames per second\n   * @default 30\n   */\n  targetFPS?: number;\n\n  /**\n   * Timing curve for generation pacing\n   * Controls how time is distributed across generations\n   * - 'linear': Equal time per generation (default)\n   * - 'ease-out': Fast start, slow end (early gens complete quickly)\n   * - 'ease-in': Slow start, fast end\n   * - 'ease-in-out': Slow-fast-slow\n   * - number: Custom exponent (>1 = ease-out, <1 = ease-in)\n   * @default 'linear'\n   */\n  timingCurve?: TimingCurve;\n\n  /**\n   * CSS z-index for the canvas element\n   * Use negative values to place behind content\n   * @default -1\n   */\n  zIndex?: number;\n\n  /**\n   * Global opacity for all plants (0-1)\n   * @default 1\n   */\n  opacity?: number;\n\n  /**\n   * Height of fade-out zone as fraction of container (0-1)\n   * Plants will fade to transparent over this distance from their max height\n   * Set to 0 to disable fading\n   * @default 0\n   */\n  fadeHeight?: number;\n\n  /**\n   * Color to fade into (should match page background)\n   * Only used when fadeHeight > 0\n   * @default '#ffffff'\n   */\n  fadeColor?: string;\n\n  /**\n   * Event callbacks\n   */\n  events?: GardenEvents;\n}\n\n/**\n * Internal plant data structure\n */\nexport interface PlantData {\n  id: number;\n  type: PlantType;\n  x: number;\n  maxHeight: number;\n  flowerColor: string;\n  stemColor: string;\n  leafColor: string;\n  delay: number;\n  growDuration: number;\n  seed: number;\n  petals: number;\n  lean: number;\n  scale: number;\n  generation: number;\n  /** Cached category for O(1) lookup during rendering */\n  category?: PlantCategory;\n  /** Cached variation for O(1) lookup during rendering */\n  variation?: PlantVariation;\n}\n\n/**\n * Resolved/normalized options (all required)\n */\nexport interface ResolvedOptions {\n  container: HTMLElement;\n  duration: number;\n  generations: number;\n  maxHeight: number;\n  colors: Required<ColorOptions>;\n  density: Density;\n  categories: string[] | null;\n  loop: boolean;\n  speed: number;\n  autoplay: boolean;\n  respectReducedMotion: boolean;\n  seed: number;\n  maxPixelRatio: number;\n  targetFPS: number;\n  timingCurve: TimingCurve;\n  zIndex: number;\n  opacity: number;\n  fadeHeight: number;\n  fadeColor: string;\n  events: GardenEvents;\n}\n\n/**\n * Public API for controlling the garden\n */\nexport interface GardenController {\n  /** Start or resume playback */\n  play(): void;\n\n  /** Pause playback */\n  pause(): void;\n\n  /** Stop and reset to beginning */\n  stop(): void;\n\n  /** Jump to specific time in seconds */\n  seek(time: number): void;\n\n  /** Set playback speed multiplier */\n  setSpeed(speed: number): void;\n\n  /** Get current playback state */\n  getState(): PlaybackState;\n\n  /** Get current progress (0-1) */\n  getProgress(): number;\n\n  /** Get elapsed time in seconds */\n  getElapsedTime(): number;\n\n  /** Update options (triggers regeneration if needed) */\n  setOptions(options: Partial<GardenOptions>): void;\n\n  /** Force regenerate all plants */\n  regenerate(): void;\n\n  /** Clean up and remove from DOM */\n  destroy(): void;\n}\n\n// ==================== RENDERER TYPES ====================\n\n/**\n * Render context passed to plant renderers\n */\nexport interface PlantRenderContext {\n  /** Canvas 2D rendering context */\n  ctx: CanvasRenderingContext2D;\n  /** Canvas width in pixels */\n  width: number;\n  /** Canvas height in pixels */\n  height: number;\n  /** Current animation time in seconds */\n  time: number;\n}\n\n/**\n * Flowering plant render context with pre-calculated values\n */\nexport interface FloweringPlantContext {\n  /** X position on canvas */\n  x: number;\n  /** Base Y position (canvas bottom) */\n  baseY: number;\n  /** Calculated plant height in pixels */\n  plantHeight: number;\n  /** Growth phases for this plant */\n  phases: {\n    progress: number;\n    stem: number;\n    leaf: number;\n    flower: number;\n  };\n}\n\n/**\n * Plant renderer function signature\n */\nexport type PlantRenderer = (\n  ctx: CanvasRenderingContext2D,\n  plant: PlantData,\n  width: number,\n  height: number,\n  time: number,\n  variation: PlantVariation\n) => void;\n\n/**\n * Category-based renderer registry type\n */\nexport type CategoryRenderers = Record<PlantCategory, PlantRenderer>;\n\n// ==================== EVENT EMITTER TYPES ====================\n\n/**\n * Event types for the garden\n */\nexport type GardenEventType =\n  | 'play'\n  | 'pause'\n  | 'stop'\n  | 'complete'\n  | 'progress'\n  | 'generationComplete'\n  | 'stateChange'\n  | 'regenerate'\n  | 'optionsChange';\n\n/**\n * Event handler type\n */\nexport type GardenEventHandler<T = unknown> = (data: T) => void;\n\n/**\n * Event data for different event types\n */\nexport interface GardenEventData {\n  play: void;\n  pause: void;\n  stop: void;\n  complete: void;\n  progress: { progress: number; elapsedTime: number };\n  generationComplete: { generation: number; totalGenerations: number };\n  stateChange: { state: PlaybackState };\n  regenerate: void;\n  optionsChange: { options: Partial<GardenOptions> };\n}\n\n// ==================== THEME/PRESET TYPES ====================\n\n/**\n * Garden preset configuration\n */\nexport interface GardenPreset {\n  /** Preset name */\n  name: string;\n  /** Description of the preset */\n  description?: string;\n  /** Partial options to apply */\n  options: Partial<GardenOptions>;\n}\n\n/**\n * Theme configuration for visual styling\n */\nexport interface GardenTheme {\n  /** Theme name */\n  name: string;\n  /** Color palette */\n  palette: ColorPalette;\n  /** Accent color */\n  accent?: string;\n  /** Custom flower colors */\n  flowerColors?: string[];\n  /** Custom foliage colors */\n  foliageColors?: string[];\n  /** Background/fade color */\n  fadeColor?: string;\n}\n","import type { TimingCurve } from './types';\n\n/**\n * Seeded pseudo-random number generator\n * Returns a value between 0 and 1\n */\nexport function seededRandom(seed: number): number {\n  const x = Math.sin(seed * 9999) * 10000;\n  return x - Math.floor(x);\n}\n\n/**\n * Create a seeded random function that auto-increments\n */\nexport function createRandom(initialSeed: number): () => number {\n  let seed = initialSeed;\n  return () => seededRandom(seed++);\n}\n\n/**\n * Linear interpolation\n */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/**\n * Clamp a value between min and max\n */\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.min(max, Math.max(min, value));\n}\n\n/**\n * Parse hex color to RGB components\n */\nexport function hexToRgb(hex: string): { r: number; g: number; b: number } | null {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result\n    ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16),\n      }\n    : null;\n}\n\n/**\n * Convert RGB to hex\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  return '#' + [r, g, b].map((x) => Math.round(x).toString(16).padStart(2, '0')).join('');\n}\n\n/**\n * Lighten a hex color\n */\nexport function lightenColor(hex: string, amount: number): string {\n  const rgb = hexToRgb(hex);\n  if (!rgb) return hex;\n\n  return rgbToHex(\n    Math.min(255, rgb.r + (255 - rgb.r) * amount),\n    Math.min(255, rgb.g + (255 - rgb.g) * amount),\n    Math.min(255, rgb.b + (255 - rgb.b) * amount)\n  );\n}\n\n/**\n * Darken a hex color\n */\nexport function darkenColor(hex: string, amount: number): string {\n  const rgb = hexToRgb(hex);\n  if (!rgb) return hex;\n\n  return rgbToHex(rgb.r * (1 - amount), rgb.g * (1 - amount), rgb.b * (1 - amount));\n}\n\n/**\n * Pick a random item from an array using seeded random\n */\nexport function pickRandom<T>(array: T[], rand: () => number): T {\n  return array[Math.floor(rand() * array.length)];\n}\n\n/**\n * Pick a random number in range using seeded random\n */\nexport function randomRange(min: number, max: number, rand: () => number): number {\n  return min + rand() * (max - min);\n}\n\n/**\n * Check if prefers-reduced-motion is enabled\n */\nexport function prefersReducedMotion(): boolean {\n  if (typeof window === 'undefined') return false;\n  return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n}\n\n/**\n * Get device pixel ratio, clamped to max\n */\nexport function getPixelRatio(max: number): number {\n  if (typeof window === 'undefined') return 1;\n  return Math.min(window.devicePixelRatio || 1, max);\n}\n\n/**\n * Debounce a function, returns object with cancel method\n */\nexport interface DebouncedFunction<T extends (...args: unknown[]) => void> {\n  (...args: Parameters<T>): void;\n  cancel: () => void;\n}\n\nexport function debounce<T extends (...args: unknown[]) => void>(\n  fn: T,\n  delay: number\n): DebouncedFunction<T> {\n  let timeoutId: ReturnType<typeof setTimeout> | undefined;\n\n  const debounced = (...args: Parameters<T>) => {\n    if (timeoutId !== undefined) clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => fn(...args), delay);\n  };\n\n  debounced.cancel = () => {\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId);\n      timeoutId = undefined;\n    }\n  };\n\n  return debounced as DebouncedFunction<T>;\n}\n\n/**\n * Convert timing curve preset to exponent value\n */\nexport function getTimingExponent(curve: TimingCurve): number {\n  if (typeof curve === 'number') {\n    return Math.max(0.1, curve); // Clamp to prevent division issues\n  }\n  switch (curve) {\n    case 'ease-out': return 2.0;\n    case 'ease-in': return 0.5;\n    case 'ease-in-out': return 1.0; // Special case handled separately\n    case 'linear':\n    default: return 1.0;\n  }\n}\n\n/**\n * Apply timing curve to normalize a generation's position in time\n * Returns the warped time position (0-1) for a given generation\n */\nexport function applyTimingCurve(\n  generation: number,\n  totalGenerations: number,\n  curve: TimingCurve\n): number {\n  const normalizedGen = generation / totalGenerations;\n\n  if (curve === 'linear' || curve === 1) {\n    return normalizedGen;\n  }\n\n  if (curve === 'ease-in-out') {\n    // Smooth S-curve using smoothstep formula\n    const t = normalizedGen;\n    return t * t * (3 - 2 * t);\n  }\n\n  const exponent = getTimingExponent(curve);\n\n  if (exponent > 1) {\n    // Ease-out: fast start, slow end\n    return 1 - Math.pow(1 - normalizedGen, exponent);\n  } else {\n    // Ease-in: slow start, fast end\n    return Math.pow(normalizedGen, 1 / exponent);\n  }\n}\n","import type { ColorPalette, ColorOptions } from './types';\nimport { lightenColor, darkenColor } from './utils';\n\n/**\n * Flower color palettes by theme\n */\nexport const flowerPalettes: Record<ColorPalette, string[]> = {\n  natural: [\n    // Reds/pinks\n    '#E85D75', '#D64550', '#F4A4B0', '#C71585',\n    // Yellows\n    '#F4D03F', '#FFDB58', '#FFE135', '#DAA520',\n    // Purples/blues\n    '#9B72AA', '#7B68EE', '#6A5ACD', '#8A2BE2',\n    // Whites/creams\n    '#FFFEF0', '#FFF8DC', '#FFEFD5', '#FAF0E6',\n  ],\n  warm: [\n    '#FF6B6B', '#FFA07A', '#FFD93D', '#FF8C42',\n    '#E85D75', '#F4A4B0', '#FFDB58', '#FFE135',\n    '#FFF8DC', '#FFEFD5',\n  ],\n  cool: [\n    '#7B68EE', '#6A5ACD', '#9B72AA', '#8A2BE2',\n    '#87CEEB', '#B0E0E6', '#ADD8E6', '#E6E6FA',\n    '#FFFEF0', '#F0F8FF',\n  ],\n  monochrome: [\n    '#FFFFFF', '#F5F5F5', '#E8E8E8', '#DCDCDC',\n    '#D3D3D3', '#C0C0C0', '#A9A9A9', '#989898',\n  ],\n  vibrant: [\n    '#FF1493', '#FF4500', '#FFD700', '#32CD32',\n    '#00CED1', '#1E90FF', '#9400D3', '#FF69B4',\n    '#FFA500', '#ADFF2F',\n  ],\n};\n\n/**\n * Foliage (leaf/stem) color palettes\n */\nexport const foliagePalettes: Record<ColorPalette, { leaves: string[]; stems: string[] }> = {\n  natural: {\n    leaves: ['#228B22', '#2E8B57', '#3CB371', '#6B8E23', '#556B2F', '#8FBC8F'],\n    stems: ['#2D5A27', '#3D6B37', '#4A7C40', '#5D8A52'],\n  },\n  warm: {\n    leaves: ['#6B8E23', '#808000', '#9ACD32', '#7CFC00', '#556B2F'],\n    stems: ['#5D5A27', '#6D6B37', '#5A6C40', '#7D8A52'],\n  },\n  cool: {\n    leaves: ['#2E8B57', '#20B2AA', '#3CB371', '#00FA9A', '#66CDAA'],\n    stems: ['#2D5A47', '#3D6B57', '#4A7C60', '#5D8A72'],\n  },\n  monochrome: {\n    leaves: ['#696969', '#808080', '#A9A9A9', '#778899', '#708090'],\n    stems: ['#4D4D4D', '#5D5D5D', '#6A6A6A', '#7D7D7D'],\n  },\n  vibrant: {\n    leaves: ['#00FF00', '#32CD32', '#00FA9A', '#7FFF00', '#ADFF2F'],\n    stems: ['#228B22', '#008000', '#006400', '#2E8B57'],\n  },\n};\n\n/**\n * Generate accent color variants\n */\nexport function generateAccentVariants(accent: string): string[] {\n  return [\n    accent,\n    lightenColor(accent, 0.15),\n    darkenColor(accent, 0.15),\n    lightenColor(accent, 0.3),\n    darkenColor(accent, 0.08),\n  ];\n}\n\n/**\n * Build flower color array with accent weighting\n */\nexport function buildFlowerColors(options: Required<ColorOptions>): string[] {\n  // Use custom colors if provided\n  if (options.flowerColors.length > 0) {\n    return options.flowerColors;\n  }\n\n  const baseColors = flowerPalettes[options.palette];\n  const accentVariants = generateAccentVariants(options.accent);\n\n  // Calculate how many accent colors to include based on weight\n  const totalColors = baseColors.length + accentVariants.length;\n  const accentCount = Math.round(totalColors * options.accentWeight);\n  const baseCount = totalColors - accentCount;\n\n  // Build weighted array\n  const result: string[] = [];\n\n  // Add accent colors (repeated based on weight)\n  for (let i = 0; i < accentCount; i++) {\n    result.push(accentVariants[i % accentVariants.length]);\n  }\n\n  // Add base palette colors\n  for (let i = 0; i < baseCount; i++) {\n    result.push(baseColors[i % baseColors.length]);\n  }\n\n  return result;\n}\n\n/**\n * Build foliage colors\n */\nexport function buildFoliageColors(\n  options: Required<ColorOptions>\n): { leaves: string[]; stems: string[] } {\n  if (options.foliageColors.length > 0) {\n    // Use custom colors for both\n    return {\n      leaves: options.foliageColors,\n      stems: options.foliageColors.map((c) => darkenColor(c, 0.2)),\n    };\n  }\n\n  return foliagePalettes[options.palette];\n}\n","/**\n * Constants file - Centralized magic numbers, colors, and configuration values\n * Improves maintainability and provides clear documentation for values\n */\n\n// ==================== SIZE CONSTANTS ====================\n\n/**\n * Plant size constants for rendering\n */\nexport const PLANT_SIZES = {\n  /** Base stem thickness for standard flowers */\n  STEM_THICKNESS_BASE: 2,\n  /** Thick stem for tulips, roses */\n  STEM_THICKNESS_THICK: 2.5,\n  /** Thin stem for daisies, orchids */\n  STEM_THICKNESS_THIN: 1.5,\n  /** Tree trunk base width */\n  TRUNK_WIDTH_BASE: 6,\n  /** Conifer trunk width */\n  TRUNK_WIDTH_CONIFER: 4,\n\n  /** Base flower size for simple flowers */\n  FLOWER_SIZE_SIMPLE: 18,\n  /** Sunflower size */\n  FLOWER_SIZE_SUNFLOWER: 25,\n  /** Dahlia size */\n  FLOWER_SIZE_DAHLIA: 24,\n  /** Rose size */\n  FLOWER_SIZE_ROSE: 20,\n  /** Lily size */\n  FLOWER_SIZE_LILY: 22,\n  /** Tulip size */\n  FLOWER_SIZE_TULIP: 22,\n  /** Daisy size */\n  FLOWER_SIZE_DAISY: 16,\n  /** Wildflower size */\n  FLOWER_SIZE_WILDFLOWER: 14,\n  /** Orchid size */\n  FLOWER_SIZE_ORCHID: 18,\n  /** Peony size */\n  FLOWER_SIZE_PEONY: 22,\n  /** Iris size */\n  FLOWER_SIZE_IRIS: 20,\n  /** Hydrangea size */\n  FLOWER_SIZE_HYDRANGEA: 28,\n  /** Poppy size */\n  FLOWER_SIZE_POPPY: 18,\n\n  /** Base leaf size */\n  LEAF_SIZE_BASE: 15,\n  /** Large leaf for roses, lilies */\n  LEAF_SIZE_LARGE: 20,\n  /** Small leaf size */\n  LEAF_SIZE_SMALL: 12,\n  /** Tropical leaf size */\n  LEAF_SIZE_TROPICAL: 30,\n\n  /** Foliage cluster radius for trees */\n  FOLIAGE_RADIUS_BASE: 25,\n} as const;\n\n// ==================== GROWTH PHASE CONSTANTS ====================\n\n/**\n * Growth timing thresholds for plant animation phases\n */\nexport const GROWTH_PHASES = {\n  /** Stem growth multiplier for faster stem growth */\n  STEM_GROWTH_RATE: 1.5,\n  /** When leaf growth starts (as fraction of total progress) */\n  LEAF_START: 0.3,\n  /** Leaf growth rate multiplier */\n  LEAF_GROWTH_RATE: 2,\n  /** When flower growth starts (as fraction of total progress) */\n  FLOWER_START: 0.5,\n  /** Flower growth rate multiplier */\n  FLOWER_GROWTH_RATE: 2,\n  /** When tree foliage starts */\n  FOLIAGE_START: 0.4,\n  /** Foliage growth rate multiplier */\n  FOLIAGE_GROWTH_RATE: 1.7,\n  /** When pampas grass plumes appear */\n  PLUME_START: 0.8,\n  /** Flowering bush flower threshold */\n  BUSH_FLOWER_START: 0.7,\n  /** Complex bush flower threshold */\n  BUSH_FLOWER_START_COMPLEX: 0.5,\n  /** Lavender spike appearance */\n  LAVENDER_SPIKE_START: 0.5,\n  /** Palm frond appearance */\n  PALM_FROND_START: 0.3,\n  /** Conifer foliage appearance */\n  CONIFER_FOLIAGE_START: 0.2,\n} as const;\n\n// ==================== COLOR CONSTANTS ====================\n\n/**\n * Standard colors used across renderers\n */\nexport const COLORS = {\n  /** Default flower center color */\n  FLOWER_CENTER_GOLD: '#FFD700',\n  /** Dark flower center (poppy) */\n  FLOWER_CENTER_DARK: '#2D2D2D',\n  /** Sunflower center disc */\n  SUNFLOWER_CENTER: '#4A3728',\n  /** Sunflower inner center */\n  SUNFLOWER_CENTER_INNER: '#3D2D20',\n  /** Lily stamens */\n  LILY_STAMENS: '#8B4513',\n  /** Dahlia center */\n  DAHLIA_CENTER: '#DAA520',\n  /** Pampas grass plume */\n  GRASS_PLUME: '#F5F5DC',\n  /** Lavender stem */\n  LAVENDER_STEM: '#4A7C40',\n  /** Tulip stripe highlight */\n  TULIP_STRIPE: '#FFFFFF',\n  /** Ground indicator */\n  GROUND_COLOR: 'rgba(139, 119, 101, 0.08)',\n  /** Canvas background */\n  CANVAS_BACKGROUND: '#ffffff',\n  /** Default accent color (Cloudflare orange) */\n  DEFAULT_ACCENT: '#F6821F',\n  /** Default fade color */\n  DEFAULT_FADE_COLOR: '#ffffff',\n} as const;\n\n// ==================== ANIMATION CONSTANTS ====================\n\n/**\n * Animation timing and rendering constants\n */\nexport const ANIMATION = {\n  /** Default animation duration in seconds */\n  DEFAULT_DURATION: 600,\n  /** Default number of generations */\n  DEFAULT_GENERATIONS: 47,\n  /** Default target FPS */\n  DEFAULT_TARGET_FPS: 30,\n  /** Default device pixel ratio limit */\n  DEFAULT_MAX_PIXEL_RATIO: 2,\n  /** Debounce delay for resize handler in ms */\n  RESIZE_DEBOUNCE_MS: 100,\n  /** Ground indicator height in pixels */\n  GROUND_HEIGHT: 8,\n} as const;\n\n// ==================== PLANT LAYOUT CONSTANTS ====================\n\n/**\n * Plant layout and positioning constants\n */\nexport const LAYOUT = {\n  /** Default max height as fraction of container */\n  DEFAULT_MAX_HEIGHT: 0.35,\n  /** Threshold for tall plant boost activation */\n  TALL_PLANT_HEIGHT_THRESHOLD: 0.5,\n  /** Threshold for tall garden detection */\n  TALL_GARDEN_THRESHOLD: 0.35,\n  /** Height bias factor for tall gardens */\n  HEIGHT_BIAS_FACTOR: 0.5,\n  /** Tree trunk height as fraction of total */\n  TREE_TRUNK_RATIO: 0.6,\n  /** Conifer trunk height as fraction of total */\n  CONIFER_TRUNK_RATIO: 0.95,\n  /** Tropical trunk ratio */\n  TROPICAL_TRUNK_RATIO: 0.5,\n  /** Tall flower stem ratio */\n  TALL_FLOWER_STEM_RATIO: 1.0,\n} as const;\n\n// ==================== PETAL COUNT DEFAULTS ====================\n\n/**\n * Default petal counts for various flower types\n */\nexport const PETAL_COUNTS = {\n  /** Simple flower base petals */\n  SIMPLE_FLOWER: 5,\n  /** Daisy petals (minimum) */\n  DAISY_MIN: 8,\n  /** Daisy base petals */\n  DAISY_BASE: 12,\n  /** Sunflower ray petals */\n  SUNFLOWER: 16,\n  /** Rose petal layers */\n  ROSE_LAYERS: 3,\n  /** Complex rose petal layers */\n  ROSE_LAYERS_COMPLEX: 4,\n  /** Peony layers */\n  PEONY_LAYERS: 5,\n  /** Dahlia layers */\n  DAHLIA_LAYERS: 4,\n  /** Hydrangea floret count base */\n  HYDRANGEA_FLORETS: 20,\n  /** Succulent layers base */\n  SUCCULENT_LAYERS: 3,\n  /** Complex succulent layers */\n  SUCCULENT_LAYERS_COMPLEX: 4,\n  /** Succulent leaves per layer */\n  SUCCULENT_LEAVES: 6,\n  /** Poppy petals */\n  POPPY: 4,\n  /** Iris standards (upright petals) */\n  IRIS_STANDARDS: 3,\n  /** Orchid outer petals (sepals) */\n  ORCHID_SEPALS: 3,\n  /** Orchid side petals */\n  ORCHID_SIDE_PETALS: 2,\n  /** Lavender buds per spike */\n  LAVENDER_BUDS: 8,\n} as const;\n\n// ==================== VARIATION DEFAULTS ====================\n\n/**\n * Default variation parameters\n */\nexport const VARIATION_DEFAULTS = {\n  SIZE_MULTIPLIER: 1.0,\n  HEIGHT_MULTIPLIER: 1.0,\n  PETAL_COUNT_MODIFIER: 0,\n  THICKNESS_MULTIPLIER: 1.0,\n  LEAN_MULTIPLIER: 1.0,\n  COMPLEXITY: 0.5,\n} as const;\n\n// ==================== COMPLEXITY THRESHOLDS ====================\n\n/**\n * Complexity thresholds for conditional rendering features\n */\nexport const COMPLEXITY = {\n  /** Threshold for additional flower details */\n  DETAIL_THRESHOLD: 0.6,\n  /** Threshold for tulip stripe effect */\n  TULIP_STRIPE_THRESHOLD: 0.6,\n  /** Threshold for grass plumes */\n  GRASS_PLUME_THRESHOLD: 0.7,\n  /** Threshold for fern curl effect */\n  FERN_CURL_THRESHOLD: 0.7,\n  /** Threshold for flowering bush extra flowers */\n  BUSH_FLOWERING_THRESHOLD: 0.8,\n  /** Threshold for extra rose petal layers */\n  ROSE_COMPLEX_THRESHOLD: 0.8,\n  /** Threshold for climbing vine flowers */\n  VINE_FLOWER_THRESHOLD: 0.6,\n} as const;\n\n// ==================== CANVAS STYLE CONSTANTS ====================\n\n/**\n * Canvas rendering style constants\n */\nexport const CANVAS_STYLE = {\n  /** Line cap style for stems */\n  LINE_CAP: 'round' as CanvasLineCap,\n  /** Alpha for plume effects */\n  PLUME_ALPHA: 0.7,\n  /** Alpha for tulip stripe */\n  TULIP_STRIPE_ALPHA: 0.3,\n} as const;\n\n// ==================== GEOMETRY CONSTANTS ====================\n\n/**\n * Geometry and angle constants\n */\nexport const GEOMETRY = {\n  /** Full circle in radians */\n  TWO_PI: Math.PI * 2,\n  /** Half circle in radians */\n  PI: Math.PI,\n  /** Quarter circle in radians */\n  HALF_PI: Math.PI / 2,\n  /** Common bezier control point ratio */\n  BEZIER_CP_RATIO: 0.7,\n  /** Stem curve control point 1 height ratio */\n  STEM_CP1_HEIGHT: 0.4,\n  /** Stem curve control point 2 height ratio */\n  STEM_CP2_HEIGHT: 0.7,\n  /** Stem lean control point 1 ratio */\n  STEM_CP1_LEAN: 0.3,\n  /** Stem lean control point 2 ratio */\n  STEM_CP2_LEAN: 0.6,\n} as const;\n\n// ==================== NUMERIC BOUNDS ====================\n\n/**\n * Bounds for numeric options to prevent resource exhaustion\n */\nexport const OPTION_BOUNDS = {\n  DURATION: { min: 1, max: 86400 },\n  GENERATIONS: { min: 1, max: 1000 },\n  MAX_HEIGHT: { min: 0.05, max: 1 },\n  SPEED: { min: 0.01, max: 100 },\n  MAX_PIXEL_RATIO: { min: 0.5, max: 4 },\n  TARGET_FPS: { min: 1, max: 120 },\n  OPACITY: { min: 0, max: 1 },\n  FADE_HEIGHT: { min: 0, max: 1 },\n  Z_INDEX: { min: -9999, max: 9999 },\n  SEED: { min: 0, max: 1e9 },\n} as const;\n\n// ==================== DENSITY CONFIGURATION ====================\n\n/**\n * Plants per generation by density level\n */\nexport const PLANTS_PER_GENERATION = {\n  sparse: [4, 6] as const,\n  normal: [8, 13] as const,\n  dense: [14, 20] as const,\n  lush: [22, 30] as const,\n} as const;\n","/**\n * Plant variation parameters and sparse map with defaults\n * Extracted to reduce redundancy and improve maintainability\n */\n\nimport type { PlantVariation } from '../types';\nimport { PlantType } from '../types';\nimport { VARIATION_DEFAULTS } from '../constants';\n\n/**\n * Default variation parameters used as base for all plants\n */\nexport const defaultVariation: PlantVariation = {\n  sizeMultiplier: VARIATION_DEFAULTS.SIZE_MULTIPLIER,\n  heightMultiplier: VARIATION_DEFAULTS.HEIGHT_MULTIPLIER,\n  petalCountModifier: VARIATION_DEFAULTS.PETAL_COUNT_MODIFIER,\n  thicknessMultiplier: VARIATION_DEFAULTS.THICKNESS_MULTIPLIER,\n  leanMultiplier: VARIATION_DEFAULTS.LEAN_MULTIPLIER,\n  complexity: VARIATION_DEFAULTS.COMPLEXITY,\n};\n\n/**\n * Partial variation overrides - only specify fields that differ from defaults\n * This reduces redundancy from defining all 6 fields for each of 147 plant types\n */\ntype PartialVariation = Partial<PlantVariation>;\n\n/**\n * Sparse variation overrides - only plants that differ from defaults need entries\n */\nconst variationOverrides: Map<PlantType, PartialVariation> = new Map([\n  // === SIMPLE FLOWERS ===\n  // SimpleFlower uses all defaults - no entry needed\n  [PlantType.SimpleFlowerSmall, { sizeMultiplier: 0.7, heightMultiplier: 0.8, petalCountModifier: -1, thicknessMultiplier: 0.8, complexity: 0.3 }],\n  [PlantType.SimpleFlowerLarge, { sizeMultiplier: 1.4, heightMultiplier: 1.1, petalCountModifier: 2, thicknessMultiplier: 1.2, leanMultiplier: 0.8, complexity: 0.7 }],\n  [PlantType.SimpleFlowerTall, { sizeMultiplier: 0.9, heightMultiplier: 1.3, thicknessMultiplier: 0.9, leanMultiplier: 0.7 }],\n  [PlantType.SimpleFlowerShort, { sizeMultiplier: 1.1, heightMultiplier: 0.7, petalCountModifier: 1, thicknessMultiplier: 1.1, leanMultiplier: 1.2, complexity: 0.4 }],\n  [PlantType.SimpleFlowerWide, { sizeMultiplier: 1.3, heightMultiplier: 0.9, petalCountModifier: 3, complexity: 0.6 }],\n  [PlantType.SimpleFlowerNarrow, { sizeMultiplier: 0.8, heightMultiplier: 1.1, petalCountModifier: -2, thicknessMultiplier: 0.8, leanMultiplier: 0.9, complexity: 0.4 }],\n  [PlantType.SimpleFlowerDouble, { sizeMultiplier: 1.2, petalCountModifier: 5, thicknessMultiplier: 1.1, leanMultiplier: 0.9, complexity: 0.8 }],\n  [PlantType.SimpleFlowerClustered, { sizeMultiplier: 0.6, heightMultiplier: 0.9, petalCountModifier: -1, thicknessMultiplier: 0.9, leanMultiplier: 1.3, complexity: 0.7 }],\n  [PlantType.SimpleFlowerSpiral, { petalCountModifier: 2, leanMultiplier: 1.5, complexity: 0.9 }],\n\n  // === TULIPS ===\n  [PlantType.Tulip, { leanMultiplier: 0.5 }],\n  [PlantType.TulipTall, { sizeMultiplier: 0.9, heightMultiplier: 1.3, thicknessMultiplier: 0.9, leanMultiplier: 0.4 }],\n  [PlantType.TulipShort, { sizeMultiplier: 1.1, heightMultiplier: 0.7, thicknessMultiplier: 1.1, leanMultiplier: 0.6, complexity: 0.4 }],\n  [PlantType.TulipDouble, { sizeMultiplier: 1.2, petalCountModifier: 3, thicknessMultiplier: 1.1, leanMultiplier: 0.5, complexity: 0.8 }],\n  [PlantType.TulipFringed, { leanMultiplier: 0.5, complexity: 0.9 }],\n  [PlantType.TulipParrot, { sizeMultiplier: 1.3, heightMultiplier: 0.95, petalCountModifier: 2, leanMultiplier: 0.7, complexity: 1.0 }],\n  [PlantType.TulipLily, { sizeMultiplier: 1.1, heightMultiplier: 1.1, thicknessMultiplier: 0.9, leanMultiplier: 0.6, complexity: 0.6 }],\n  [PlantType.TulipRembrandt, { leanMultiplier: 0.5, complexity: 0.7 }],\n  [PlantType.TulipDarwin, { sizeMultiplier: 1.15, heightMultiplier: 1.2, leanMultiplier: 0.4 }],\n  [PlantType.TulipTriumph, { sizeMultiplier: 1.05, heightMultiplier: 1.1, thicknessMultiplier: 1.05, leanMultiplier: 0.5 }],\n\n  // === DAISIES ===\n  // Daisy uses all defaults - no entry needed\n  [PlantType.DaisySmall, { sizeMultiplier: 0.7, heightMultiplier: 0.8, petalCountModifier: -2, thicknessMultiplier: 0.8, complexity: 0.3 }],\n  [PlantType.DaisyLarge, { sizeMultiplier: 1.4, heightMultiplier: 1.1, petalCountModifier: 4, thicknessMultiplier: 1.2, leanMultiplier: 0.8, complexity: 0.7 }],\n  [PlantType.DaisyDouble, { sizeMultiplier: 1.2, petalCountModifier: 8, thicknessMultiplier: 1.1, leanMultiplier: 0.9, complexity: 0.9 }],\n  [PlantType.DaisyGerbera, { sizeMultiplier: 1.5, petalCountModifier: 6, thicknessMultiplier: 1.3, leanMultiplier: 0.7, complexity: 0.8 }],\n  [PlantType.DaisyShasta, { sizeMultiplier: 1.3, heightMultiplier: 1.15, petalCountModifier: 4, thicknessMultiplier: 1.1, leanMultiplier: 0.8, complexity: 0.6 }],\n  [PlantType.DaisyAfrican, { sizeMultiplier: 1.1, heightMultiplier: 0.9, petalCountModifier: 2, complexity: 0.7 }],\n  [PlantType.DaisyOxeye, { sizeMultiplier: 0.9, thicknessMultiplier: 0.9, leanMultiplier: 1.1, complexity: 0.4 }],\n  [PlantType.DaisyPainted, { heightMultiplier: 0.95, petalCountModifier: 2, complexity: 0.8 }],\n  [PlantType.DaisyMarguerite, { sizeMultiplier: 1.1, heightMultiplier: 1.05, petalCountModifier: 3, leanMultiplier: 0.9 }],\n\n  // === WILDFLOWERS ===\n  // Wildflower uses all defaults - no entry needed\n  [PlantType.WildflowerClustered, { sizeMultiplier: 0.8, heightMultiplier: 0.9, petalCountModifier: 2, thicknessMultiplier: 0.9, leanMultiplier: 1.2, complexity: 0.7 }],\n  [PlantType.WildflowerScattered, { sizeMultiplier: 0.7, petalCountModifier: -1, thicknessMultiplier: 0.8, leanMultiplier: 1.5, complexity: 0.6 }],\n  [PlantType.WildflowerTall, { sizeMultiplier: 0.9, heightMultiplier: 1.4, thicknessMultiplier: 0.9, leanMultiplier: 0.8 }],\n  [PlantType.WildflowerMeadow, { sizeMultiplier: 1.1, petalCountModifier: 1, leanMultiplier: 1.3, complexity: 0.6 }],\n  [PlantType.WildflowerPrairie, { heightMultiplier: 1.2, thicknessMultiplier: 1.1 }],\n  [PlantType.WildflowerAlpine, { sizeMultiplier: 0.6, heightMultiplier: 0.7, petalCountModifier: -1, thicknessMultiplier: 0.8, leanMultiplier: 0.8, complexity: 0.4 }],\n  [PlantType.WildflowerWoodland, { sizeMultiplier: 0.9, heightMultiplier: 0.9, petalCountModifier: 1, thicknessMultiplier: 0.9, leanMultiplier: 1.1, complexity: 0.6 }],\n  [PlantType.WildflowerCoastal, { sizeMultiplier: 0.8, heightMultiplier: 0.8, leanMultiplier: 1.4 }],\n  [PlantType.WildflowerDesert, { sizeMultiplier: 0.7, heightMultiplier: 0.6, petalCountModifier: -1, thicknessMultiplier: 1.1, leanMultiplier: 0.9, complexity: 0.4 }],\n\n  // === GRASSES ===\n  [PlantType.Grass, { complexity: 0.3 }],\n  [PlantType.GrassTall, { heightMultiplier: 1.5, petalCountModifier: 1, thicknessMultiplier: 0.9, leanMultiplier: 0.8, complexity: 0.4 }],\n  [PlantType.GrassShort, { heightMultiplier: 0.6, thicknessMultiplier: 1.1, leanMultiplier: 1.2, complexity: 0.2 }],\n  [PlantType.GrassWispy, { sizeMultiplier: 0.8, heightMultiplier: 1.2, petalCountModifier: 2, thicknessMultiplier: 0.6, leanMultiplier: 1.5 }],\n  [PlantType.GrassThick, { sizeMultiplier: 1.2, heightMultiplier: 0.9, petalCountModifier: -1, thicknessMultiplier: 1.5, leanMultiplier: 0.7, complexity: 0.3 }],\n  [PlantType.GrassPampas, { sizeMultiplier: 1.3, heightMultiplier: 1.8, petalCountModifier: 3, thicknessMultiplier: 1.2, complexity: 0.8 }],\n  [PlantType.GrassFountain, { sizeMultiplier: 1.1, heightMultiplier: 1.3, petalCountModifier: 4, thicknessMultiplier: 0.8, leanMultiplier: 1.8, complexity: 0.7 }],\n  [PlantType.GrassBlue, { sizeMultiplier: 0.9, heightMultiplier: 0.8, petalCountModifier: 1, complexity: 0.4 }],\n  [PlantType.GrassFeather, { heightMultiplier: 1.4, petalCountModifier: 2, thicknessMultiplier: 0.7, leanMultiplier: 1.3, complexity: 0.6 }],\n  [PlantType.GrassReed, { sizeMultiplier: 0.9, heightMultiplier: 1.6, thicknessMultiplier: 1.3, leanMultiplier: 0.5, complexity: 0.4 }],\n\n  // === FERNS ===\n  [PlantType.Fern, { complexity: 0.6 }],\n  [PlantType.FernSmall, { sizeMultiplier: 0.6, heightMultiplier: 0.7, petalCountModifier: -2, thicknessMultiplier: 0.8, complexity: 0.4 }],\n  [PlantType.FernLarge, { sizeMultiplier: 1.4, heightMultiplier: 1.3, petalCountModifier: 3, thicknessMultiplier: 1.2, leanMultiplier: 0.8, complexity: 0.8 }],\n  [PlantType.FernCurly, { heightMultiplier: 0.9, petalCountModifier: 1, leanMultiplier: 1.8, complexity: 0.9 }],\n  [PlantType.FernStraight, { sizeMultiplier: 0.9, heightMultiplier: 1.2, leanMultiplier: 0.3, complexity: 0.4 }],\n  [PlantType.FernMaidenhair, { sizeMultiplier: 0.7, heightMultiplier: 0.8, petalCountModifier: 4, thicknessMultiplier: 0.6, leanMultiplier: 1.5, complexity: 0.9 }],\n  [PlantType.FernBoston, { sizeMultiplier: 1.2, petalCountModifier: 2, leanMultiplier: 1.6, complexity: 0.7 }],\n  [PlantType.FernStaghorn, { sizeMultiplier: 1.3, heightMultiplier: 0.9, thicknessMultiplier: 1.3, complexity: 0.8 }],\n  [PlantType.FernBird, { sizeMultiplier: 1.1, heightMultiplier: 1.1, petalCountModifier: -1, thicknessMultiplier: 1.2, leanMultiplier: 0.7 }],\n  [PlantType.FernTree, { sizeMultiplier: 1.5, heightMultiplier: 1.5, petalCountModifier: 4, thicknessMultiplier: 1.4, leanMultiplier: 0.5, complexity: 0.9 }],\n\n  // === BUSHES ===\n  [PlantType.Bush, { complexity: 0.6 }],\n  [PlantType.BushSmall, { sizeMultiplier: 0.6, heightMultiplier: 0.7, petalCountModifier: -2, thicknessMultiplier: 0.9, complexity: 0.4 }],\n  [PlantType.BushLarge, { sizeMultiplier: 1.5, heightMultiplier: 1.3, petalCountModifier: 3, thicknessMultiplier: 1.2, leanMultiplier: 0.8, complexity: 0.8 }],\n  [PlantType.BushFlowering, { sizeMultiplier: 1.1, petalCountModifier: 4, complexity: 0.9 }],\n  [PlantType.BushBerry, { sizeMultiplier: 0.9, heightMultiplier: 0.9, thicknessMultiplier: 1.1, leanMultiplier: 0.9, complexity: 0.7 }],\n  [PlantType.BushRound, { sizeMultiplier: 1.2, heightMultiplier: 0.8, petalCountModifier: 2, thicknessMultiplier: 1.2, leanMultiplier: 0.5 }],\n  [PlantType.BushSpreading, { sizeMultiplier: 1.3, heightMultiplier: 0.7, petalCountModifier: 1, leanMultiplier: 1.5, complexity: 0.6 }],\n  [PlantType.BushCompact, { sizeMultiplier: 0.8, heightMultiplier: 0.8, thicknessMultiplier: 1.3, leanMultiplier: 0.7, complexity: 0.4 }],\n  [PlantType.BushWild, { sizeMultiplier: 1.1, heightMultiplier: 1.1, petalCountModifier: 2, thicknessMultiplier: 0.9, leanMultiplier: 1.4, complexity: 0.8 }],\n  [PlantType.BushOrnamental, { petalCountModifier: 3, leanMultiplier: 0.8, complexity: 0.7 }],\n\n  // === ROSES ===\n  [PlantType.Rose, { leanMultiplier: 0.8, complexity: 0.8 }],\n  [PlantType.RoseClimbing, { sizeMultiplier: 0.9, heightMultiplier: 1.5, thicknessMultiplier: 0.9, leanMultiplier: 1.2, complexity: 0.7 }],\n  [PlantType.RoseMiniature, { sizeMultiplier: 0.5, heightMultiplier: 0.6, petalCountModifier: -2, thicknessMultiplier: 0.7, leanMultiplier: 0.9, complexity: 0.6 }],\n  [PlantType.RoseWild, { sizeMultiplier: 0.8, heightMultiplier: 1.1, petalCountModifier: -3, thicknessMultiplier: 0.8, leanMultiplier: 1.3 }],\n  [PlantType.RoseDouble, { sizeMultiplier: 1.2, petalCountModifier: 8, thicknessMultiplier: 1.1, leanMultiplier: 0.7, complexity: 1.0 }],\n\n  // === LILIES ===\n  [PlantType.Lily, { leanMultiplier: 0.7, complexity: 0.7 }],\n  [PlantType.LilyTiger, { sizeMultiplier: 1.1, heightMultiplier: 1.1, leanMultiplier: 0.8, complexity: 0.9 }],\n  [PlantType.LilyCalla, { sizeMultiplier: 0.9, heightMultiplier: 1.2, petalCountModifier: -4, thicknessMultiplier: 1.1, leanMultiplier: 0.5, complexity: 0.6 }],\n  [PlantType.LilyDaylily, { heightMultiplier: 0.9, thicknessMultiplier: 0.9 }],\n  [PlantType.LilyStargazer, { sizeMultiplier: 1.2, leanMultiplier: 0.6, complexity: 0.8 }],\n\n  // === ORCHIDS ===\n  [PlantType.Orchid, { leanMultiplier: 0.6, complexity: 0.9 }],\n  [PlantType.OrchidMoth, { sizeMultiplier: 1.1, heightMultiplier: 0.9, thicknessMultiplier: 0.9, leanMultiplier: 0.7, complexity: 0.8 }],\n  [PlantType.OrchidDendrobium, { sizeMultiplier: 0.8, heightMultiplier: 1.2, petalCountModifier: 2, thicknessMultiplier: 0.8, leanMultiplier: 0.8, complexity: 0.9 }],\n  [PlantType.OrchidCattleya, { sizeMultiplier: 1.3, heightMultiplier: 0.95, thicknessMultiplier: 1.1, leanMultiplier: 0.5, complexity: 1.0 }],\n  [PlantType.OrchidVanda, { heightMultiplier: 1.1, petalCountModifier: 1, thicknessMultiplier: 0.9, leanMultiplier: 0.7, complexity: 0.85 }],\n\n  // === SUCCULENTS ===\n  [PlantType.Succulent, { thicknessMultiplier: 1.5, leanMultiplier: 0.3 }],\n  [PlantType.SucculentRosette, { sizeMultiplier: 1.1, heightMultiplier: 0.6, petalCountModifier: 3, thicknessMultiplier: 1.4, leanMultiplier: 0.2, complexity: 0.7 }],\n  [PlantType.SucculentSpiky, { sizeMultiplier: 0.9, heightMultiplier: 1.2, petalCountModifier: -2, thicknessMultiplier: 1.6, leanMultiplier: 0.4, complexity: 0.6 }],\n  [PlantType.SucculentTrailing, { sizeMultiplier: 0.7, heightMultiplier: 0.5, petalCountModifier: 2, thicknessMultiplier: 1.3, leanMultiplier: 2.0, complexity: 0.6 }],\n  [PlantType.SucculentFlowering, { heightMultiplier: 0.8, petalCountModifier: 4, thicknessMultiplier: 1.4, leanMultiplier: 0.3, complexity: 0.8 }],\n\n  // === HERBS ===\n  [PlantType.Lavender, { thicknessMultiplier: 0.8, leanMultiplier: 0.8, complexity: 0.7 }],\n  [PlantType.LavenderTall, { sizeMultiplier: 0.9, heightMultiplier: 1.4, petalCountModifier: 2, thicknessMultiplier: 0.7, leanMultiplier: 0.6, complexity: 0.7 }],\n  [PlantType.Sage, { sizeMultiplier: 1.1, heightMultiplier: 0.8, thicknessMultiplier: 1.1, leanMultiplier: 0.9 }],\n  [PlantType.Thyme, { sizeMultiplier: 0.6, heightMultiplier: 0.5, petalCountModifier: -1, thicknessMultiplier: 0.7, leanMultiplier: 1.2, complexity: 0.4 }],\n  [PlantType.Rosemary, { sizeMultiplier: 0.8, heightMultiplier: 1.1, thicknessMultiplier: 0.9, leanMultiplier: 0.7, complexity: 0.6 }],\n\n  // === SPECIALTY ===\n  [PlantType.Poppy, { petalCountModifier: -1, thicknessMultiplier: 0.8, leanMultiplier: 1.2, complexity: 0.6 }],\n  [PlantType.Sunflower, { sizeMultiplier: 1.8, heightMultiplier: 1.6, petalCountModifier: 8, thicknessMultiplier: 1.5, leanMultiplier: 0.4, complexity: 0.7 }],\n  [PlantType.Iris, { sizeMultiplier: 1.1, heightMultiplier: 1.2, leanMultiplier: 0.5, complexity: 0.8 }],\n  [PlantType.Peony, { sizeMultiplier: 1.4, heightMultiplier: 0.9, petalCountModifier: 10, thicknessMultiplier: 1.3, leanMultiplier: 0.6, complexity: 1.0 }],\n  [PlantType.Hydrangea, { sizeMultiplier: 1.5, heightMultiplier: 0.85, petalCountModifier: 15, thicknessMultiplier: 1.4, leanMultiplier: 0.5, complexity: 0.9 }],\n  [PlantType.Dahlia, { sizeMultiplier: 1.3, petalCountModifier: 12, thicknessMultiplier: 1.2, leanMultiplier: 0.6, complexity: 0.95 }],\n\n  // === TALL FLOWERS ===\n  [PlantType.Hollyhock, { thicknessMultiplier: 1.2, leanMultiplier: 0.3, complexity: 0.7 }],\n  [PlantType.HollyhockDouble, { sizeMultiplier: 1.2, heightMultiplier: 1.1, petalCountModifier: 5, thicknessMultiplier: 1.3, leanMultiplier: 0.2, complexity: 0.9 }],\n  [PlantType.Delphinium, { sizeMultiplier: 0.8, heightMultiplier: 1.2, petalCountModifier: 2, leanMultiplier: 0.2, complexity: 0.8 }],\n  [PlantType.DelphiniumTall, { sizeMultiplier: 0.7, heightMultiplier: 1.4, petalCountModifier: 3, thicknessMultiplier: 0.9, leanMultiplier: 0.15, complexity: 0.85 }],\n  [PlantType.Foxglove, { sizeMultiplier: 0.9, heightMultiplier: 1.1, thicknessMultiplier: 1.1, leanMultiplier: 0.25, complexity: 0.75 }],\n  [PlantType.FoxgloveTall, { sizeMultiplier: 0.85, heightMultiplier: 1.3, petalCountModifier: 2, leanMultiplier: 0.2, complexity: 0.8 }],\n  [PlantType.Gladiolus, { sizeMultiplier: 1.1, heightMultiplier: 1.15, petalCountModifier: 1, thicknessMultiplier: 1.2, leanMultiplier: 0.2, complexity: 0.7 }],\n  [PlantType.Lupine, { sizeMultiplier: 0.9, petalCountModifier: 4, leanMultiplier: 0.3, complexity: 0.75 }],\n\n  // === GIANT GRASSES ===\n  [PlantType.Bamboo, { thicknessMultiplier: 0.8, leanMultiplier: 0.15, complexity: 0.6 }],\n  [PlantType.BambooTall, { sizeMultiplier: 0.9, heightMultiplier: 1.3, thicknessMultiplier: 0.7, leanMultiplier: 0.1, complexity: 0.65 }],\n  [PlantType.BambooClump, { sizeMultiplier: 1.2, heightMultiplier: 0.9, petalCountModifier: 3, thicknessMultiplier: 0.9, leanMultiplier: 0.2, complexity: 0.7 }],\n  [PlantType.GiantReed, { sizeMultiplier: 1.1, heightMultiplier: 1.1, leanMultiplier: 0.25 }],\n  [PlantType.ElephantGrass, { sizeMultiplier: 1.3, heightMultiplier: 1.2, petalCountModifier: 2, thicknessMultiplier: 1.2, leanMultiplier: 0.3, complexity: 0.55 }],\n  [PlantType.Miscanthus, { petalCountModifier: 1, thicknessMultiplier: 0.9, leanMultiplier: 0.35, complexity: 0.6 }],\n  [PlantType.MiscanthusTall, { sizeMultiplier: 0.95, heightMultiplier: 1.25, petalCountModifier: 2, thicknessMultiplier: 0.85, leanMultiplier: 0.3, complexity: 0.65 }],\n  [PlantType.Cortaderia, { sizeMultiplier: 1.4, heightMultiplier: 1.15, petalCountModifier: 3, thicknessMultiplier: 1.1, leanMultiplier: 0.4, complexity: 0.7 }],\n\n  // === CLIMBERS ===\n  [PlantType.Vine, { thicknessMultiplier: 0.6, leanMultiplier: 0.8, complexity: 0.6 }],\n  [PlantType.VineFlowering, { sizeMultiplier: 1.2, petalCountModifier: 3, thicknessMultiplier: 0.7, leanMultiplier: 0.7, complexity: 0.75 }],\n  [PlantType.VineIvy, { sizeMultiplier: 0.8, heightMultiplier: 1.1, thicknessMultiplier: 0.5, leanMultiplier: 0.9, complexity: 0.7 }],\n  [PlantType.Wisteria, { sizeMultiplier: 1.3, heightMultiplier: 1.15, petalCountModifier: 5, thicknessMultiplier: 0.8, leanMultiplier: 0.6, complexity: 0.85 }],\n  [PlantType.WisteriaCascade, { sizeMultiplier: 1.4, heightMultiplier: 1.25, petalCountModifier: 8, thicknessMultiplier: 0.9, leanMultiplier: 0.5, complexity: 0.9 }],\n  [PlantType.Clematis, { sizeMultiplier: 1.1, petalCountModifier: 2, thicknessMultiplier: 0.6, leanMultiplier: 0.75, complexity: 0.7 }],\n  [PlantType.ClematisLarge, { sizeMultiplier: 1.4, heightMultiplier: 1.1, petalCountModifier: 4, thicknessMultiplier: 0.7, leanMultiplier: 0.65, complexity: 0.8 }],\n  [PlantType.MorningGlory, { sizeMultiplier: 1.2, heightMultiplier: 1.05, thicknessMultiplier: 0.55, leanMultiplier: 0.85, complexity: 0.65 }],\n\n  // === SMALL TREES ===\n  [PlantType.Sapling, { leanMultiplier: 0.1 }],\n  [PlantType.SaplingOak, { sizeMultiplier: 1.2, heightMultiplier: 0.95, petalCountModifier: 2, thicknessMultiplier: 1.3, leanMultiplier: 0.08, complexity: 0.6 }],\n  [PlantType.SaplingMaple, { sizeMultiplier: 1.1, petalCountModifier: 3, thicknessMultiplier: 1.1, leanMultiplier: 0.12, complexity: 0.65 }],\n  [PlantType.SaplingBirch, { sizeMultiplier: 0.9, heightMultiplier: 1.15, petalCountModifier: 1, thicknessMultiplier: 0.8, leanMultiplier: 0.15, complexity: 0.55 }],\n  [PlantType.TreeYoung, { sizeMultiplier: 1.15, heightMultiplier: 1.1, petalCountModifier: 2, thicknessMultiplier: 1.2, leanMultiplier: 0.1, complexity: 0.6 }],\n  [PlantType.TreeOrnamental, { sizeMultiplier: 1.3, heightMultiplier: 0.9, petalCountModifier: 5, thicknessMultiplier: 1.1, leanMultiplier: 0.12, complexity: 0.75 }],\n  [PlantType.Birch, { sizeMultiplier: 0.85, heightMultiplier: 1.2, thicknessMultiplier: 0.75, leanMultiplier: 0.18, complexity: 0.6 }],\n  [PlantType.Willow, { sizeMultiplier: 1.2, petalCountModifier: 4, leanMultiplier: 0.2, complexity: 0.7 }],\n  [PlantType.WillowWeeping, { sizeMultiplier: 1.4, heightMultiplier: 1.1, petalCountModifier: 6, thicknessMultiplier: 1.1, leanMultiplier: 0.15, complexity: 0.85 }],\n  [PlantType.CherryBlossom, { sizeMultiplier: 1.3, heightMultiplier: 0.95, petalCountModifier: 8, leanMultiplier: 0.12, complexity: 0.9 }],\n\n  // === TROPICAL ===\n  [PlantType.PalmSmall, { leanMultiplier: 0.15, complexity: 0.6 }],\n  [PlantType.PalmFan, { sizeMultiplier: 1.3, heightMultiplier: 0.9, petalCountModifier: 3, thicknessMultiplier: 1.2, leanMultiplier: 0.1, complexity: 0.7 }],\n  [PlantType.BirdOfParadise, { sizeMultiplier: 1.1, thicknessMultiplier: 0.9, leanMultiplier: 0.2, complexity: 0.8 }],\n  [PlantType.BirdOfParadiseTall, { heightMultiplier: 1.2, petalCountModifier: 1, thicknessMultiplier: 0.85, leanMultiplier: 0.18, complexity: 0.85 }],\n  [PlantType.Banana, { sizeMultiplier: 1.4, heightMultiplier: 1.1, petalCountModifier: 2, thicknessMultiplier: 1.4, leanMultiplier: 0.12, complexity: 0.65 }],\n  [PlantType.BananaSmall, { sizeMultiplier: 1.1, heightMultiplier: 0.85, petalCountModifier: 1, thicknessMultiplier: 1.2, leanMultiplier: 0.15, complexity: 0.6 }],\n\n  // === CONIFERS ===\n  [PlantType.Pine, { thicknessMultiplier: 1.2, leanMultiplier: 0.05, complexity: 0.6 }],\n  [PlantType.PineYoung, { sizeMultiplier: 0.8, heightMultiplier: 0.85, petalCountModifier: -1, leanMultiplier: 0.08 }],\n  [PlantType.Cypress, { sizeMultiplier: 0.7, heightMultiplier: 1.15, thicknessMultiplier: 0.9, leanMultiplier: 0.03, complexity: 0.55 }],\n  [PlantType.CypressTall, { sizeMultiplier: 0.6, heightMultiplier: 1.3, thicknessMultiplier: 0.85, leanMultiplier: 0.02, complexity: 0.6 }],\n  [PlantType.Juniper, { sizeMultiplier: 1.1, heightMultiplier: 0.9, petalCountModifier: 1, thicknessMultiplier: 1.1, leanMultiplier: 0.1, complexity: 0.55 }],\n  [PlantType.JuniperTall, { sizeMultiplier: 0.9, heightMultiplier: 1.1, leanMultiplier: 0.07, complexity: 0.6 }],\n]);\n\n/**\n * Get variation for a plant type\n * Merges sparse overrides with defaults for complete variation\n */\nexport function getPlantVariation(type: PlantType): PlantVariation {\n  const overrides = variationOverrides.get(type);\n  if (!overrides) {\n    return defaultVariation;\n  }\n  return { ...defaultVariation, ...overrides };\n}\n","import type { PlantData, ResolvedOptions, ColorOptions } from '../types';\nimport { PlantType, PlantCategory } from '../types';\nimport { createRandom, randomRange, applyTimingCurve } from '../utils';\nimport { buildFlowerColors, buildFoliageColors } from '../colors';\nimport { plantsPerGeneration } from '../defaults';\nimport { getPlantVariation } from './variations';\n\n/**\n * Category name strings for public API\n * Maps user-friendly names to internal PlantCategory enum\n */\nconst categoryNameToEnum: Record<string, PlantCategory> = {\n  'simple-flower': PlantCategory.SimpleFlower,\n  'tulip': PlantCategory.Tulip,\n  'daisy': PlantCategory.Daisy,\n  'wildflower': PlantCategory.Wildflower,\n  'grass': PlantCategory.Grass,\n  'fern': PlantCategory.Fern,\n  'bush': PlantCategory.Bush,\n  'rose': PlantCategory.Rose,\n  'lily': PlantCategory.Lily,\n  'orchid': PlantCategory.Orchid,\n  'succulent': PlantCategory.Succulent,\n  'herb': PlantCategory.Herb,\n  'specialty': PlantCategory.Specialty,\n  'tall-flower': PlantCategory.TallFlower,\n  'giant-grass': PlantCategory.GiantGrass,\n  'climber': PlantCategory.Climber,\n  'small-tree': PlantCategory.SmallTree,\n  'tropical': PlantCategory.Tropical,\n  'conifer': PlantCategory.Conifer,\n};\n\n/**\n * All available plant category names\n * Use these values in the `categories` option\n */\nexport const PLANT_CATEGORIES = Object.keys(categoryNameToEnum) as readonly string[];\n\n/**\n * Convert user category names to PlantCategory set\n * Returns null if no filter (all categories)\n */\nfunction parseCategoryFilter(categories: string[] | null): Set<PlantCategory> | null {\n  if (!categories || categories.length === 0) return null;\n\n  const result = new Set<PlantCategory>();\n  for (const name of categories) {\n    const category = categoryNameToEnum[name.toLowerCase()];\n    if (category !== undefined) {\n      result.add(category);\n    }\n  }\n\n  return result.size > 0 ? result : null;\n}\n\n/**\n * Category weights for random selection\n * Weights are relative - they get normalized based on which categories are available\n */\nconst categoryWeights: Array<{ category: PlantCategory; weight: number }> = [\n  // Short plants (always available)\n  { category: PlantCategory.SimpleFlower, weight: 0.15 },\n  { category: PlantCategory.Tulip, weight: 0.10 },\n  { category: PlantCategory.Daisy, weight: 0.10 },\n  { category: PlantCategory.Wildflower, weight: 0.10 },\n  { category: PlantCategory.Grass, weight: 0.12 },\n  { category: PlantCategory.Fern, weight: 0.08 },\n  { category: PlantCategory.Bush, weight: 0.08 },\n  { category: PlantCategory.Rose, weight: 0.06 },\n  { category: PlantCategory.Lily, weight: 0.05 },\n  { category: PlantCategory.Orchid, weight: 0.04 },\n  { category: PlantCategory.Succulent, weight: 0.04 },\n  { category: PlantCategory.Herb, weight: 0.04 },\n  { category: PlantCategory.Specialty, weight: 0.04 },\n  // Tall plants (available when maxHeight allows)\n  { category: PlantCategory.TallFlower, weight: 0.06 },\n  { category: PlantCategory.GiantGrass, weight: 0.05 },\n  { category: PlantCategory.Climber, weight: 0.04 },\n  { category: PlantCategory.SmallTree, weight: 0.04 },\n  { category: PlantCategory.Tropical, weight: 0.03 },\n  { category: PlantCategory.Conifer, weight: 0.03 },\n];\n\n/**\n * Plant types by category - uses arrays for O(1) random access\n */\nconst plantTypesByCategory: Record<PlantCategory, PlantType[]> = {\n  [PlantCategory.SimpleFlower]: [\n    PlantType.SimpleFlower,\n    PlantType.SimpleFlowerSmall,\n    PlantType.SimpleFlowerLarge,\n    PlantType.SimpleFlowerTall,\n    PlantType.SimpleFlowerShort,\n    PlantType.SimpleFlowerWide,\n    PlantType.SimpleFlowerNarrow,\n    PlantType.SimpleFlowerDouble,\n    PlantType.SimpleFlowerClustered,\n    PlantType.SimpleFlowerSpiral,\n  ],\n  [PlantCategory.Tulip]: [\n    PlantType.Tulip,\n    PlantType.TulipTall,\n    PlantType.TulipShort,\n    PlantType.TulipDouble,\n    PlantType.TulipFringed,\n    PlantType.TulipParrot,\n    PlantType.TulipLily,\n    PlantType.TulipRembrandt,\n    PlantType.TulipDarwin,\n    PlantType.TulipTriumph,\n  ],\n  [PlantCategory.Daisy]: [\n    PlantType.Daisy,\n    PlantType.DaisySmall,\n    PlantType.DaisyLarge,\n    PlantType.DaisyDouble,\n    PlantType.DaisyGerbera,\n    PlantType.DaisyShasta,\n    PlantType.DaisyAfrican,\n    PlantType.DaisyOxeye,\n    PlantType.DaisyPainted,\n    PlantType.DaisyMarguerite,\n  ],\n  [PlantCategory.Wildflower]: [\n    PlantType.Wildflower,\n    PlantType.WildflowerClustered,\n    PlantType.WildflowerScattered,\n    PlantType.WildflowerTall,\n    PlantType.WildflowerMeadow,\n    PlantType.WildflowerPrairie,\n    PlantType.WildflowerAlpine,\n    PlantType.WildflowerWoodland,\n    PlantType.WildflowerCoastal,\n    PlantType.WildflowerDesert,\n  ],\n  [PlantCategory.Grass]: [\n    PlantType.Grass,\n    PlantType.GrassTall,\n    PlantType.GrassShort,\n    PlantType.GrassWispy,\n    PlantType.GrassThick,\n    PlantType.GrassPampas,\n    PlantType.GrassFountain,\n    PlantType.GrassBlue,\n    PlantType.GrassFeather,\n    PlantType.GrassReed,\n  ],\n  [PlantCategory.Fern]: [\n    PlantType.Fern,\n    PlantType.FernSmall,\n    PlantType.FernLarge,\n    PlantType.FernCurly,\n    PlantType.FernStraight,\n    PlantType.FernMaidenhair,\n    PlantType.FernBoston,\n    PlantType.FernStaghorn,\n    PlantType.FernBird,\n    PlantType.FernTree,\n  ],\n  [PlantCategory.Bush]: [\n    PlantType.Bush,\n    PlantType.BushSmall,\n    PlantType.BushLarge,\n    PlantType.BushFlowering,\n    PlantType.BushBerry,\n    PlantType.BushRound,\n    PlantType.BushSpreading,\n    PlantType.BushCompact,\n    PlantType.BushWild,\n    PlantType.BushOrnamental,\n  ],\n  [PlantCategory.Rose]: [\n    PlantType.Rose,\n    PlantType.RoseClimbing,\n    PlantType.RoseMiniature,\n    PlantType.RoseWild,\n    PlantType.RoseDouble,\n  ],\n  [PlantCategory.Lily]: [\n    PlantType.Lily,\n    PlantType.LilyTiger,\n    PlantType.LilyCalla,\n    PlantType.LilyDaylily,\n    PlantType.LilyStargazer,\n  ],\n  [PlantCategory.Orchid]: [\n    PlantType.Orchid,\n    PlantType.OrchidMoth,\n    PlantType.OrchidDendrobium,\n    PlantType.OrchidCattleya,\n    PlantType.OrchidVanda,\n  ],\n  [PlantCategory.Succulent]: [\n    PlantType.Succulent,\n    PlantType.SucculentRosette,\n    PlantType.SucculentSpiky,\n    PlantType.SucculentTrailing,\n    PlantType.SucculentFlowering,\n  ],\n  [PlantCategory.Herb]: [\n    PlantType.Lavender,\n    PlantType.LavenderTall,\n    PlantType.Sage,\n    PlantType.Thyme,\n    PlantType.Rosemary,\n  ],\n  [PlantCategory.Specialty]: [\n    PlantType.Poppy,\n    PlantType.Sunflower,\n    PlantType.Iris,\n    PlantType.Peony,\n    PlantType.Hydrangea,\n    PlantType.Dahlia,\n  ],\n  // Tall categories\n  [PlantCategory.TallFlower]: [\n    PlantType.Hollyhock,\n    PlantType.HollyhockDouble,\n    PlantType.Delphinium,\n    PlantType.DelphiniumTall,\n    PlantType.Foxglove,\n    PlantType.FoxgloveTall,\n    PlantType.Gladiolus,\n    PlantType.Lupine,\n  ],\n  [PlantCategory.GiantGrass]: [\n    PlantType.Bamboo,\n    PlantType.BambooTall,\n    PlantType.BambooClump,\n    PlantType.GiantReed,\n    PlantType.ElephantGrass,\n    PlantType.Miscanthus,\n    PlantType.MiscanthusTall,\n    PlantType.Cortaderia,\n  ],\n  [PlantCategory.Climber]: [\n    PlantType.Vine,\n    PlantType.VineFlowering,\n    PlantType.VineIvy,\n    PlantType.Wisteria,\n    PlantType.WisteriaCascade,\n    PlantType.Clematis,\n    PlantType.ClematisLarge,\n    PlantType.MorningGlory,\n  ],\n  [PlantCategory.SmallTree]: [\n    PlantType.Sapling,\n    PlantType.SaplingOak,\n    PlantType.SaplingMaple,\n    PlantType.SaplingBirch,\n    PlantType.TreeYoung,\n    PlantType.TreeOrnamental,\n    PlantType.Birch,\n    PlantType.Willow,\n    PlantType.WillowWeeping,\n    PlantType.CherryBlossom,\n  ],\n  [PlantCategory.Tropical]: [\n    PlantType.PalmSmall,\n    PlantType.PalmFan,\n    PlantType.BirdOfParadise,\n    PlantType.BirdOfParadiseTall,\n    PlantType.Banana,\n    PlantType.BananaSmall,\n  ],\n  [PlantCategory.Conifer]: [\n    PlantType.Pine,\n    PlantType.PineYoung,\n    PlantType.Cypress,\n    PlantType.CypressTall,\n    PlantType.Juniper,\n    PlantType.JuniperTall,\n  ],\n};\n\n/**\n * Height ranges by category [min, max] as fraction of container height\n * Categories are only available when maxHeight >= their minimum height\n */\nconst categoryHeightRanges: Record<PlantCategory, [number, number]> = {\n  // Short plants (available at any maxHeight)\n  [PlantCategory.SimpleFlower]: [0.10, 0.22],\n  [PlantCategory.Tulip]: [0.12, 0.22],\n  [PlantCategory.Daisy]: [0.10, 0.20],\n  [PlantCategory.Wildflower]: [0.08, 0.18],\n  [PlantCategory.Grass]: [0.03, 0.10],\n  [PlantCategory.Fern]: [0.06, 0.14],\n  [PlantCategory.Bush]: [0.08, 0.16],\n  [PlantCategory.Rose]: [0.12, 0.25],\n  [PlantCategory.Lily]: [0.14, 0.26],\n  [PlantCategory.Orchid]: [0.10, 0.20],\n  [PlantCategory.Succulent]: [0.04, 0.10],\n  [PlantCategory.Herb]: [0.06, 0.14],\n  [PlantCategory.Specialty]: [0.12, 0.28],\n  // Tall plants (available when maxHeight is high enough)\n  [PlantCategory.TallFlower]: [0.30, 0.50],\n  [PlantCategory.GiantGrass]: [0.40, 0.70],\n  [PlantCategory.Climber]: [0.50, 0.90],\n  [PlantCategory.SmallTree]: [0.60, 1.00],\n  [PlantCategory.Tropical]: [0.50, 0.85],\n  [PlantCategory.Conifer]: [0.55, 1.00],\n};\n\n/**\n * Map from PlantType to category for efficient lookup\n * Built once at module load time\n */\nconst plantTypeToCategory: Map<PlantType, PlantCategory> = new Map();\nfor (const [category, types] of Object.entries(plantTypesByCategory)) {\n  for (const type of types) {\n    plantTypeToCategory.set(type, Number(category) as PlantCategory);\n  }\n}\n\n/**\n * Tall categories that should be boosted when maxHeight is high\n */\nconst tallCategories = new Set([\n  PlantCategory.TallFlower,\n  PlantCategory.GiantGrass,\n  PlantCategory.Climber,\n  PlantCategory.SmallTree,\n  PlantCategory.Tropical,\n  PlantCategory.Conifer,\n]);\n\n\n/**\n * Select a random category based on weights, filtered by maxHeight and user selection\n * Categories whose minimum height exceeds maxHeight are excluded\n * Tall categories get boosted weights when maxHeight is high\n */\nfunction selectCategory(\n  rand: () => number,\n  maxHeight: number,\n  categoryFilter: Set<PlantCategory> | null\n): PlantCategory {\n  // Filter categories to those compatible with maxHeight and user selection\n  const availableCategories = categoryWeights.filter(({ category }) => {\n    // Check maxHeight compatibility\n    const [minH] = categoryHeightRanges[category];\n    if (minH > maxHeight) return false;\n\n    // Check user category filter\n    if (categoryFilter && !categoryFilter.has(category)) return false;\n\n    return true;\n  });\n\n  // Fallback if no categories available\n  if (availableCategories.length === 0) {\n    return categoryFilter?.values().next().value ?? PlantCategory.SimpleFlower;\n  }\n\n  // Calculate boost factor for tall plants based on maxHeight\n  // At maxHeight 0.35 (default): no boost (1x)\n  // At maxHeight 0.7: moderate boost (2x)\n  // At maxHeight 1.0: strong boost (4x)\n  const tallBoostFactor = 1 + Math.max(0, (maxHeight - 0.35) / 0.65) * 3;\n\n  // Apply boost to tall categories and calculate total weight\n  let totalWeight = 0;\n  const adjustedWeights = availableCategories.map(({ category, weight }) => {\n    const adjustedWeight = tallCategories.has(category) ? weight * tallBoostFactor : weight;\n    totalWeight += adjustedWeight;\n    return { category, weight: adjustedWeight };\n  });\n\n  const roll = rand() * totalWeight;\n  let cumulative = 0;\n\n  for (const { category, weight } of adjustedWeights) {\n    cumulative += weight;\n    if (roll < cumulative) {\n      return category;\n    }\n  }\n\n  return availableCategories[0].category;\n}\n\n/**\n * Select a random plant type from a category\n */\nfunction selectPlantType(\n  rand: () => number,\n  maxHeight: number,\n  categoryFilter: Set<PlantCategory> | null\n): PlantType {\n  const category = selectCategory(rand, maxHeight, categoryFilter);\n  const types = plantTypesByCategory[category];\n  return types[Math.floor(rand() * types.length)];\n}\n\n/**\n * Get height range for a plant type\n */\nfunction getHeightRange(type: PlantType, maxHeight: number): [number, number] {\n  const category = plantTypeToCategory.get(type) ?? PlantCategory.SimpleFlower;\n  const [min, max] = categoryHeightRanges[category];\n  return [min, Math.min(max, maxHeight)];\n}\n\n/**\n * Generate a random height within range, biased toward max when maxHeight is high\n * This ensures tall gardens actually have plants reaching the top\n */\nfunction generatePlantHeight(minH: number, maxH: number, maxHeight: number, rand: () => number): number {\n  const range = maxH - minH;\n\n  // When maxHeight is high (>0.5), bias toward the upper end of the range\n  // This makes tall gardens look properly full\n  if (maxHeight > 0.5 && maxH > 0.4) {\n    // Use a power curve to bias toward max\n    // biasFactor: 0 at maxHeight=0.5, 1 at maxHeight=1.0\n    const biasFactor = (maxHeight - 0.5) / 0.5;\n    // Apply bias: raise random to a power less than 1 to skew toward 1\n    const biasedRand = Math.pow(rand(), 1 - biasFactor * 0.5);\n    return minH + range * biasedRand;\n  }\n\n  return minH + range * rand();\n}\n\n/**\n * Generate all plants for the garden\n * Optimized for memory efficiency with pre-allocated array\n */\nexport function generatePlants(options: ResolvedOptions): PlantData[] {\n  const { duration, generations, maxHeight, density, seed, colors, timingCurve, categories } = options;\n\n  const [minPlantsPerGen, maxPlantsPerGen] = plantsPerGeneration[density];\n\n  // Parse category filter\n  const categoryFilter = parseCategoryFilter(categories);\n\n  // Build color arrays once\n  const flowerColors = buildFlowerColors(colors as Required<ColorOptions>);\n  const foliageColors = buildFoliageColors(colors as Required<ColorOptions>);\n\n  // Estimate total plants for pre-allocation (reduces memory fragmentation)\n  const avgPlantsPerGen = (minPlantsPerGen + maxPlantsPerGen) / 2;\n  const estimatedTotal = Math.ceil(generations * avgPlantsPerGen * 1.1);\n  const plants: PlantData[] = [];\n  plants.length = estimatedTotal; // Pre-allocate\n\n  let plantId = 0;\n  let actualCount = 0;\n\n  for (let gen = 0; gen < generations; gen++) {\n    // Apply timing curve to warp generation start times\n    const warpedStart = applyTimingCurve(gen, generations, timingCurve);\n    const warpedEnd = applyTimingCurve(gen + 1, generations, timingCurve);\n    const genDelay = warpedStart * duration;\n    const genDuration = (warpedEnd - warpedStart) * duration;\n\n    const genRand = createRandom(seed + gen * 1000);\n\n    // Number of plants in this generation\n    const plantsInGen = Math.floor(randomRange(minPlantsPerGen, maxPlantsPerGen + 1, genRand));\n\n    for (let p = 0; p < plantsInGen; p++) {\n      const plantRand = createRandom(seed + gen * 1000 + p * 100);\n\n      // Select plant type (filtered by maxHeight and categories)\n      const type = selectPlantType(plantRand, maxHeight, categoryFilter);\n\n      // Position\n      const x = plantRand();\n\n      // Height based on type (biased toward max for tall gardens)\n      const [minH, maxH] = getHeightRange(type, maxHeight);\n      const plantHeight = generatePlantHeight(minH, maxH, maxHeight, plantRand);\n\n      // Colors - use direct array indexing for speed\n      const flowerColorIdx = Math.floor(plantRand() * flowerColors.length);\n      const leafColorIdx = Math.floor(plantRand() * foliageColors.leaves.length);\n      const stemColorIdx = Math.floor(plantRand() * foliageColors.stems.length);\n\n      // Timing - use warped generation duration for proper pacing\n      const delay = genDelay + plantRand() * genDuration * 0.5;\n      const growDuration = genDuration * randomRange(0.6, 1.0, plantRand);\n\n      // Visual properties\n      const petals = 5 + Math.floor(plantRand() * 4);\n      const lean = (plantRand() - 0.5) * 0.3;\n      const scale = randomRange(0.7, 1.2, plantRand);\n\n      // Cache category and variation for O(1) lookup during rendering\n      const category = plantTypeToCategory.get(type) ?? PlantCategory.SimpleFlower;\n      const variation = getPlantVariation(type);\n\n      plants[actualCount++] = {\n        id: plantId++,\n        type,\n        x,\n        maxHeight: plantHeight,\n        flowerColor: flowerColors[flowerColorIdx],\n        stemColor: foliageColors.stems[stemColorIdx],\n        leafColor: foliageColors.leaves[leafColorIdx],\n        delay,\n        growDuration,\n        seed: seed + gen * 1000 + p * 100,\n        petals,\n        lean,\n        scale,\n        generation: gen,\n        category,\n        variation,\n      };\n    }\n  }\n\n  // Trim array to actual size\n  plants.length = actualCount;\n\n  // Sort by height for proper layering (shorter plants in front)\n  plants.sort((a, b) => a.maxHeight - b.maxHeight);\n\n  return plants;\n}\n\n/**\n * Get the generation that should be active at a given time\n */\nexport function getCurrentGeneration(time: number, duration: number, generations: number): number {\n  const timePerGen = duration / generations;\n  return Math.min(generations - 1, Math.floor(time / timePerGen));\n}\n\n/**\n * Check if a generation just completed\n */\nexport function didGenerationComplete(\n  prevTime: number,\n  currentTime: number,\n  duration: number,\n  generations: number\n): number | null {\n  const timePerGen = duration / generations;\n  const prevGen = Math.floor(prevTime / timePerGen);\n  const currentGen = Math.floor(currentTime / timePerGen);\n\n  if (currentGen > prevGen && currentGen <= generations) {\n    return prevGen + 1;\n  }\n\n  return null;\n}\n\n/**\n * Get the category for a plant type (exported for renderer use)\n */\nexport function getPlantCategory(type: PlantType): PlantCategory {\n  return plantTypeToCategory.get(type) ?? PlantCategory.SimpleFlower;\n}\n\n// Re-export for convenience\nexport { PlantCategory } from '../types';\nexport { getPlantVariation } from './variations';\n","import type { PlantData, PlantVariation } from '../types';\nimport { PlantType, PlantCategory } from '../types';\nimport { seededRandom, createRandom } from '../utils';\nimport { getPlantCategory } from './generator';\nimport { getPlantVariation } from './variations';\n\n/**\n * Common drawing context type\n */\ntype Ctx = CanvasRenderingContext2D;\n\n/**\n * Growth phases for plant animation\n */\ninterface GrowthPhases {\n  progress: number;\n  stem: number;\n  leaf: number;\n  flower: number;\n}\n\n/**\n * Calculate growth phases from progress value\n * Extracts the common growth timing logic used by most renderers\n */\nfunction calculateGrowthPhases(time: number, delay: number, growDuration: number): GrowthPhases | null {\n  const progress = (time - delay) / growDuration;\n  if (progress <= 0) return null;\n\n  return {\n    progress,\n    stem: Math.min(1, progress * 1.5),\n    leaf: Math.max(0, Math.min(1, (progress - 0.3) * 2)),\n    flower: Math.max(0, Math.min(1, (progress - 0.5) * 2)),\n  };\n}\n\n/**\n * Render context for flowering plants\n */\ninterface FloweringPlantContext {\n  x: number;\n  baseY: number;\n  plantHeight: number;\n  phases: GrowthPhases;\n}\n\n/**\n * Create render context for a flowering plant\n */\nfunction createFloweringContext(\n  plant: PlantData,\n  width: number,\n  height: number,\n  time: number,\n  variation: PlantVariation\n): FloweringPlantContext | null {\n  const phases = calculateGrowthPhases(time, plant.delay, plant.growDuration);\n  if (!phases) return null;\n\n  return {\n    x: plant.x * width,\n    baseY: height,\n    plantHeight: plant.maxHeight * height * variation.heightMultiplier,\n    phases,\n  };\n}\n\n\n/**\n * Draw a curved stem and return the end position\n */\nexport function drawStem(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  height: number,\n  thickness: number,\n  color: string,\n  lean: number,\n  growth: number\n): { x: number; y: number } | null {\n  if (growth <= 0) return null;\n\n  const h = height * Math.min(1, growth);\n\n  ctx.beginPath();\n  ctx.moveTo(x, y);\n\n  // Control points for natural curve\n  const cp1x = x + lean * h * 0.3;\n  const cp1y = y - h * 0.4;\n  const cp2x = x + lean * h * 0.6;\n  const cp2y = y - h * 0.7;\n  const endX = x + lean * h;\n  const endY = y - h;\n\n  ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);\n  ctx.strokeStyle = color;\n  ctx.lineWidth = thickness;\n  ctx.lineCap = 'round';\n  ctx.stroke();\n\n  return { x: endX, y: endY };\n}\n\n/**\n * Draw a leaf shape\n */\nexport function drawLeaf(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  angle: number,\n  size: number,\n  color: string\n): void {\n  if (size < 1) return;\n\n  ctx.save();\n  ctx.translate(x, y);\n  ctx.rotate(angle);\n\n  ctx.beginPath();\n  ctx.moveTo(0, 0);\n  ctx.bezierCurveTo(size * 0.3, -size * 0.15, size * 0.7, -size * 0.15, size, 0);\n  ctx.bezierCurveTo(size * 0.7, size * 0.15, size * 0.3, size * 0.15, 0, 0);\n  ctx.fillStyle = color;\n  ctx.fill();\n\n  ctx.restore();\n}\n\n/**\n * Draw a simple flower with petals\n */\nfunction drawSimpleFlower(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  petals: number,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const p = Math.max(3, petals + variation.petalCountModifier);\n\n  // Petals\n  for (let i = 0; i < p; i++) {\n    const angle = (i / p) * Math.PI * 2;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.ellipse(s * 0.5, 0, s * 0.5, s * 0.25, 0, 0, Math.PI * 2);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // Center\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.25, 0, Math.PI * 2);\n  ctx.fillStyle = '#FFD700';\n  ctx.fill();\n}\n\n/**\n * Draw a tulip flower\n */\nfunction drawTulip(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n\n  ctx.beginPath();\n  ctx.moveTo(x - s * 0.3, y);\n  ctx.bezierCurveTo(x - s * 0.4, y - s * 0.5, x - s * 0.2, y - s * 0.9, x, y - s);\n  ctx.bezierCurveTo(x + s * 0.2, y - s * 0.9, x + s * 0.4, y - s * 0.5, x + s * 0.3, y);\n  ctx.bezierCurveTo(x + s * 0.1, y - s * 0.2, x - s * 0.1, y - s * 0.2, x - s * 0.3, y);\n  ctx.fillStyle = color;\n  ctx.fill();\n\n  // Add stripes for complex variations\n  if (variation.complexity > 0.6) {\n    ctx.globalAlpha = 0.3;\n    ctx.beginPath();\n    ctx.moveTo(x, y - s * 0.2);\n    ctx.lineTo(x, y - s * 0.9);\n    ctx.strokeStyle = '#FFFFFF';\n    ctx.lineWidth = s * 0.08;\n    ctx.stroke();\n    ctx.globalAlpha = 1;\n  }\n}\n\n/**\n * Draw a daisy flower\n */\nfunction drawDaisy(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const petalCount = Math.max(8, 12 + variation.petalCountModifier);\n\n  // Petals\n  for (let i = 0; i < petalCount; i++) {\n    const angle = (i / petalCount) * Math.PI * 2;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.ellipse(s * 0.45, 0, s * 0.4, s * 0.12, 0, 0, Math.PI * 2);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // Yellow center\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.22, 0, Math.PI * 2);\n  ctx.fillStyle = '#FFD700';\n  ctx.fill();\n}\n\n/**\n * Draw wildflower clusters\n */\nfunction drawWildflower(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const count = Math.max(3, 5 + variation.petalCountModifier);\n\n  for (let i = 0; i < count; i++) {\n    const angle = (i / count) * Math.PI * 2 + 0.3;\n    const dist = s * 0.3;\n    const fx = x + Math.cos(angle) * dist;\n    const fy = y + Math.sin(angle) * dist;\n\n    ctx.beginPath();\n    ctx.arc(fx, fy, s * 0.18, 0, Math.PI * 2);\n    ctx.fillStyle = color;\n    ctx.fill();\n  }\n\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.15, 0, Math.PI * 2);\n  ctx.fillStyle = color;\n  ctx.fill();\n}\n\n/**\n * Draw grass blades\n */\nfunction drawGrass(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  height: number,\n  color: string,\n  seed: number,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const h = height * Math.min(1, growth) * variation.heightMultiplier;\n  const thickness = 1.5 * variation.thicknessMultiplier;\n\n  const blades = Math.max(2, 3 + Math.floor(seededRandom(seed) * 3) + variation.petalCountModifier);\n  for (let i = 0; i < blades; i++) {\n    const rand = seededRandom(seed + i * 10);\n    const lean = (rand - 0.5) * 0.4 * variation.leanMultiplier;\n    const bladeH = h * (0.6 + rand * 0.4);\n\n    ctx.beginPath();\n    ctx.moveTo(x + (i - blades / 2) * 3, y);\n    ctx.quadraticCurveTo(\n      x + (i - blades / 2) * 3 + lean * bladeH,\n      y - bladeH * 0.6,\n      x + (i - blades / 2) * 3 + lean * bladeH * 1.5,\n      y - bladeH\n    );\n    ctx.strokeStyle = color;\n    ctx.lineWidth = thickness;\n    ctx.lineCap = 'round';\n    ctx.stroke();\n  }\n\n  // Add plumes for pampas grass and similar\n  if (variation.complexity > 0.7 && growth > 0.8) {\n    const plumeGrowth = (growth - 0.8) / 0.2;\n    ctx.globalAlpha = plumeGrowth * 0.7;\n    for (let i = 0; i < blades; i++) {\n      const rand = seededRandom(seed + i * 10);\n      const lean = (rand - 0.5) * 0.4 * variation.leanMultiplier;\n      const bladeH = h * (0.6 + rand * 0.4);\n      const plumeX = x + (i - blades / 2) * 3 + lean * bladeH * 1.5;\n      const plumeY = y - bladeH;\n\n      ctx.beginPath();\n      ctx.ellipse(plumeX, plumeY - h * 0.1, h * 0.08, h * 0.15, 0, 0, Math.PI * 2);\n      ctx.fillStyle = '#F5F5DC';\n      ctx.fill();\n    }\n    ctx.globalAlpha = 1;\n  }\n}\n\n/**\n * Draw fern fronds\n */\nfunction drawFern(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  height: number,\n  color: string,\n  seed: number,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const h = height * Math.min(1, growth) * variation.heightMultiplier;\n  const lean = (seededRandom(seed) - 0.5) * 0.3 * variation.leanMultiplier;\n  const thickness = 1.5 * variation.thicknessMultiplier;\n\n  // Main stem\n  ctx.beginPath();\n  ctx.moveTo(x, y);\n  ctx.quadraticCurveTo(x + lean * h * 0.5, y - h * 0.5, x + lean * h, y - h);\n  ctx.strokeStyle = color;\n  ctx.lineWidth = thickness;\n  ctx.stroke();\n\n  // Fronds\n  const frondCount = Math.max(4, 6 + variation.petalCountModifier);\n  for (let i = 0; i < frondCount; i++) {\n    const t = (i + 1) / (frondCount + 1);\n    const fx = x + lean * h * t;\n    const fy = y - h * t;\n    const side = i % 2 === 0 ? 1 : -1;\n    const frondLen = h * 0.25 * (1 - t * 0.5);\n\n    // Curl for curly fern types\n    const curlFactor = variation.complexity > 0.7 ? 0.5 : 0.2;\n\n    ctx.beginPath();\n    ctx.moveTo(fx, fy);\n    ctx.quadraticCurveTo(\n      fx + side * frondLen * 0.7,\n      fy - frondLen * curlFactor,\n      fx + side * frondLen,\n      fy + frondLen * curlFactor\n    );\n    ctx.strokeStyle = color;\n    ctx.lineWidth = 1;\n    ctx.stroke();\n  }\n}\n\n/**\n * Draw a bush with leaves and small flowers\n */\nfunction drawBush(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  leafColor: string,\n  flowerColor: string,\n  seed: number,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * Math.min(1, growth) * variation.sizeMultiplier;\n\n  // Cluster of leaves\n  const leafCount = Math.max(5, 8 + variation.petalCountModifier);\n  for (let i = 0; i < leafCount; i++) {\n    const rand = seededRandom(seed + i * 7);\n    const angle = (i / leafCount) * Math.PI * 2 + rand * 0.5;\n    const dist = s * (0.3 + rand * 0.4);\n    const lx = x + Math.cos(angle) * dist * variation.leanMultiplier;\n    const ly = y - s * 0.3 + Math.sin(angle) * dist * 0.5;\n\n    drawLeaf(ctx, lx, ly, angle + Math.PI, s * 0.4, leafColor);\n  }\n\n  // Small flowers (more for flowering bush type)\n  const flowerThreshold = variation.complexity > 0.8 ? 0.5 : 0.7;\n  if (growth > flowerThreshold) {\n    const flowerGrowth = (growth - flowerThreshold) / (1 - flowerThreshold);\n    const flowerCount = variation.complexity > 0.8 ? 5 : 3;\n    for (let i = 0; i < flowerCount; i++) {\n      const rand = seededRandom(seed + i * 13);\n      const fx = x + (rand - 0.5) * s * 0.6;\n      const fy = y - s * 0.3 - rand * s * 0.3;\n\n      ctx.beginPath();\n      ctx.arc(fx, fy, s * 0.12 * flowerGrowth, 0, Math.PI * 2);\n      ctx.fillStyle = flowerColor;\n      ctx.fill();\n    }\n  }\n}\n\n/**\n * Draw a rose\n */\nfunction drawRose(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const petalLayers = variation.complexity > 0.8 ? 4 : 3;\n\n  // Draw petals in layers (outer to inner)\n  for (let layer = 0; layer < petalLayers; layer++) {\n    const layerSize = s * (1 - layer * 0.2);\n    const petalsInLayer = 5 + layer;\n    const angleOffset = layer * 0.3;\n\n    for (let i = 0; i < petalsInLayer; i++) {\n      const angle = (i / petalsInLayer) * Math.PI * 2 + angleOffset;\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.rotate(angle);\n\n      ctx.beginPath();\n      ctx.ellipse(layerSize * 0.35, 0, layerSize * 0.4, layerSize * 0.25, 0, 0, Math.PI * 2);\n      ctx.fillStyle = color;\n      ctx.fill();\n      ctx.restore();\n    }\n  }\n\n  // Center\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.15, 0, Math.PI * 2);\n  ctx.fillStyle = '#FFD700';\n  ctx.fill();\n}\n\n/**\n * Draw a lily\n */\nfunction drawLily(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const petals = Math.max(4, 6 + variation.petalCountModifier);\n\n  // Long curved petals\n  for (let i = 0; i < petals; i++) {\n    const angle = (i / petals) * Math.PI * 2;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.bezierCurveTo(s * 0.2, -s * 0.3, s * 0.6, -s * 0.2, s * 0.8, 0);\n    ctx.bezierCurveTo(s * 0.6, s * 0.15, s * 0.2, s * 0.1, 0, 0);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // Stamens\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.12, 0, Math.PI * 2);\n  ctx.fillStyle = '#8B4513';\n  ctx.fill();\n}\n\n/**\n * Draw an orchid\n */\nfunction drawOrchid(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n\n  // Three outer petals (sepals)\n  for (let i = 0; i < 3; i++) {\n    const angle = (i / 3) * Math.PI * 2 - Math.PI / 2;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.ellipse(s * 0.5, 0, s * 0.5, s * 0.15, 0, 0, Math.PI * 2);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // Two side petals\n  for (let i = 0; i < 2; i++) {\n    const angle = (i === 0 ? -0.4 : 0.4) + Math.PI / 2;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.ellipse(s * 0.35, 0, s * 0.35, s * 0.2, 0, 0, Math.PI * 2);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // Lip (labellum) - distinctive orchid feature\n  ctx.beginPath();\n  ctx.ellipse(x, y + s * 0.3, s * 0.25, s * 0.15, 0, 0, Math.PI * 2);\n  ctx.fillStyle = '#FFD700';\n  ctx.fill();\n}\n\n/**\n * Draw a succulent\n */\nfunction drawSucculent(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const layers = variation.complexity > 0.6 ? 4 : 3;\n  const leavesPerLayer = 6 + variation.petalCountModifier;\n\n  // Draw rosette pattern\n  for (let layer = 0; layer < layers; layer++) {\n    const layerSize = s * (1 - layer * 0.2);\n    const angleOffset = layer * 0.5;\n\n    for (let i = 0; i < leavesPerLayer; i++) {\n      const angle = (i / leavesPerLayer) * Math.PI * 2 + angleOffset;\n      const lx = x + Math.cos(angle) * layerSize * 0.4;\n      const ly = y - layer * s * 0.1 + Math.sin(angle) * layerSize * 0.2;\n\n      ctx.beginPath();\n      ctx.ellipse(lx, ly, layerSize * 0.2, layerSize * 0.35, angle, 0, Math.PI * 2);\n      ctx.fillStyle = color;\n      ctx.fill();\n    }\n  }\n}\n\n/**\n * Draw lavender\n */\nfunction drawLavender(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  height: number,\n  color: string,\n  seed: number,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const h = height * Math.min(1, growth) * variation.heightMultiplier;\n  const lean = (seededRandom(seed) - 0.5) * 0.2 * variation.leanMultiplier;\n\n  // Stem\n  ctx.beginPath();\n  ctx.moveTo(x, y);\n  ctx.quadraticCurveTo(x + lean * h * 0.5, y - h * 0.5, x + lean * h, y - h);\n  ctx.strokeStyle = '#4A7C40';\n  ctx.lineWidth = 1.5 * variation.thicknessMultiplier;\n  ctx.stroke();\n\n  // Flower spike at top\n  if (growth > 0.5) {\n    const flowerGrowth = (growth - 0.5) / 0.5;\n    const spikeHeight = h * 0.3 * flowerGrowth;\n    const spikeY = y - h + spikeHeight / 2;\n    const spikeX = x + lean * h;\n\n    const buds = Math.floor(8 * flowerGrowth);\n    for (let i = 0; i < buds; i++) {\n      const by = spikeY - (i / buds) * spikeHeight;\n      const bx = spikeX + (seededRandom(seed + i) - 0.5) * 4;\n\n      ctx.beginPath();\n      ctx.arc(bx, by, 2.5, 0, Math.PI * 2);\n      ctx.fillStyle = color;\n      ctx.fill();\n    }\n  }\n}\n\n/**\n * Draw poppy\n */\nfunction drawPoppy(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n\n  // 4 crinkled petals\n  for (let i = 0; i < 4; i++) {\n    const angle = (i / 4) * Math.PI * 2 + Math.PI / 4;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    // Wavy petal edge\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.bezierCurveTo(s * 0.2, -s * 0.3, s * 0.5, -s * 0.2, s * 0.6, 0);\n    ctx.bezierCurveTo(s * 0.5, s * 0.2, s * 0.2, s * 0.3, 0, 0);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // Dark center\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.2, 0, Math.PI * 2);\n  ctx.fillStyle = '#2D2D2D';\n  ctx.fill();\n}\n\n/**\n * Draw sunflower\n */\nfunction drawSunflower(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const petalCount = 16 + variation.petalCountModifier;\n\n  // Ray petals\n  for (let i = 0; i < petalCount; i++) {\n    const angle = (i / petalCount) * Math.PI * 2;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.moveTo(s * 0.3, 0);\n    ctx.bezierCurveTo(s * 0.4, -s * 0.08, s * 0.7, -s * 0.05, s * 0.85, 0);\n    ctx.bezierCurveTo(s * 0.7, s * 0.05, s * 0.4, s * 0.08, s * 0.3, 0);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // Dark center disc\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.35, 0, Math.PI * 2);\n  ctx.fillStyle = '#4A3728';\n  ctx.fill();\n\n  // Seeds pattern in center\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.25, 0, Math.PI * 2);\n  ctx.fillStyle = '#3D2D20';\n  ctx.fill();\n}\n\n/**\n * Draw iris\n */\nfunction drawIris(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n\n  // 3 upright petals (standards)\n  for (let i = 0; i < 3; i++) {\n    const angle = (i / 3) * Math.PI * 2;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.bezierCurveTo(s * 0.1, -s * 0.4, s * 0.2, -s * 0.6, 0, -s * 0.7);\n    ctx.bezierCurveTo(-s * 0.2, -s * 0.6, -s * 0.1, -s * 0.4, 0, 0);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n\n  // 3 falls (drooping petals)\n  for (let i = 0; i < 3; i++) {\n    const angle = (i / 3) * Math.PI * 2 + Math.PI / 3;\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(angle);\n\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.bezierCurveTo(s * 0.3, s * 0.2, s * 0.4, s * 0.5, s * 0.2, s * 0.6);\n    ctx.bezierCurveTo(0, s * 0.5, -s * 0.1, s * 0.2, 0, 0);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.restore();\n  }\n}\n\n/**\n * Draw peony\n */\nfunction drawPeony(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const layers = 5;\n\n  // Many ruffled petals in layers\n  for (let layer = 0; layer < layers; layer++) {\n    const layerSize = s * (1 - layer * 0.15);\n    const petalsInLayer = 8 + layer * 2;\n    const angleOffset = layer * 0.4;\n\n    for (let i = 0; i < petalsInLayer; i++) {\n      const angle = (i / petalsInLayer) * Math.PI * 2 + angleOffset;\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.rotate(angle);\n\n      ctx.beginPath();\n      ctx.ellipse(layerSize * 0.3, 0, layerSize * 0.35, layerSize * 0.2, 0, 0, Math.PI * 2);\n      ctx.fillStyle = color;\n      ctx.fill();\n      ctx.restore();\n    }\n  }\n\n  // Golden center\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.12, 0, Math.PI * 2);\n  ctx.fillStyle = '#FFD700';\n  ctx.fill();\n}\n\n/**\n * Draw hydrangea\n */\nfunction drawHydrangea(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  seed: number,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const floretCount = 20 + variation.petalCountModifier;\n\n  // Cluster of small 4-petal florets\n  for (let i = 0; i < floretCount; i++) {\n    const rand1 = seededRandom(seed + i * 7);\n    const rand2 = seededRandom(seed + i * 11);\n    const angle = rand1 * Math.PI * 2;\n    const dist = rand2 * s * 0.4;\n    const fx = x + Math.cos(angle) * dist;\n    const fy = y + Math.sin(angle) * dist * 0.6 - s * 0.1;\n\n    // Each floret is 4 small petals\n    for (let p = 0; p < 4; p++) {\n      const pa = (p / 4) * Math.PI * 2;\n      ctx.beginPath();\n      ctx.ellipse(\n        fx + Math.cos(pa) * s * 0.06,\n        fy + Math.sin(pa) * s * 0.06,\n        s * 0.05,\n        s * 0.03,\n        pa,\n        0,\n        Math.PI * 2\n      );\n      ctx.fillStyle = color;\n      ctx.fill();\n    }\n  }\n}\n\n/**\n * Draw dahlia - spherical flower with many pointed petals\n */\nfunction drawDahlia(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  size: number,\n  color: string,\n  growth: number,\n  variation: PlantVariation\n): void {\n  if (growth <= 0) return;\n  const s = size * growth * variation.sizeMultiplier;\n  const layers = 4;\n\n  // Many layers of pointed petals\n  for (let layer = 0; layer < layers; layer++) {\n    const layerSize = s * (1 - layer * 0.18);\n    const petalsInLayer = 10 + layer * 2 + variation.petalCountModifier;\n    const angleOffset = layer * 0.25;\n\n    for (let i = 0; i < petalsInLayer; i++) {\n      const angle = (i / petalsInLayer) * Math.PI * 2 + angleOffset;\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.rotate(angle);\n\n      // Pointed petal shape\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.bezierCurveTo(\n        layerSize * 0.15, -layerSize * 0.08,\n        layerSize * 0.35, -layerSize * 0.05,\n        layerSize * 0.45, 0\n      );\n      ctx.bezierCurveTo(\n        layerSize * 0.35, layerSize * 0.05,\n        layerSize * 0.15, layerSize * 0.08,\n        0, 0\n      );\n      ctx.fillStyle = color;\n      ctx.fill();\n      ctx.restore();\n    }\n  }\n\n  // Tight center\n  ctx.beginPath();\n  ctx.arc(x, y, s * 0.08, 0, Math.PI * 2);\n  ctx.fillStyle = '#DAA520';\n  ctx.fill();\n}\n\n/**\n * Category-based render function lookup\n * More efficient than a 100-case switch statement\n */\ntype CategoryRenderer = (\n  ctx: Ctx,\n  plant: PlantData,\n  width: number,\n  height: number,\n  time: number,\n  variation: PlantVariation\n) => void;\n\nconst categoryRenderers: Record<PlantCategory, CategoryRenderer> = {\n  [PlantCategory.SimpleFlower]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      2 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.leaf > 0) {\n      const leafY = baseY - plantHeight * 0.4 * phases.stem;\n      const leafX = x + plant.lean * variation.leanMultiplier * plantHeight * 0.4;\n      drawLeaf(ctx, leafX - 3, leafY, -0.5 - plant.lean, 15 * plant.scale * phases.leaf, plant.leafColor);\n      drawLeaf(ctx, leafX + 3, leafY + 5, 0.5 - plant.lean, 12 * plant.scale * phases.leaf, plant.leafColor);\n    }\n\n    if (top && phases.flower > 0) {\n      drawSimpleFlower(ctx, top.x, top.y, 18 * plant.scale, plant.flowerColor, plant.petals, phases.flower, variation);\n    }\n  },\n\n  [PlantCategory.Tulip]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      2.5 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * 0.5 * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.leaf > 0) {\n      const leafY = baseY - plantHeight * 0.2 * phases.stem;\n      drawLeaf(ctx, x - 2, leafY, -0.8, 25 * plant.scale * phases.leaf, plant.leafColor);\n      drawLeaf(ctx, x + 2, leafY, 0.8, 22 * plant.scale * phases.leaf, plant.leafColor);\n    }\n\n    if (top && phases.flower > 0) {\n      drawTulip(ctx, top.x, top.y, 22 * plant.scale, plant.flowerColor, phases.flower, variation);\n    }\n  },\n\n  [PlantCategory.Daisy]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      1.5 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.leaf > 0) {\n      const leafY = baseY - plantHeight * 0.3 * phases.stem;\n      const leafX = x + plant.lean * variation.leanMultiplier * plantHeight * 0.3;\n      drawLeaf(ctx, leafX, leafY, -0.3, 12 * plant.scale * phases.leaf, plant.leafColor);\n    }\n\n    if (top && phases.flower > 0) {\n      drawDaisy(ctx, top.x, top.y, 16 * plant.scale, plant.flowerColor, phases.flower, variation);\n    }\n  },\n\n  [PlantCategory.Wildflower]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight * 0.85,\n      1.5 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.flower > 0) {\n      drawWildflower(ctx, top.x, top.y, 14 * plant.scale, plant.flowerColor, phases.flower, variation);\n    }\n  },\n\n  [PlantCategory.Grass]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height;\n    const stemGrowth = Math.min(1, progress * 1.5);\n\n    drawGrass(ctx, x, baseY, plantHeight, plant.leafColor, plant.seed, stemGrowth, variation);\n  },\n\n  [PlantCategory.Fern]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height;\n    const stemGrowth = Math.min(1, progress * 1.5);\n\n    drawFern(ctx, x, baseY, plantHeight, plant.leafColor, plant.seed, stemGrowth, variation);\n  },\n\n  [PlantCategory.Bush]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height;\n\n    drawBush(\n      ctx,\n      x,\n      baseY - 5,\n      plantHeight * 0.7,\n      plant.leafColor,\n      plant.flowerColor,\n      plant.seed,\n      Math.min(1, progress * 1.2),\n      variation\n    );\n  },\n\n  [PlantCategory.Rose]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      2.5 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.leaf > 0) {\n      const leafY = baseY - plantHeight * 0.4 * phases.stem;\n      drawLeaf(ctx, x - 4, leafY, -0.6, 18 * plant.scale * phases.leaf, plant.leafColor);\n      drawLeaf(ctx, x + 4, leafY + 8, 0.6, 16 * plant.scale * phases.leaf, plant.leafColor);\n    }\n\n    if (top && phases.flower > 0) {\n      drawRose(ctx, top.x, top.y, 20 * plant.scale, plant.flowerColor, phases.flower, variation);\n    }\n  },\n\n  [PlantCategory.Lily]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      2 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.leaf > 0) {\n      const leafY = baseY - plantHeight * 0.3 * phases.stem;\n      drawLeaf(ctx, x - 2, leafY, -0.4, 20 * plant.scale * phases.leaf, plant.leafColor);\n      drawLeaf(ctx, x + 2, leafY + 10, 0.4, 18 * plant.scale * phases.leaf, plant.leafColor);\n    }\n\n    if (top && phases.flower > 0) {\n      drawLily(ctx, top.x, top.y, 22 * plant.scale, plant.flowerColor, phases.flower, variation);\n    }\n  },\n\n  [PlantCategory.Orchid]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      1.5 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.flower > 0) {\n      drawOrchid(ctx, top.x, top.y, 18 * plant.scale, plant.flowerColor, phases.flower, variation);\n    }\n  },\n\n  [PlantCategory.Succulent]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height;\n\n    drawSucculent(ctx, x, baseY - 5, plantHeight * 0.6, plant.leafColor, Math.min(1, progress * 1.2), variation);\n  },\n\n  [PlantCategory.Herb]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height;\n\n    drawLavender(ctx, x, baseY, plantHeight, plant.flowerColor, plant.seed, Math.min(1, progress * 1.3), variation);\n  },\n\n  [PlantCategory.Specialty]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      2.5 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier,\n      phases.stem\n    );\n\n    if (top && phases.leaf > 0) {\n      const leafY = baseY - plantHeight * 0.35 * phases.stem;\n      drawLeaf(ctx, x - 3, leafY, -0.5, 16 * plant.scale * phases.leaf, plant.leafColor);\n      drawLeaf(ctx, x + 3, leafY + 6, 0.5, 14 * plant.scale * phases.leaf, plant.leafColor);\n    }\n\n    if (top && phases.flower > 0) {\n      // Route to specific specialty flower renderer\n      switch (plant.type) {\n        case PlantType.Poppy:\n          drawPoppy(ctx, top.x, top.y, 18 * plant.scale, plant.flowerColor, phases.flower, variation);\n          break;\n        case PlantType.Sunflower:\n          drawSunflower(ctx, top.x, top.y, 25 * plant.scale, plant.flowerColor, phases.flower, variation);\n          break;\n        case PlantType.Iris:\n          drawIris(ctx, top.x, top.y, 20 * plant.scale, plant.flowerColor, phases.flower, variation);\n          break;\n        case PlantType.Peony:\n          drawPeony(ctx, top.x, top.y, 22 * plant.scale, plant.flowerColor, phases.flower, variation);\n          break;\n        case PlantType.Hydrangea:\n          drawHydrangea(ctx, top.x, top.y, 28 * plant.scale, plant.flowerColor, plant.seed, phases.flower, variation);\n          break;\n        case PlantType.Dahlia:\n          drawDahlia(ctx, top.x, top.y, 24 * plant.scale, plant.flowerColor, phases.flower, variation);\n          break;\n        default:\n          drawSimpleFlower(ctx, top.x, top.y, 18 * plant.scale, plant.flowerColor, plant.petals, phases.flower, variation);\n      }\n    }\n  },\n\n  // === TALL CATEGORIES ===\n\n  [PlantCategory.TallFlower]: (ctx, plant, width, height, time, variation) => {\n    const rc = createFloweringContext(plant, width, height, time, variation);\n    if (!rc) return;\n\n    const { x, baseY, plantHeight, phases } = rc;\n\n    // Draw main tall stem\n    const top = drawStem(\n      ctx, x, baseY, plantHeight,\n      3 * plant.scale * variation.thicknessMultiplier,\n      plant.stemColor,\n      plant.lean * variation.leanMultiplier * 0.5,\n      phases.stem\n    );\n\n    // Draw leaves along stem\n    if (phases.leaf > 0) {\n      const numLeaves = 3 + Math.floor(variation.complexity * 3);\n      for (let i = 0; i < numLeaves; i++) {\n        const t = 0.2 + (i / numLeaves) * 0.5;\n        const leafY = baseY - plantHeight * t * phases.stem;\n        const leafX = x + plant.lean * variation.leanMultiplier * plantHeight * t * 0.5;\n        const side = i % 2 === 0 ? -1 : 1;\n        drawLeaf(ctx, leafX, leafY, side * 0.6, 20 * plant.scale * phases.leaf, plant.leafColor);\n      }\n    }\n\n    // Draw multiple flowers along the stem (hollyhock style)\n    if (top && phases.flower > 0) {\n      const numFlowers = 4 + Math.floor(variation.complexity * 4);\n      for (let i = 0; i < numFlowers; i++) {\n        const t = 0.5 + (i / numFlowers) * 0.45;\n        const flowerY = baseY - plantHeight * t * phases.stem;\n        const flowerX = x + plant.lean * variation.leanMultiplier * plantHeight * t * 0.5;\n        const flowerSize = (8 + i * 1.5) * plant.scale * variation.sizeMultiplier;\n        const flowerGrowth = Math.max(0, (phases.flower - i * 0.08) * 1.5);\n        if (flowerGrowth > 0) {\n          drawSimpleFlower(ctx, flowerX, flowerY, flowerSize, plant.flowerColor, plant.petals, Math.min(1, flowerGrowth), variation);\n        }\n      }\n    }\n  },\n\n  [PlantCategory.GiantGrass]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height * variation.heightMultiplier;\n    const stemGrowth = Math.min(1, progress * 1.3);\n\n    // Draw bamboo-style segmented culms\n    const numCulms = 2 + Math.floor(variation.complexity * 3);\n    const rand = createRandom(plant.seed);\n\n    for (let c = 0; c < numCulms; c++) {\n      const offsetX = (rand() - 0.5) * 20 * variation.sizeMultiplier;\n      const culmHeight = plantHeight * (0.7 + rand() * 0.3) * stemGrowth;\n      const culmLean = (rand() - 0.5) * 0.15 * variation.leanMultiplier;\n\n      // Draw segmented culm\n      const segments = 4 + Math.floor(rand() * 4);\n      const segmentHeight = culmHeight / segments;\n\n      ctx.strokeStyle = plant.stemColor;\n      ctx.lineWidth = 3 * plant.scale * variation.thicknessMultiplier;\n      ctx.lineCap = 'round';\n\n      let currentY = baseY;\n      let currentX = x + offsetX;\n\n      for (let s = 0; s < segments; s++) {\n        const nextY = currentY - segmentHeight;\n        const nextX = currentX + culmLean * segmentHeight;\n\n        ctx.beginPath();\n        ctx.moveTo(currentX, currentY);\n        ctx.lineTo(nextX, nextY);\n        ctx.stroke();\n\n        // Draw node\n        if (s < segments - 1) {\n          ctx.beginPath();\n          ctx.arc(nextX, nextY, 4 * plant.scale, 0, Math.PI * 2);\n          ctx.fillStyle = plant.stemColor;\n          ctx.fill();\n        }\n\n        currentY = nextY;\n        currentX = nextX;\n      }\n\n      // Draw leaves at top\n      if (stemGrowth > 0.5) {\n        const leafGrowth = (stemGrowth - 0.5) * 2;\n        for (let l = 0; l < 3; l++) {\n          const angle = (l - 1) * 0.4 + culmLean;\n          drawLeaf(ctx, currentX, currentY, angle, 30 * plant.scale * leafGrowth, plant.leafColor);\n        }\n      }\n    }\n  },\n\n  [PlantCategory.Climber]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height * variation.heightMultiplier;\n    const stemGrowth = Math.min(1, progress * 1.2);\n\n    const rand = createRandom(plant.seed);\n\n    // Draw winding main vine\n    ctx.strokeStyle = plant.stemColor;\n    ctx.lineWidth = 2 * plant.scale * variation.thicknessMultiplier;\n    ctx.lineCap = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(x, baseY);\n\n    const segments = 8;\n    let prevX = x;\n    let prevY = baseY;\n\n    for (let i = 1; i <= segments; i++) {\n      const t = i / segments;\n      const targetY = baseY - plantHeight * t * stemGrowth;\n      const wave = Math.sin(t * Math.PI * 3) * 15 * variation.leanMultiplier;\n      const targetX = x + wave + plant.lean * plantHeight * t * 0.3;\n\n      ctx.quadraticCurveTo(\n        (prevX + targetX) / 2 + (rand() - 0.5) * 10,\n        (prevY + targetY) / 2,\n        targetX,\n        targetY\n      );\n\n      // Draw leaves\n      if (t > 0.1 && stemGrowth > t) {\n        const leafSize = 12 * plant.scale * Math.min(1, (stemGrowth - t) * 3);\n        if (i % 2 === 0) {\n          drawLeaf(ctx, targetX - 5, targetY, -0.8, leafSize, plant.leafColor);\n        } else {\n          drawLeaf(ctx, targetX + 5, targetY, 0.8, leafSize, plant.leafColor);\n        }\n      }\n\n      prevX = targetX;\n      prevY = targetY;\n    }\n\n    ctx.stroke();\n\n    // Draw flowers for flowering vines\n    if (stemGrowth > 0.6 && variation.complexity > 0.6) {\n      const flowerGrowth = (stemGrowth - 0.6) * 2.5;\n      const numFlowers = 3 + Math.floor(variation.petalCountModifier);\n      for (let f = 0; f < numFlowers; f++) {\n        const t = 0.3 + rand() * 0.5;\n        const fy = baseY - plantHeight * t * stemGrowth;\n        const fx = x + Math.sin(t * Math.PI * 3) * 15 * variation.leanMultiplier + plant.lean * plantHeight * t * 0.3;\n        drawSimpleFlower(ctx, fx, fy, 10 * plant.scale, plant.flowerColor, 5, Math.min(1, flowerGrowth), variation);\n      }\n    }\n  },\n\n  [PlantCategory.SmallTree]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height * variation.heightMultiplier;\n    const trunkGrowth = Math.min(1, progress * 1.2);\n    const foliageGrowth = Math.max(0, (progress - 0.4) * 1.7);\n\n    const rand = createRandom(plant.seed);\n\n    // Draw trunk\n    const trunkHeight = plantHeight * 0.6 * trunkGrowth;\n    const trunkWidth = 6 * plant.scale * variation.thicknessMultiplier;\n\n    ctx.fillStyle = plant.stemColor;\n    ctx.beginPath();\n    ctx.moveTo(x - trunkWidth / 2, baseY);\n    ctx.lineTo(x + trunkWidth / 2, baseY);\n    ctx.lineTo(x + trunkWidth / 4, baseY - trunkHeight);\n    ctx.lineTo(x - trunkWidth / 4, baseY - trunkHeight);\n    ctx.closePath();\n    ctx.fill();\n\n    // Draw branches and foliage\n    if (foliageGrowth > 0) {\n      const foliageY = baseY - trunkHeight;\n      const foliageRadius = 25 * plant.scale * variation.sizeMultiplier * foliageGrowth;\n\n      // Draw foliage clusters\n      const clusters = 5 + Math.floor(variation.complexity * 4);\n      for (let c = 0; c < clusters; c++) {\n        const angle = (c / clusters) * Math.PI * 2 + rand() * 0.5;\n        const dist = foliageRadius * (0.4 + rand() * 0.6);\n        const cx = x + Math.cos(angle) * dist * 0.8;\n        const cy = foliageY - Math.abs(Math.sin(angle)) * dist * 0.6 - foliageRadius * 0.3;\n        const clusterSize = foliageRadius * (0.4 + rand() * 0.3);\n\n        ctx.beginPath();\n        ctx.arc(cx, cy, clusterSize, 0, Math.PI * 2);\n        ctx.fillStyle = plant.leafColor;\n        ctx.fill();\n      }\n\n      // Draw flowers for ornamental/cherry blossom\n      if (variation.petalCountModifier > 4 && foliageGrowth > 0.5) {\n        const numFlowers = Math.floor(variation.petalCountModifier);\n        for (let f = 0; f < numFlowers; f++) {\n          const angle = rand() * Math.PI * 2;\n          const dist = foliageRadius * (0.5 + rand() * 0.5);\n          const fx = x + Math.cos(angle) * dist * 0.8;\n          const fy = foliageY - Math.abs(Math.sin(angle)) * dist * 0.6 - foliageRadius * 0.3;\n          drawSimpleFlower(ctx, fx, fy, 6 * plant.scale, plant.flowerColor, 5, foliageGrowth, variation);\n        }\n      }\n    }\n  },\n\n  [PlantCategory.Tropical]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height * variation.heightMultiplier;\n    const growth = Math.min(1, progress * 1.2);\n\n    const rand = createRandom(plant.seed);\n\n    // Draw trunk/stem\n    const trunkHeight = plantHeight * 0.5 * growth;\n    ctx.strokeStyle = plant.stemColor;\n    ctx.lineWidth = 5 * plant.scale * variation.thicknessMultiplier;\n    ctx.lineCap = 'round';\n\n    ctx.beginPath();\n    ctx.moveTo(x, baseY);\n    ctx.lineTo(x + plant.lean * trunkHeight * 0.3, baseY - trunkHeight);\n    ctx.stroke();\n\n    // Draw palm fronds\n    if (growth > 0.3) {\n      const frondGrowth = (growth - 0.3) * 1.4;\n      const numFronds = 5 + Math.floor(variation.complexity * 3);\n      const crownY = baseY - trunkHeight;\n      const crownX = x + plant.lean * trunkHeight * 0.3;\n\n      for (let f = 0; f < numFronds; f++) {\n        const angle = (f / numFronds) * Math.PI - Math.PI / 2 + (rand() - 0.5) * 0.3;\n        const frondLength = 35 * plant.scale * variation.sizeMultiplier * frondGrowth;\n        const droop = 0.3 + rand() * 0.3;\n\n        ctx.strokeStyle = plant.leafColor;\n        ctx.lineWidth = 2 * plant.scale;\n        ctx.beginPath();\n        ctx.moveTo(crownX, crownY);\n\n        const endX = crownX + Math.cos(angle) * frondLength;\n        const endY = crownY + Math.sin(angle) * frondLength * 0.5 + frondLength * droop;\n        const cpX = crownX + Math.cos(angle) * frondLength * 0.6;\n        const cpY = crownY + Math.sin(angle) * frondLength * 0.3;\n\n        ctx.quadraticCurveTo(cpX, cpY, endX, endY);\n        ctx.stroke();\n\n        // Draw leaflets along frond\n        const leaflets = 6;\n        for (let l = 1; l < leaflets; l++) {\n          const t = l / leaflets;\n          const lx = crownX + (endX - crownX) * t * 0.8;\n          const ly = crownY + (endY - crownY) * t * 0.5 + frondLength * droop * t * t;\n          const leafletSize = 8 * plant.scale * (1 - t * 0.5) * frondGrowth;\n          drawLeaf(ctx, lx, ly, angle + (l % 2 === 0 ? 0.5 : -0.5), leafletSize, plant.leafColor);\n        }\n      }\n    }\n  },\n\n  [PlantCategory.Conifer]: (ctx, plant, width, height, time, variation) => {\n    const progress = (time - plant.delay) / plant.growDuration;\n    if (progress <= 0) return;\n\n    const x = plant.x * width;\n    const baseY = height;\n    const plantHeight = plant.maxHeight * height * variation.heightMultiplier;\n    const growth = Math.min(1, progress * 1.2);\n\n    // Draw trunk\n    const trunkHeight = plantHeight * growth;\n    const trunkWidth = 4 * plant.scale * variation.thicknessMultiplier;\n\n    ctx.fillStyle = plant.stemColor;\n    ctx.beginPath();\n    ctx.moveTo(x - trunkWidth / 2, baseY);\n    ctx.lineTo(x + trunkWidth / 2, baseY);\n    ctx.lineTo(x + trunkWidth / 4, baseY - trunkHeight);\n    ctx.lineTo(x - trunkWidth / 4, baseY - trunkHeight);\n    ctx.closePath();\n    ctx.fill();\n\n    // Draw conical foliage layers\n    if (growth > 0.2) {\n      const foliageGrowth = (growth - 0.2) * 1.25;\n      const layers = 4 + Math.floor(variation.complexity * 3);\n      const baseWidth = 20 * plant.scale * variation.sizeMultiplier;\n\n      ctx.fillStyle = plant.leafColor;\n\n      for (let l = 0; l < layers; l++) {\n        const t = l / layers;\n        const layerY = baseY - trunkHeight * (0.2 + t * 0.75);\n        const layerWidth = baseWidth * (1 - t * 0.7) * foliageGrowth;\n        const layerHeight = plantHeight * 0.15 * (1 - t * 0.3);\n\n        ctx.beginPath();\n        ctx.moveTo(x, layerY - layerHeight);\n        ctx.lineTo(x - layerWidth, layerY);\n        ctx.lineTo(x + layerWidth, layerY);\n        ctx.closePath();\n        ctx.fill();\n      }\n    }\n  },\n};\n\n/**\n * Main plant rendering function\n * Uses category-based dispatch for O(1) lookup\n * Optimized to use cached category/variation when available\n */\nexport function drawPlant(\n  ctx: Ctx,\n  plant: PlantData,\n  width: number,\n  height: number,\n  time: number\n): void {\n  // Use cached values for O(1) lookup, fall back to function calls if not cached\n  const category = plant.category ?? getPlantCategory(plant.type);\n  const variation = plant.variation ?? getPlantVariation(plant.type);\n  const renderer = categoryRenderers[category];\n  renderer(ctx, plant, width, height, time, variation);\n}\n","import type { PlantData, ResolvedOptions } from './types';\nimport { drawPlant } from './plants';\nimport { getPixelRatio, debounce, hexToRgb, DebouncedFunction } from './utils';\n\n/**\n * Handles canvas setup, resizing, and rendering\n */\nexport class Renderer {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private container: HTMLElement;\n  private options: ResolvedOptions;\n  private resizeObserver: ResizeObserver | null = null;\n  private resizeHandler: (() => void) | null = null;\n  private debouncedResize: DebouncedFunction<() => void> | null = null;\n  private dpr: number = 1;\n  private width: number = 0;\n  private height: number = 0;\n\n  constructor(options: ResolvedOptions) {\n    this.options = options;\n    this.container = options.container;\n\n    // Create canvas with configurable z-index and opacity\n    this.canvas = document.createElement('canvas');\n    this.canvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: ${options.zIndex};\n      opacity: ${options.opacity};\n    `;\n\n    // Set accessibility attributes\n    this.canvas.setAttribute('aria-hidden', 'true');\n    this.canvas.setAttribute('role', 'presentation');\n\n    // Get context\n    const ctx = this.canvas.getContext('2d');\n    if (!ctx) {\n      throw new Error('Garten: Could not get 2D context');\n    }\n    this.ctx = ctx;\n\n    // Setup container\n    this.setupContainer();\n\n    // Insert canvas\n    this.container.insertBefore(this.canvas, this.container.firstChild);\n\n    // Initial sizing\n    this.resize();\n\n    // Setup resize observer\n    this.setupResizeObserver();\n  }\n\n  /**\n   * Ensure container has proper positioning\n   */\n  private setupContainer(): void {\n    const style = window.getComputedStyle(this.container);\n    if (style.position === 'static') {\n      this.container.style.position = 'relative';\n    }\n  }\n\n  /**\n   * Setup resize observer for responsive sizing\n   */\n  private setupResizeObserver(): void {\n    this.debouncedResize = debounce(() => this.resize(), 100);\n\n    if (typeof ResizeObserver !== 'undefined') {\n      this.resizeObserver = new ResizeObserver(this.debouncedResize);\n      this.resizeObserver.observe(this.container);\n    } else {\n      // Fallback for older browsers - store handler for cleanup\n      this.resizeHandler = this.debouncedResize;\n      window.addEventListener('resize', this.resizeHandler);\n    }\n  }\n\n  /**\n   * Handle resize\n   */\n  resize(): void {\n    this.dpr = getPixelRatio(this.options.maxPixelRatio);\n    \n    const rect = this.container.getBoundingClientRect();\n    this.width = rect.width;\n    this.height = rect.height;\n\n    this.canvas.width = this.width * this.dpr;\n    this.canvas.height = this.height * this.dpr;\n\n    // Reset transform and scale for DPR\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.ctx.scale(this.dpr, this.dpr);\n  }\n\n  /**\n   * Clear the canvas\n   */\n  clear(): void {\n    this.ctx.fillStyle = '#ffffff';\n    this.ctx.fillRect(0, 0, this.width, this.height);\n  }\n\n  /**\n   * Draw ground indicator\n   */\n  drawGround(): void {\n    this.ctx.fillStyle = 'rgba(139, 119, 101, 0.08)';\n    this.ctx.fillRect(0, this.height - 8, this.width, 8);\n  }\n\n  /**\n   * Apply vertical gradient fade to make plants fade out at higher positions\n   * This improves content legibility when plants might obscure page content\n   */\n  private applyVerticalFade(): void {\n    const { fadeHeight, fadeColor, maxHeight } = this.options;\n    if (fadeHeight <= 0) return;\n\n    // Parse fade color to RGB\n    const rgb = hexToRgb(fadeColor);\n    if (!rgb) return;\n\n    // Calculate fade zone positions\n    // Plants grow from bottom, so fade starts at (1 - maxHeight) from top\n    const plantTopY = this.height * (1 - maxHeight);\n    const fadeStartY = plantTopY;\n    const fadeEndY = Math.max(0, plantTopY - this.height * fadeHeight);\n\n    // Create gradient from fade color (opaque) to transparent\n    const gradient = this.ctx.createLinearGradient(0, fadeEndY, 0, fadeStartY);\n    gradient.addColorStop(0, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 1)`);\n    gradient.addColorStop(1, `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0)`);\n\n    // Apply fade using destination-out composite\n    this.ctx.globalCompositeOperation = 'destination-out';\n    this.ctx.fillStyle = gradient;\n    this.ctx.fillRect(0, 0, this.width, fadeStartY);\n    this.ctx.globalCompositeOperation = 'source-over';\n  }\n\n  /**\n   * Render all plants\n   * Pre-filters plants that haven't started growing to avoid unnecessary draw calls\n   */\n  render(plants: PlantData[], time: number): void {\n    this.clear();\n    this.drawGround();\n\n    for (const plant of plants) {\n      // Skip plants that haven't started growing yet\n      if (time < plant.delay) continue;\n      drawPlant(this.ctx, plant, this.width, this.height, time);\n    }\n\n    // Apply vertical fade if configured\n    this.applyVerticalFade();\n  }\n\n  /**\n   * Render a static frame (for reduced motion)\n   */\n  renderStatic(plants: PlantData[], progress: number): void {\n    const staticTime = progress * this.options.duration;\n    this.render(plants, staticTime);\n  }\n\n  /**\n   * Get canvas dimensions\n   */\n  getDimensions(): { width: number; height: number } {\n    return { width: this.width, height: this.height };\n  }\n\n  /**\n   * Get the canvas element\n   */\n  getCanvas(): HTMLCanvasElement {\n    return this.canvas;\n  }\n\n  /**\n   * Update options\n   */\n  setOptions(options: ResolvedOptions): void {\n    this.options = options;\n\n    // Update canvas style if z-index or opacity changed\n    this.canvas.style.zIndex = String(options.zIndex);\n    this.canvas.style.opacity = String(options.opacity);\n\n    this.resize();\n  }\n\n  /**\n   * Clean up resources\n   */\n  destroy(): void {\n    // Cancel any pending debounced resize\n    if (this.debouncedResize) {\n      this.debouncedResize.cancel();\n      this.debouncedResize = null;\n    }\n\n    // Clean up ResizeObserver\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n      this.resizeObserver = null;\n    }\n\n    // Clean up window resize listener (fallback for older browsers)\n    if (this.resizeHandler) {\n      window.removeEventListener('resize', this.resizeHandler);\n      this.resizeHandler = null;\n    }\n\n    // Remove canvas from DOM\n    if (this.canvas.parentNode) {\n      this.canvas.parentNode.removeChild(this.canvas);\n    }\n  }\n}\n","import type {\n  GardenOptions,\n  GardenController,\n  PlaybackState,\n  PlantData,\n  ResolvedOptions,\n} from './types';\nimport { resolveOptions } from './defaults';\nimport { generatePlants, didGenerationComplete } from './plants';\nimport { Renderer } from './Renderer';\nimport { prefersReducedMotion } from './utils';\n\n/**\n * Garten - A beautiful animated garden for your website\n *\n * @example\n * ```typescript\n * const garden = new Garten({\n *   container: '#my-container',\n *   duration: 600,\n *   generations: 47,\n * });\n *\n * garden.play();\n * ```\n */\nexport class Garten implements GardenController {\n  private options: ResolvedOptions;\n  private renderer!: Renderer;\n  private plants: PlantData[] = [];\n\n  private state: PlaybackState = 'idle';\n  private animationId: number | null = null;\n  private startTime: number = 0;\n  private pausedAt: number = 0;\n  private elapsedTime: number = 0;\n  private speed: number = 1;\n  private lastFrameTime: number = 0;\n  private frameInterval: number;\n  private lastReportedGeneration: number = -1;\n\n  constructor(options: GardenOptions) {\n    // Resolve and validate options\n    this.options = resolveOptions(options);\n    this.speed = this.options.speed;\n    this.frameInterval = 1000 / this.options.targetFPS;\n\n    // Check for reduced motion preference\n    if (this.options.respectReducedMotion && prefersReducedMotion()) {\n      this.handleReducedMotion();\n      return;\n    }\n\n    // Initialize renderer\n    this.renderer = new Renderer(this.options);\n\n    // Generate plants\n    this.plants = generatePlants(this.options);\n\n    // Auto-play if enabled\n    if (this.options.autoplay) {\n      this.play();\n    }\n  }\n\n  /**\n   * Handle reduced motion preference\n   */\n  private handleReducedMotion(): void {\n    this.renderer = new Renderer(this.options);\n    this.plants = generatePlants(this.options);\n\n    // Render a static frame at 100% progress\n    this.renderer.renderStatic(this.plants, 1);\n    this.state = 'complete';\n    this.emitStateChange();\n  }\n\n  /**\n   * Animation loop\n   */\n  private tick = (timestamp: number): void => {\n    if (this.state !== 'playing') return;\n\n    // Throttle to target FPS\n    if (timestamp - this.lastFrameTime < this.frameInterval) {\n      this.animationId = requestAnimationFrame(this.tick);\n      return;\n    }\n    this.lastFrameTime = timestamp;\n\n    // Calculate elapsed time\n    const previousElapsed = this.elapsedTime;\n    this.elapsedTime = (timestamp - this.startTime) * this.speed / 1000;\n\n    // Check for generation completion\n    const completedGen = didGenerationComplete(\n      previousElapsed,\n      this.elapsedTime,\n      this.options.duration,\n      this.options.generations\n    );\n    if (completedGen !== null && completedGen > this.lastReportedGeneration) {\n      this.lastReportedGeneration = completedGen;\n      this.options.events.onGenerationComplete?.(completedGen, this.options.generations);\n    }\n\n    // Emit progress\n    const progress = Math.min(1, this.elapsedTime / this.options.duration);\n    this.options.events.onProgress?.(progress, this.elapsedTime);\n\n    // Render frame\n    this.renderer.render(this.plants, this.elapsedTime);\n\n    // Check for completion\n    if (this.elapsedTime >= this.options.duration) {\n      if (this.options.loop) {\n        // Reset for loop\n        this.startTime = timestamp;\n        this.elapsedTime = 0;\n        this.lastReportedGeneration = -1;\n      } else {\n        this.state = 'complete';\n        this.emitStateChange();\n        this.options.events.onComplete?.();\n        return;\n      }\n    }\n\n    // Continue animation\n    this.animationId = requestAnimationFrame(this.tick);\n  };\n\n  /**\n   * Emit state change event\n   */\n  private emitStateChange(): void {\n    this.options.events.onStateChange?.(this.state);\n  }\n\n  /**\n   * Start or resume playback\n   */\n  play(): void {\n    if (this.state === 'playing') return;\n\n    if (this.state === 'paused') {\n      // Resume from paused position\n      this.startTime = performance.now() - (this.pausedAt * 1000 / this.speed);\n    } else {\n      // Start fresh\n      this.startTime = performance.now();\n      this.elapsedTime = 0;\n      this.lastReportedGeneration = -1;\n    }\n\n    this.state = 'playing';\n    this.emitStateChange();\n    this.lastFrameTime = performance.now();\n    this.animationId = requestAnimationFrame(this.tick);\n  }\n\n  /**\n   * Pause playback\n   */\n  pause(): void {\n    if (this.state !== 'playing') return;\n\n    if (this.animationId !== null) {\n      cancelAnimationFrame(this.animationId);\n      this.animationId = null;\n    }\n\n    this.pausedAt = this.elapsedTime;\n    this.state = 'paused';\n    this.emitStateChange();\n  }\n\n  /**\n   * Stop and reset to beginning\n   */\n  stop(): void {\n    if (this.animationId !== null) {\n      cancelAnimationFrame(this.animationId);\n      this.animationId = null;\n    }\n\n    this.elapsedTime = 0;\n    this.pausedAt = 0;\n    this.lastReportedGeneration = -1;\n    this.state = 'idle';\n    this.emitStateChange();\n\n    // Render initial state\n    this.renderer.render(this.plants, 0);\n  }\n\n  /**\n   * Jump to specific time in seconds\n   */\n  seek(time: number): void {\n    const clampedTime = Math.max(0, Math.min(time, this.options.duration));\n\n    if (this.state === 'playing') {\n      this.startTime = performance.now() - (clampedTime * 1000 / this.speed);\n    } else {\n      this.pausedAt = clampedTime;\n    }\n\n    this.elapsedTime = clampedTime;\n\n    // Update generation tracking\n    const currentGen = Math.floor(clampedTime / (this.options.duration / this.options.generations));\n    this.lastReportedGeneration = currentGen - 1;\n\n    // Render at new position\n    this.renderer.render(this.plants, clampedTime);\n  }\n\n  /**\n   * Set playback speed multiplier\n   */\n  setSpeed(speed: number): void {\n    if (speed <= 0) {\n      throw new Error('Garten: Speed must be positive');\n    }\n\n    const wasPlaying = this.state === 'playing';\n\n    if (wasPlaying) {\n      // Pause to recalculate timing\n      this.pause();\n    }\n\n    this.speed = speed;\n\n    if (wasPlaying) {\n      this.play();\n    }\n  }\n\n  /**\n   * Get current playback state\n   */\n  getState(): PlaybackState {\n    return this.state;\n  }\n\n  /**\n   * Get current progress (0-1)\n   */\n  getProgress(): number {\n    return Math.min(1, this.elapsedTime / this.options.duration);\n  }\n\n  /**\n   * Get elapsed time in seconds\n   */\n  getElapsedTime(): number {\n    return this.elapsedTime;\n  }\n\n  /**\n   * Update options\n   */\n  setOptions(newOptions: Partial<GardenOptions>): void {\n    const needsRegeneration =\n      newOptions.generations !== undefined ||\n      newOptions.density !== undefined ||\n      newOptions.maxHeight !== undefined ||\n      newOptions.colors !== undefined ||\n      newOptions.seed !== undefined;\n\n    // Merge options\n    this.options = resolveOptions({\n      container: this.options.container,\n      ...newOptions,\n    });\n\n    // Update renderer\n    this.renderer.setOptions(this.options);\n\n    // Regenerate if needed\n    if (needsRegeneration) {\n      this.regenerate();\n    }\n\n    // Update speed if changed\n    if (newOptions.speed !== undefined) {\n      this.setSpeed(newOptions.speed);\n    }\n  }\n\n  /**\n   * Force regenerate all plants\n   */\n  regenerate(): void {\n    const wasPlaying = this.state === 'playing';\n    if (wasPlaying) {\n      this.pause();\n    }\n\n    this.plants = generatePlants(this.options);\n\n    // Re-render at current position\n    this.renderer.render(this.plants, this.elapsedTime);\n\n    if (wasPlaying) {\n      this.play();\n    }\n  }\n\n  /**\n   * Clean up and remove from DOM\n   */\n  destroy(): void {\n    // Stop animation\n    if (this.animationId !== null) {\n      cancelAnimationFrame(this.animationId);\n      this.animationId = null;\n    }\n\n    // Clean up renderer\n    this.renderer.destroy();\n\n    // Clear state\n    this.plants = [];\n    this.state = 'idle';\n  }\n}\n","/**\n * Color Value Object - Encapsulates color operations and manipulation\n * Provides immutable color representation with utility methods\n */\n\n/**\n * RGB color components\n */\nexport interface RGB {\n  r: number;\n  g: number;\n  b: number;\n}\n\n/**\n * HSL color components\n */\nexport interface HSL {\n  h: number;\n  s: number;\n  l: number;\n}\n\n/**\n * Color value object with comprehensive color manipulation utilities\n * Immutable - all operations return new Color instances\n */\nexport class Color {\n  private readonly _r: number;\n  private readonly _g: number;\n  private readonly _b: number;\n  private readonly _a: number;\n  private _hexCache: string | null = null;\n\n  /**\n   * Create a Color from RGB values\n   * @param r Red component (0-255)\n   * @param g Green component (0-255)\n   * @param b Blue component (0-255)\n   * @param a Alpha component (0-1), defaults to 1\n   */\n  constructor(r: number, g: number, b: number, a: number = 1) {\n    this._r = Math.round(Math.max(0, Math.min(255, r)));\n    this._g = Math.round(Math.max(0, Math.min(255, g)));\n    this._b = Math.round(Math.max(0, Math.min(255, b)));\n    this._a = Math.max(0, Math.min(1, a));\n  }\n\n  // ==================== GETTERS ====================\n\n  get r(): number {\n    return this._r;\n  }\n\n  get g(): number {\n    return this._g;\n  }\n\n  get b(): number {\n    return this._b;\n  }\n\n  get a(): number {\n    return this._a;\n  }\n\n  get rgb(): RGB {\n    return { r: this._r, g: this._g, b: this._b };\n  }\n\n  // ==================== STATIC FACTORIES ====================\n\n  /**\n   * Create a Color from a hex string\n   * Supports #RGB, #RRGGBB, and #RRGGBBAA formats\n   */\n  static fromHex(hex: string): Color | null {\n    const cleaned = hex.replace('#', '');\n\n    let r: number, g: number, b: number, a: number = 255;\n\n    if (cleaned.length === 3) {\n      // #RGB format\n      r = parseInt(cleaned[0] + cleaned[0], 16);\n      g = parseInt(cleaned[1] + cleaned[1], 16);\n      b = parseInt(cleaned[2] + cleaned[2], 16);\n    } else if (cleaned.length === 6) {\n      // #RRGGBB format\n      r = parseInt(cleaned.substring(0, 2), 16);\n      g = parseInt(cleaned.substring(2, 4), 16);\n      b = parseInt(cleaned.substring(4, 6), 16);\n    } else if (cleaned.length === 8) {\n      // #RRGGBBAA format\n      r = parseInt(cleaned.substring(0, 2), 16);\n      g = parseInt(cleaned.substring(2, 4), 16);\n      b = parseInt(cleaned.substring(4, 6), 16);\n      a = parseInt(cleaned.substring(6, 8), 16);\n    } else {\n      return null;\n    }\n\n    if (isNaN(r) || isNaN(g) || isNaN(b) || isNaN(a)) {\n      return null;\n    }\n\n    return new Color(r, g, b, a / 255);\n  }\n\n  /**\n   * Create a Color from RGB object\n   */\n  static fromRGB(rgb: RGB, alpha: number = 1): Color {\n    return new Color(rgb.r, rgb.g, rgb.b, alpha);\n  }\n\n  /**\n   * Create a Color from HSL values\n   * @param h Hue (0-360)\n   * @param s Saturation (0-100)\n   * @param l Lightness (0-100)\n   * @param a Alpha (0-1)\n   */\n  static fromHSL(h: number, s: number, l: number, a: number = 1): Color {\n    const sNorm = s / 100;\n    const lNorm = l / 100;\n\n    const c = (1 - Math.abs(2 * lNorm - 1)) * sNorm;\n    const x = c * (1 - Math.abs(((h / 60) % 2) - 1));\n    const m = lNorm - c / 2;\n\n    let r = 0, g = 0, b = 0;\n\n    if (h < 60) {\n      r = c; g = x; b = 0;\n    } else if (h < 120) {\n      r = x; g = c; b = 0;\n    } else if (h < 180) {\n      r = 0; g = c; b = x;\n    } else if (h < 240) {\n      r = 0; g = x; b = c;\n    } else if (h < 300) {\n      r = x; g = 0; b = c;\n    } else {\n      r = c; g = 0; b = x;\n    }\n\n    return new Color(\n      (r + m) * 255,\n      (g + m) * 255,\n      (b + m) * 255,\n      a\n    );\n  }\n\n  /**\n   * Parse a color string (hex, rgb, rgba, hsl, hsla)\n   */\n  static parse(str: string): Color | null {\n    str = str.trim().toLowerCase();\n\n    // Hex format\n    if (str.startsWith('#')) {\n      return Color.fromHex(str);\n    }\n\n    // RGB/RGBA format\n    const rgbMatch = str.match(/rgba?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*([\\d.]+))?\\s*\\)/);\n    if (rgbMatch) {\n      return new Color(\n        parseInt(rgbMatch[1]),\n        parseInt(rgbMatch[2]),\n        parseInt(rgbMatch[3]),\n        rgbMatch[4] ? parseFloat(rgbMatch[4]) : 1\n      );\n    }\n\n    // HSL/HSLA format\n    const hslMatch = str.match(/hsla?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)%?\\s*,\\s*(\\d+)%?\\s*(?:,\\s*([\\d.]+))?\\s*\\)/);\n    if (hslMatch) {\n      return Color.fromHSL(\n        parseInt(hslMatch[1]),\n        parseInt(hslMatch[2]),\n        parseInt(hslMatch[3]),\n        hslMatch[4] ? parseFloat(hslMatch[4]) : 1\n      );\n    }\n\n    return null;\n  }\n\n  // ==================== CONVERSION METHODS ====================\n\n  /**\n   * Convert to hex string (#RRGGBB or #RRGGBBAA)\n   */\n  toHex(includeAlpha: boolean = false): string {\n    if (!includeAlpha && this._hexCache) {\n      return this._hexCache;\n    }\n\n    const hex = '#' +\n      this._r.toString(16).padStart(2, '0') +\n      this._g.toString(16).padStart(2, '0') +\n      this._b.toString(16).padStart(2, '0') +\n      (includeAlpha ? Math.round(this._a * 255).toString(16).padStart(2, '0') : '');\n\n    if (!includeAlpha) {\n      this._hexCache = hex;\n    }\n\n    return hex;\n  }\n\n  /**\n   * Convert to rgb() or rgba() CSS string\n   */\n  toRGBString(forceAlpha: boolean = false): string {\n    if (this._a < 1 || forceAlpha) {\n      return `rgba(${this._r}, ${this._g}, ${this._b}, ${this._a})`;\n    }\n    return `rgb(${this._r}, ${this._g}, ${this._b})`;\n  }\n\n  /**\n   * Convert to HSL object\n   */\n  toHSL(): HSL {\n    const r = this._r / 255;\n    const g = this._g / 255;\n    const b = this._b / 255;\n\n    const max = Math.max(r, g, b);\n    const min = Math.min(r, g, b);\n    const l = (max + min) / 2;\n\n    if (max === min) {\n      return { h: 0, s: 0, l: l * 100 };\n    }\n\n    const d = max - min;\n    const s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n    let h = 0;\n    if (max === r) {\n      h = ((g - b) / d + (g < b ? 6 : 0)) / 6;\n    } else if (max === g) {\n      h = ((b - r) / d + 2) / 6;\n    } else {\n      h = ((r - g) / d + 4) / 6;\n    }\n\n    return {\n      h: h * 360,\n      s: s * 100,\n      l: l * 100,\n    };\n  }\n\n  // ==================== MANIPULATION METHODS ====================\n\n  /**\n   * Lighten the color by a given amount\n   * @param amount Amount to lighten (0-1)\n   */\n  lighten(amount: number): Color {\n    return new Color(\n      this._r + (255 - this._r) * amount,\n      this._g + (255 - this._g) * amount,\n      this._b + (255 - this._b) * amount,\n      this._a\n    );\n  }\n\n  /**\n   * Darken the color by a given amount\n   * @param amount Amount to darken (0-1)\n   */\n  darken(amount: number): Color {\n    return new Color(\n      this._r * (1 - amount),\n      this._g * (1 - amount),\n      this._b * (1 - amount),\n      this._a\n    );\n  }\n\n  /**\n   * Set the alpha value\n   * @param alpha New alpha value (0-1)\n   */\n  withAlpha(alpha: number): Color {\n    return new Color(this._r, this._g, this._b, alpha);\n  }\n\n  /**\n   * Mix with another color\n   * @param other The color to mix with\n   * @param amount Mix ratio (0 = this, 1 = other)\n   */\n  mix(other: Color, amount: number = 0.5): Color {\n    const t = Math.max(0, Math.min(1, amount));\n    return new Color(\n      this._r + (other._r - this._r) * t,\n      this._g + (other._g - this._g) * t,\n      this._b + (other._b - this._b) * t,\n      this._a + (other._a - this._a) * t\n    );\n  }\n\n  /**\n   * Get the complementary color\n   */\n  complement(): Color {\n    return new Color(255 - this._r, 255 - this._g, 255 - this._b, this._a);\n  }\n\n  /**\n   * Saturate the color\n   * @param amount Amount to saturate (0-1)\n   */\n  saturate(amount: number): Color {\n    const hsl = this.toHSL();\n    hsl.s = Math.min(100, hsl.s + amount * 100);\n    return Color.fromHSL(hsl.h, hsl.s, hsl.l, this._a);\n  }\n\n  /**\n   * Desaturate the color\n   * @param amount Amount to desaturate (0-1)\n   */\n  desaturate(amount: number): Color {\n    const hsl = this.toHSL();\n    hsl.s = Math.max(0, hsl.s - amount * 100);\n    return Color.fromHSL(hsl.h, hsl.s, hsl.l, this._a);\n  }\n\n  /**\n   * Rotate the hue\n   * @param degrees Degrees to rotate\n   */\n  rotateHue(degrees: number): Color {\n    const hsl = this.toHSL();\n    hsl.h = (hsl.h + degrees) % 360;\n    if (hsl.h < 0) hsl.h += 360;\n    return Color.fromHSL(hsl.h, hsl.s, hsl.l, this._a);\n  }\n\n  /**\n   * Get the perceived luminance (for contrast calculations)\n   * Uses the WCAG formula\n   */\n  luminance(): number {\n    const rsRGB = this._r / 255;\n    const gsRGB = this._g / 255;\n    const bsRGB = this._b / 255;\n\n    const r = rsRGB <= 0.03928 ? rsRGB / 12.92 : Math.pow((rsRGB + 0.055) / 1.055, 2.4);\n    const g = gsRGB <= 0.03928 ? gsRGB / 12.92 : Math.pow((gsRGB + 0.055) / 1.055, 2.4);\n    const b = bsRGB <= 0.03928 ? bsRGB / 12.92 : Math.pow((bsRGB + 0.055) / 1.055, 2.4);\n\n    return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  }\n\n  /**\n   * Calculate contrast ratio with another color\n   * Returns a value between 1 (no contrast) and 21 (maximum contrast)\n   */\n  contrastWith(other: Color): number {\n    const l1 = this.luminance();\n    const l2 = other.luminance();\n    const lighter = Math.max(l1, l2);\n    const darker = Math.min(l1, l2);\n    return (lighter + 0.05) / (darker + 0.05);\n  }\n\n  /**\n   * Determine if the color is light\n   */\n  isLight(): boolean {\n    return this.luminance() > 0.5;\n  }\n\n  /**\n   * Determine if the color is dark\n   */\n  isDark(): boolean {\n    return this.luminance() <= 0.5;\n  }\n\n  // ==================== COMPARISON METHODS ====================\n\n  /**\n   * Check if this color equals another\n   */\n  equals(other: Color): boolean {\n    return (\n      this._r === other._r &&\n      this._g === other._g &&\n      this._b === other._b &&\n      this._a === other._a\n    );\n  }\n\n  /**\n   * Check if this color is approximately equal to another\n   * Useful for comparing colors after manipulation\n   * @param other Color to compare with\n   * @param tolerance Maximum difference allowed per channel (0-255 for RGB, 0-1 for alpha)\n   */\n  approximatelyEquals(other: Color, tolerance: number = 1): boolean {\n    return (\n      Math.abs(this._r - other._r) <= tolerance &&\n      Math.abs(this._g - other._g) <= tolerance &&\n      Math.abs(this._b - other._b) <= tolerance &&\n      Math.abs(this._a - other._a) <= tolerance / 255\n    );\n  }\n\n  /**\n   * Clone this color\n   */\n  clone(): Color {\n    return new Color(this._r, this._g, this._b, this._a);\n  }\n\n  /**\n   * Get a string representation\n   */\n  toString(): string {\n    return this.toHex(this._a < 1);\n  }\n\n  // ==================== STATIC COLOR CONSTANTS ====================\n\n  static readonly WHITE = new Color(255, 255, 255);\n  static readonly BLACK = new Color(0, 0, 0);\n  static readonly TRANSPARENT = new Color(0, 0, 0, 0);\n  static readonly RED = new Color(255, 0, 0);\n  static readonly GREEN = new Color(0, 255, 0);\n  static readonly BLUE = new Color(0, 0, 255);\n}\n\n/**\n * Utility function for backward compatibility with existing code\n * Parses hex to RGB\n */\nexport function hexToRgb(hex: string): RGB | null {\n  const color = Color.fromHex(hex);\n  return color ? color.rgb : null;\n}\n\n/**\n * Utility function for backward compatibility\n * Converts RGB to hex\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  return new Color(r, g, b).toHex();\n}\n\n/**\n * Utility function for backward compatibility\n * Lightens a hex color\n */\nexport function lightenColor(hex: string, amount: number): string {\n  const color = Color.fromHex(hex);\n  if (!color) return hex;\n  return color.lighten(amount).toHex();\n}\n\n/**\n * Utility function for backward compatibility\n * Darkens a hex color\n */\nexport function darkenColor(hex: string, amount: number): string {\n  const color = Color.fromHex(hex);\n  if (!color) return hex;\n  return color.darken(amount).toHex();\n}\n","/**\n * Vec2 Value Object - 2D point/vector representation\n * Provides immutable point operations commonly used in canvas rendering\n */\n\n/**\n * Simple point interface for interoperability\n */\nexport interface Point {\n  x: number;\n  y: number;\n}\n\n/**\n * 2D Vector value object with comprehensive vector operations\n * Immutable - all operations return new Vec2 instances\n */\nexport class Vec2 implements Point {\n  readonly x: number;\n  readonly y: number;\n\n  // Reusable temporary vector for output parameters to reduce allocations\n  private static _tempVec: Vec2 = new Vec2(0, 0);\n\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n  }\n\n  // ==================== STATIC FACTORIES ====================\n\n  /**\n   * Create a Vec2 from a Point-like object\n   */\n  static from(point: Point): Vec2 {\n    return new Vec2(point.x, point.y);\n  }\n\n  /**\n   * Create a Vec2 from an array [x, y]\n   */\n  static fromArray(arr: [number, number]): Vec2 {\n    return new Vec2(arr[0], arr[1]);\n  }\n\n  /**\n   * Create a Vec2 from polar coordinates\n   * @param angle Angle in radians\n   * @param length Length (radius)\n   */\n  static fromPolar(angle: number, length: number): Vec2 {\n    return new Vec2(\n      Math.cos(angle) * length,\n      Math.sin(angle) * length\n    );\n  }\n\n  /**\n   * Create a zero vector\n   */\n  static zero(): Vec2 {\n    return new Vec2(0, 0);\n  }\n\n  /**\n   * Create a unit vector pointing up (negative Y in canvas coordinates)\n   */\n  static up(): Vec2 {\n    return new Vec2(0, -1);\n  }\n\n  /**\n   * Create a unit vector pointing down\n   */\n  static down(): Vec2 {\n    return new Vec2(0, 1);\n  }\n\n  /**\n   * Create a unit vector pointing left\n   */\n  static left(): Vec2 {\n    return new Vec2(-1, 0);\n  }\n\n  /**\n   * Create a unit vector pointing right\n   */\n  static right(): Vec2 {\n    return new Vec2(1, 0);\n  }\n\n  /**\n   * Linear interpolation between two vectors\n   * @param a Start vector\n   * @param b End vector\n   * @param t Interpolation factor (0-1)\n   */\n  static lerp(a: Vec2, b: Vec2, t: number): Vec2 {\n    return new Vec2(\n      a.x + (b.x - a.x) * t,\n      a.y + (b.y - a.y) * t\n    );\n  }\n\n  /**\n   * Get distance between two points\n   */\n  static distance(a: Point, b: Point): number {\n    const dx = b.x - a.x;\n    const dy = b.y - a.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Get squared distance between two points (faster, no sqrt)\n   */\n  static distanceSquared(a: Point, b: Point): number {\n    const dx = b.x - a.x;\n    const dy = b.y - a.y;\n    return dx * dx + dy * dy;\n  }\n\n  /**\n   * Get angle from point a to point b\n   */\n  static angleBetween(a: Point, b: Point): number {\n    return Math.atan2(b.y - a.y, b.x - a.x);\n  }\n\n  /**\n   * Get a temporary Vec2 for use as output parameter to avoid allocations\n   * WARNING: This returns the same instance each time, do not store the result\n   */\n  static temp(x: number, y: number): Vec2 {\n    (Vec2._tempVec as { x: number; y: number }).x = x;\n    (Vec2._tempVec as { x: number; y: number }).y = y;\n    return Vec2._tempVec;\n  }\n\n  // ==================== ARITHMETIC OPERATIONS ====================\n\n  /**\n   * Add another vector\n   */\n  add(other: Point): Vec2 {\n    return new Vec2(this.x + other.x, this.y + other.y);\n  }\n\n  /**\n   * Subtract another vector\n   */\n  subtract(other: Point): Vec2 {\n    return new Vec2(this.x - other.x, this.y - other.y);\n  }\n\n  /**\n   * Multiply by a scalar\n   */\n  multiply(scalar: number): Vec2 {\n    return new Vec2(this.x * scalar, this.y * scalar);\n  }\n\n  /**\n   * Divide by a scalar\n   */\n  divide(scalar: number): Vec2 {\n    if (scalar === 0) {\n      throw new Error('Vec2: Division by zero');\n    }\n    return new Vec2(this.x / scalar, this.y / scalar);\n  }\n\n  /**\n   * Negate the vector\n   */\n  negate(): Vec2 {\n    return new Vec2(-this.x, -this.y);\n  }\n\n  // ==================== VECTOR OPERATIONS ====================\n\n  /**\n   * Get the length (magnitude) of the vector\n   */\n  length(): number {\n    return Math.sqrt(this.x * this.x + this.y * this.y);\n  }\n\n  /**\n   * Get the squared length (faster, no sqrt)\n   */\n  lengthSquared(): number {\n    return this.x * this.x + this.y * this.y;\n  }\n\n  /**\n   * Normalize the vector (make it unit length)\n   */\n  normalize(): Vec2 {\n    const len = this.length();\n    if (len === 0) {\n      return new Vec2(0, 0);\n    }\n    return new Vec2(this.x / len, this.y / len);\n  }\n\n  /**\n   * Set the length of the vector\n   */\n  setLength(length: number): Vec2 {\n    return this.normalize().multiply(length);\n  }\n\n  /**\n   * Limit the length of the vector\n   */\n  limit(maxLength: number): Vec2 {\n    const lenSq = this.lengthSquared();\n    if (lenSq > maxLength * maxLength) {\n      return this.setLength(maxLength);\n    }\n    return this;\n  }\n\n  /**\n   * Dot product with another vector\n   */\n  dot(other: Point): number {\n    return this.x * other.x + this.y * other.y;\n  }\n\n  /**\n   * Cross product (returns scalar, the z-component of 3D cross product)\n   */\n  cross(other: Point): number {\n    return this.x * other.y - this.y * other.x;\n  }\n\n  /**\n   * Get the angle of the vector in radians\n   */\n  angle(): number {\n    return Math.atan2(this.y, this.x);\n  }\n\n  /**\n   * Rotate the vector by an angle\n   * @param angle Angle in radians\n   */\n  rotate(angle: number): Vec2 {\n    const cos = Math.cos(angle);\n    const sin = Math.sin(angle);\n    return new Vec2(\n      this.x * cos - this.y * sin,\n      this.x * sin + this.y * cos\n    );\n  }\n\n  /**\n   * Get perpendicular vector (rotated 90 degrees counter-clockwise)\n   */\n  perpendicular(): Vec2 {\n    return new Vec2(-this.y, this.x);\n  }\n\n  /**\n   * Reflect vector off a surface with the given normal\n   */\n  reflect(normal: Vec2): Vec2 {\n    const d = 2 * this.dot(normal);\n    return new Vec2(\n      this.x - d * normal.x,\n      this.y - d * normal.y\n    );\n  }\n\n  /**\n   * Project this vector onto another vector\n   */\n  projectOnto(other: Vec2): Vec2 {\n    const lenSq = other.lengthSquared();\n    if (lenSq === 0) {\n      return Vec2.zero();\n    }\n    const scalar = this.dot(other) / lenSq;\n    return other.multiply(scalar);\n  }\n\n  // ==================== INTERPOLATION ====================\n\n  /**\n   * Linear interpolation to another vector\n   * @param target Target vector\n   * @param t Interpolation factor (0-1)\n   */\n  lerp(target: Point, t: number): Vec2 {\n    return new Vec2(\n      this.x + (target.x - this.x) * t,\n      this.y + (target.y - this.y) * t\n    );\n  }\n\n  /**\n   * Move towards a target by a maximum distance\n   */\n  moveTowards(target: Point, maxDistance: number): Vec2 {\n    const dx = target.x - this.x;\n    const dy = target.y - this.y;\n    const distSq = dx * dx + dy * dy;\n\n    if (distSq === 0 || distSq <= maxDistance * maxDistance) {\n      return new Vec2(target.x, target.y);\n    }\n\n    const dist = Math.sqrt(distSq);\n    return new Vec2(\n      this.x + (dx / dist) * maxDistance,\n      this.y + (dy / dist) * maxDistance\n    );\n  }\n\n  // ==================== UTILITY METHODS ====================\n\n  /**\n   * Get distance to another point\n   */\n  distanceTo(other: Point): number {\n    return Vec2.distance(this, other);\n  }\n\n  /**\n   * Get squared distance to another point (faster, no sqrt)\n   */\n  distanceToSquared(other: Point): number {\n    return Vec2.distanceSquared(this, other);\n  }\n\n  /**\n   * Get angle to another point\n   */\n  angleTo(other: Point): number {\n    return Vec2.angleBetween(this, other);\n  }\n\n  /**\n   * Clamp coordinates to a rectangular region\n   */\n  clamp(minX: number, minY: number, maxX: number, maxY: number): Vec2 {\n    return new Vec2(\n      Math.max(minX, Math.min(maxX, this.x)),\n      Math.max(minY, Math.min(maxY, this.y))\n    );\n  }\n\n  /**\n   * Round coordinates to integers\n   */\n  round(): Vec2 {\n    return new Vec2(Math.round(this.x), Math.round(this.y));\n  }\n\n  /**\n   * Floor coordinates\n   */\n  floor(): Vec2 {\n    return new Vec2(Math.floor(this.x), Math.floor(this.y));\n  }\n\n  /**\n   * Ceil coordinates\n   */\n  ceil(): Vec2 {\n    return new Vec2(Math.ceil(this.x), Math.ceil(this.y));\n  }\n\n  /**\n   * Get absolute values\n   */\n  abs(): Vec2 {\n    return new Vec2(Math.abs(this.x), Math.abs(this.y));\n  }\n\n  // ==================== COMPARISON METHODS ====================\n\n  /**\n   * Check if this vector equals another (exact comparison)\n   */\n  equals(other: Point): boolean {\n    return this.x === other.x && this.y === other.y;\n  }\n\n  /**\n   * Check if this vector is approximately equal to another\n   * @param epsilon Maximum difference allowed\n   */\n  approximatelyEquals(other: Point, epsilon: number = 0.0001): boolean {\n    return (\n      Math.abs(this.x - other.x) < epsilon &&\n      Math.abs(this.y - other.y) < epsilon\n    );\n  }\n\n  /**\n   * Check if the vector is zero\n   */\n  isZero(): boolean {\n    return this.x === 0 && this.y === 0;\n  }\n\n  // ==================== CONVERSION ====================\n\n  /**\n   * Convert to array\n   */\n  toArray(): [number, number] {\n    return [this.x, this.y];\n  }\n\n  /**\n   * Convert to plain object\n   */\n  toObject(): Point {\n    return { x: this.x, y: this.y };\n  }\n\n  /**\n   * Clone this vector\n   */\n  clone(): Vec2 {\n    return new Vec2(this.x, this.y);\n  }\n\n  /**\n   * String representation\n   */\n  toString(): string {\n    return `Vec2(${this.x}, ${this.y})`;\n  }\n}\n\n// ==================== MUTABLE VECTOR FOR HOT PATHS ====================\n\n/**\n * Mutable version of Vec2 for performance-critical code\n * Use with caution - mutations can lead to bugs\n */\nexport class MutableVec2 implements Point {\n  x: number;\n  y: number;\n\n  constructor(x: number = 0, y: number = 0) {\n    this.x = x;\n    this.y = y;\n  }\n\n  /**\n   * Set both coordinates\n   */\n  set(x: number, y: number): this {\n    this.x = x;\n    this.y = y;\n    return this;\n  }\n\n  /**\n   * Copy from another point\n   */\n  copy(other: Point): this {\n    this.x = other.x;\n    this.y = other.y;\n    return this;\n  }\n\n  /**\n   * Add in place\n   */\n  addMut(other: Point): this {\n    this.x += other.x;\n    this.y += other.y;\n    return this;\n  }\n\n  /**\n   * Subtract in place\n   */\n  subtractMut(other: Point): this {\n    this.x -= other.x;\n    this.y -= other.y;\n    return this;\n  }\n\n  /**\n   * Multiply by scalar in place\n   */\n  multiplyMut(scalar: number): this {\n    this.x *= scalar;\n    this.y *= scalar;\n    return this;\n  }\n\n  /**\n   * Convert to immutable Vec2\n   */\n  toVec2(): Vec2 {\n    return new Vec2(this.x, this.y);\n  }\n}\n","/**\n * GrowthProgress Domain Object\n * Standardizes growth phase calculations for plant rendering\n * Encapsulates the timing logic for different plant growth phases\n */\n\nimport { GROWTH_PHASES } from './constants';\n\n/**\n * Growth phases data structure\n */\nexport interface GrowthPhases {\n  /** Overall progress (0-1) */\n  progress: number;\n  /** Stem growth phase (0-1) */\n  stem: number;\n  /** Leaf growth phase (0-1) */\n  leaf: number;\n  /** Flower/bloom growth phase (0-1) */\n  flower: number;\n}\n\n/**\n * Extended growth phases including additional plant-specific phases\n */\nexport interface ExtendedGrowthPhases extends GrowthPhases {\n  /** Foliage growth for trees (0-1) */\n  foliage: number;\n  /** Plume growth for grasses (0-1) */\n  plume: number;\n}\n\n/**\n * Configuration for growth timing\n */\nexport interface GrowthConfig {\n  /** Rate at which stems grow (multiplier on progress) */\n  stemRate: number;\n  /** When leaf growth starts (0-1) */\n  leafStart: number;\n  /** Rate at which leaves grow (multiplier on adjusted progress) */\n  leafRate: number;\n  /** When flower growth starts (0-1) */\n  flowerStart: number;\n  /** Rate at which flowers grow (multiplier on adjusted progress) */\n  flowerRate: number;\n}\n\n/**\n * GrowthProgress class - Calculates and manages plant growth phases\n *\n * Usage:\n * ```typescript\n * const growth = GrowthProgress.calculate(time, plant.delay, plant.growDuration);\n * if (growth.isActive) {\n *   drawStem(ctx, x, y, height * growth.stem, ...);\n *   if (growth.hasLeaves) {\n *     drawLeaf(ctx, x, y, growth.leaf, ...);\n *   }\n *   if (growth.hasFlower) {\n *     drawFlower(ctx, x, y, growth.flower, ...);\n *   }\n * }\n * ```\n */\nexport class GrowthProgress {\n  private readonly _progress: number;\n  private readonly _stem: number;\n  private readonly _leaf: number;\n  private readonly _flower: number;\n  private readonly _foliage: number;\n  private readonly _plume: number;\n\n  private constructor(\n    progress: number,\n    config: GrowthConfig = GrowthProgress.defaultConfig\n  ) {\n    this._progress = Math.max(0, Math.min(1, progress));\n\n    // Calculate growth phases\n    this._stem = Math.min(1, this._progress * config.stemRate);\n    this._leaf = Math.max(0, Math.min(1, (this._progress - config.leafStart) * config.leafRate));\n    this._flower = Math.max(0, Math.min(1, (this._progress - config.flowerStart) * config.flowerRate));\n\n    // Extended phases\n    this._foliage = Math.max(0, (this._progress - GROWTH_PHASES.FOLIAGE_START) * GROWTH_PHASES.FOLIAGE_GROWTH_RATE);\n    this._plume = this._progress > GROWTH_PHASES.PLUME_START\n      ? (this._progress - GROWTH_PHASES.PLUME_START) / (1 - GROWTH_PHASES.PLUME_START)\n      : 0;\n  }\n\n  // ==================== STATIC CONFIGURATION ====================\n\n  static readonly defaultConfig: GrowthConfig = {\n    stemRate: GROWTH_PHASES.STEM_GROWTH_RATE,\n    leafStart: GROWTH_PHASES.LEAF_START,\n    leafRate: GROWTH_PHASES.LEAF_GROWTH_RATE,\n    flowerStart: GROWTH_PHASES.FLOWER_START,\n    flowerRate: GROWTH_PHASES.FLOWER_GROWTH_RATE,\n  };\n\n  // ==================== STATIC FACTORIES ====================\n\n  /**\n   * Calculate growth progress from timing parameters\n   * @param time Current animation time\n   * @param delay Plant's growth delay\n   * @param duration Plant's growth duration\n   * @param config Optional custom growth configuration\n   */\n  static calculate(\n    time: number,\n    delay: number,\n    duration: number,\n    config?: Partial<GrowthConfig>\n  ): GrowthProgress {\n    const progress = (time - delay) / duration;\n    const fullConfig = config\n      ? { ...GrowthProgress.defaultConfig, ...config }\n      : GrowthProgress.defaultConfig;\n    return new GrowthProgress(progress, fullConfig);\n  }\n\n  /**\n   * Create from raw progress value\n   * @param progress Progress value (0-1)\n   * @param config Optional custom growth configuration\n   */\n  static fromProgress(progress: number, config?: Partial<GrowthConfig>): GrowthProgress {\n    const fullConfig = config\n      ? { ...GrowthProgress.defaultConfig, ...config }\n      : GrowthProgress.defaultConfig;\n    return new GrowthProgress(progress, fullConfig);\n  }\n\n  /**\n   * Create an inactive (zero progress) growth state\n   */\n  static inactive(): GrowthProgress {\n    return new GrowthProgress(0);\n  }\n\n  /**\n   * Create a complete (full progress) growth state\n   */\n  static complete(): GrowthProgress {\n    return new GrowthProgress(1);\n  }\n\n  // ==================== GETTERS ====================\n\n  /** Overall progress (0-1) */\n  get progress(): number {\n    return this._progress;\n  }\n\n  /** Stem growth phase (0-1) */\n  get stem(): number {\n    return this._stem;\n  }\n\n  /** Leaf growth phase (0-1) */\n  get leaf(): number {\n    return this._leaf;\n  }\n\n  /** Flower/bloom growth phase (0-1) */\n  get flower(): number {\n    return this._flower;\n  }\n\n  /** Foliage growth for trees (0-1) */\n  get foliage(): number {\n    return this._foliage;\n  }\n\n  /** Plume growth for grasses (0-1) */\n  get plume(): number {\n    return this._plume;\n  }\n\n  // ==================== BOOLEAN CHECKS ====================\n\n  /** Whether the plant has started growing */\n  get isActive(): boolean {\n    return this._progress > 0;\n  }\n\n  /** Whether the plant is fully grown */\n  get isComplete(): boolean {\n    return this._progress >= 1;\n  }\n\n  /** Whether leaves should be drawn */\n  get hasLeaves(): boolean {\n    return this._leaf > 0;\n  }\n\n  /** Whether flowers should be drawn */\n  get hasFlower(): boolean {\n    return this._flower > 0;\n  }\n\n  /** Whether tree foliage should be drawn */\n  get hasFoliage(): boolean {\n    return this._foliage > 0;\n  }\n\n  /** Whether grass plumes should be drawn */\n  get hasPlume(): boolean {\n    return this._plume > 0;\n  }\n\n  // ==================== UTILITY METHODS ====================\n\n  /**\n   * Get all phases as an object\n   */\n  toObject(): GrowthPhases {\n    return {\n      progress: this._progress,\n      stem: this._stem,\n      leaf: this._leaf,\n      flower: this._flower,\n    };\n  }\n\n  /**\n   * Get extended phases including foliage and plume\n   */\n  toExtendedObject(): ExtendedGrowthPhases {\n    return {\n      progress: this._progress,\n      stem: this._stem,\n      leaf: this._leaf,\n      flower: this._flower,\n      foliage: this._foliage,\n      plume: this._plume,\n    };\n  }\n\n  /**\n   * Check if progress is within a range\n   * @param min Minimum progress (inclusive)\n   * @param max Maximum progress (exclusive)\n   */\n  isInRange(min: number, max: number): boolean {\n    return this._progress >= min && this._progress < max;\n  }\n\n  /**\n   * Get a clamped progress value for a specific phase\n   * @param start When this phase starts (0-1)\n   * @param end When this phase ends (0-1)\n   */\n  getPhaseProgress(start: number, end: number): number {\n    if (this._progress <= start) return 0;\n    if (this._progress >= end) return 1;\n    return (this._progress - start) / (end - start);\n  }\n\n  /**\n   * Get eased progress using common easing functions\n   * @param easing Easing type: 'linear', 'ease-in', 'ease-out', 'ease-in-out'\n   */\n  eased(easing: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out' = 'linear'): number {\n    const t = this._progress;\n    switch (easing) {\n      case 'ease-in':\n        return t * t;\n      case 'ease-out':\n        return t * (2 - t);\n      case 'ease-in-out':\n        return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n      case 'linear':\n      default:\n        return t;\n    }\n  }\n\n  /**\n   * Apply an easing function to the stem growth\n   */\n  easedStem(easing: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out' = 'ease-out'): number {\n    return this._applyEasing(this._stem, easing);\n  }\n\n  /**\n   * Apply an easing function to the flower growth\n   */\n  easedFlower(easing: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out' = 'ease-out'): number {\n    return this._applyEasing(this._flower, easing);\n  }\n\n  private _applyEasing(\n    value: number,\n    easing: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out'\n  ): number {\n    const t = value;\n    switch (easing) {\n      case 'ease-in':\n        return t * t;\n      case 'ease-out':\n        return t * (2 - t);\n      case 'ease-in-out':\n        return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n      case 'linear':\n      default:\n        return t;\n    }\n  }\n\n  /**\n   * Check if this growth progress equals another\n   */\n  equals(other: GrowthProgress): boolean {\n    return (\n      this._progress === other._progress &&\n      this._stem === other._stem &&\n      this._leaf === other._leaf &&\n      this._flower === other._flower &&\n      this._foliage === other._foliage &&\n      this._plume === other._plume\n    );\n  }\n\n  /**\n   * Check if this growth progress is approximately equal to another\n   * @param other GrowthProgress to compare with\n   * @param epsilon Maximum difference allowed (default 0.0001)\n   */\n  approximatelyEquals(other: GrowthProgress, epsilon: number = 0.0001): boolean {\n    return (\n      Math.abs(this._progress - other._progress) < epsilon &&\n      Math.abs(this._stem - other._stem) < epsilon &&\n      Math.abs(this._leaf - other._leaf) < epsilon &&\n      Math.abs(this._flower - other._flower) < epsilon &&\n      Math.abs(this._foliage - other._foliage) < epsilon &&\n      Math.abs(this._plume - other._plume) < epsilon\n    );\n  }\n\n  /**\n   * Clone this growth progress\n   */\n  clone(): GrowthProgress {\n    return GrowthProgress.fromProgress(this._progress);\n  }\n\n  /**\n   * String representation\n   */\n  toString(): string {\n    return `GrowthProgress(${this._progress.toFixed(2)}: stem=${this._stem.toFixed(2)}, leaf=${this._leaf.toFixed(2)}, flower=${this._flower.toFixed(2)})`;\n  }\n}\n\n// ==================== HELPER FUNCTIONS ====================\n\n/**\n * Quick calculation for legacy code - returns null if plant hasn't started growing\n * Compatible with the existing GrowthPhases interface used in renderers\n */\nexport function calculateGrowthPhases(\n  time: number,\n  delay: number,\n  growDuration: number\n): GrowthPhases | null {\n  const progress = (time - delay) / growDuration;\n  if (progress <= 0) return null;\n\n  return {\n    progress,\n    stem: Math.min(1, progress * GROWTH_PHASES.STEM_GROWTH_RATE),\n    leaf: Math.max(0, Math.min(1, (progress - GROWTH_PHASES.LEAF_START) * GROWTH_PHASES.LEAF_GROWTH_RATE)),\n    flower: Math.max(0, Math.min(1, (progress - GROWTH_PHASES.FLOWER_START) * GROWTH_PHASES.FLOWER_GROWTH_RATE)),\n  };\n}\n\n/**\n * Check if a plant should be rendered at the given time\n */\nexport function isPlantActive(time: number, delay: number): boolean {\n  return time >= delay;\n}\n\n/**\n * Calculate raw progress (0-1) without phase separation\n */\nexport function calculateRawProgress(time: number, delay: number, duration: number): number {\n  return Math.max(0, Math.min(1, (time - delay) / duration));\n}\n","/**\n * SeededRandom - Enhanced seeded random number generator\n * Provides deterministic random values for reproducible garden generation\n */\n\n/**\n * SeededRandom class - A comprehensive seeded pseudo-random number generator\n *\n * Features:\n * - Deterministic: Same seed always produces same sequence\n * - Rich API: Range, pick, shuffle, normal distribution\n * - Stateful: Maintains seed state for sequential calls\n * - Lightweight: Uses simple sine-based PRNG (good enough for visual use)\n *\n * Usage:\n * ```typescript\n * const rng = new SeededRandom(42);\n *\n * // Basic random (0-1)\n * const value = rng.next();\n *\n * // Random in range\n * const height = rng.range(0.1, 0.5);\n *\n * // Random integer\n * const petals = rng.int(3, 8);\n *\n * // Pick from array\n * const color = rng.pick(['red', 'blue', 'green']);\n *\n * // Weighted pick\n * const category = rng.weightedPick([\n *   { value: 'common', weight: 0.7 },\n *   { value: 'rare', weight: 0.3 }\n * ]);\n * ```\n */\nexport class SeededRandom {\n  private _seed: number;\n  private _initialSeed: number;\n\n  /**\n   * Create a new SeededRandom instance\n   * @param seed Initial seed value\n   */\n  constructor(seed: number) {\n    this._initialSeed = seed;\n    this._seed = seed;\n  }\n\n  // ==================== GETTERS ====================\n\n  /**\n   * Get the current seed value\n   */\n  get seed(): number {\n    return this._seed;\n  }\n\n  /**\n   * Get the initial seed value\n   */\n  get initialSeed(): number {\n    return this._initialSeed;\n  }\n\n  // ==================== CORE METHODS ====================\n\n  /**\n   * Generate the next random value (0-1)\n   */\n  next(): number {\n    const x = Math.sin(this._seed++ * 9999) * 10000;\n    return x - Math.floor(x);\n  }\n\n  /**\n   * Reset to initial seed\n   */\n  reset(): void {\n    this._seed = this._initialSeed;\n  }\n\n  /**\n   * Set a new seed\n   */\n  setSeed(seed: number): void {\n    this._seed = seed;\n    this._initialSeed = seed;\n  }\n\n  /**\n   * Create a child RNG with a derived seed\n   * Useful for creating independent sequences\n   */\n  fork(): SeededRandom {\n    return new SeededRandom(this._seed * 1000 + Math.floor(this.next() * 1000));\n  }\n\n  /**\n   * Create a function that generates sequential random values\n   * Compatible with existing createRandom pattern\n   */\n  createGenerator(): () => number {\n    const rng = this.fork();\n    return () => rng.next();\n  }\n\n  // ==================== RANGE METHODS ====================\n\n  /**\n   * Random float in range [min, max)\n   */\n  range(min: number, max: number): number {\n    return min + this.next() * (max - min);\n  }\n\n  /**\n   * Random integer in range [min, max] (inclusive)\n   */\n  int(min: number, max: number): number {\n    return Math.floor(this.range(min, max + 1));\n  }\n\n  /**\n   * Random integer in range [0, max) (exclusive)\n   */\n  below(max: number): number {\n    return Math.floor(this.next() * max);\n  }\n\n  /**\n   * Random value centered around zero: [-range, range]\n   */\n  centered(range: number): number {\n    return (this.next() - 0.5) * 2 * range;\n  }\n\n  /**\n   * Random value with offset from center: center + [-range, range]\n   */\n  around(center: number, range: number): number {\n    return center + this.centered(range);\n  }\n\n  // ==================== BOOLEAN METHODS ====================\n\n  /**\n   * Random boolean\n   */\n  bool(): boolean {\n    return this.next() < 0.5;\n  }\n\n  /**\n   * Random boolean with probability\n   * @param probability Chance of returning true (0-1)\n   */\n  chance(probability: number): boolean {\n    return this.next() < probability;\n  }\n\n  /**\n   * Random sign (1 or -1)\n   */\n  sign(): number {\n    return this.bool() ? 1 : -1;\n  }\n\n  // ==================== ARRAY METHODS ====================\n\n  /**\n   * Pick a random element from an array\n   */\n  pick<T>(array: readonly T[]): T {\n    if (array.length === 0) {\n      throw new Error('SeededRandom.pick: Cannot pick from empty array');\n    }\n    return array[this.below(array.length)];\n  }\n\n  /**\n   * Pick a random index from an array\n   */\n  pickIndex<T>(array: readonly T[]): number {\n    if (array.length === 0) {\n      throw new Error('SeededRandom.pickIndex: Cannot pick from empty array');\n    }\n    return this.below(array.length);\n  }\n\n  /**\n   * Pick multiple unique random elements from an array\n   * @param array Source array\n   * @param count Number of elements to pick\n   */\n  pickMultiple<T>(array: readonly T[], count: number): T[] {\n    if (count > array.length) {\n      throw new Error('SeededRandom.pickMultiple: Count exceeds array length');\n    }\n\n    const result: T[] = [];\n    const indices = new Set<number>();\n\n    while (result.length < count) {\n      const idx = this.below(array.length);\n      if (!indices.has(idx)) {\n        indices.add(idx);\n        result.push(array[idx]);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Weighted random pick\n   * @param items Array of { value, weight } objects\n   */\n  weightedPick<T>(items: readonly { value: T; weight: number }[]): T {\n    if (items.length === 0) {\n      throw new Error('SeededRandom.weightedPick: Cannot pick from empty array');\n    }\n\n    const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);\n    let roll = this.next() * totalWeight;\n\n    for (const item of items) {\n      roll -= item.weight;\n      if (roll <= 0) {\n        return item.value;\n      }\n    }\n\n    // Fallback to last item (shouldn't happen due to floating point)\n    return items[items.length - 1].value;\n  }\n\n  /**\n   * Shuffle an array in place (Fisher-Yates)\n   */\n  shuffle<T>(array: T[]): T[] {\n    for (let i = array.length - 1; i > 0; i--) {\n      const j = this.below(i + 1);\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n    return array;\n  }\n\n  /**\n   * Create a shuffled copy of an array\n   */\n  shuffled<T>(array: readonly T[]): T[] {\n    const copy = [...array];\n    return this.shuffle(copy);\n  }\n\n  // ==================== DISTRIBUTION METHODS ====================\n\n  /**\n   * Gaussian (normal) distribution\n   * Uses Box-Muller transform\n   * @param mean Mean of the distribution\n   * @param stdDev Standard deviation\n   */\n  gaussian(mean: number = 0, stdDev: number = 1): number {\n    // Box-Muller transform\n    const u1 = this.next();\n    const u2 = this.next();\n\n    const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);\n    return z0 * stdDev + mean;\n  }\n\n  /**\n   * Exponential distribution\n   * @param lambda Rate parameter\n   */\n  exponential(lambda: number = 1): number {\n    return -Math.log(1 - this.next()) / lambda;\n  }\n\n  /**\n   * Biased random value (power curve)\n   * @param exponent Values < 1 bias toward 1, > 1 bias toward 0\n   */\n  biased(exponent: number): number {\n    return Math.pow(this.next(), exponent);\n  }\n\n  /**\n   * Random value biased toward the center (0.5)\n   * Uses average of two random values\n   */\n  centeredBias(): number {\n    return (this.next() + this.next()) / 2;\n  }\n\n  /**\n   * Random value biased toward edges (0 and 1)\n   */\n  edgeBias(): number {\n    const v = this.next() * 2 - 1;\n    return Math.abs(v);\n  }\n\n  // ==================== GEOMETRIC METHODS ====================\n\n  /**\n   * Random angle in radians [0, 2*PI)\n   */\n  angle(): number {\n    return this.next() * Math.PI * 2;\n  }\n\n  /**\n   * Random angle in degrees [0, 360)\n   */\n  degrees(): number {\n    return this.next() * 360;\n  }\n\n  /**\n   * Random point in unit circle\n   */\n  pointInCircle(): { x: number; y: number } {\n    const angle = this.angle();\n    const radius = Math.sqrt(this.next()); // sqrt for uniform distribution\n    return {\n      x: Math.cos(angle) * radius,\n      y: Math.sin(angle) * radius,\n    };\n  }\n\n  /**\n   * Random point on unit circle edge\n   */\n  pointOnCircle(): { x: number; y: number } {\n    const angle = this.angle();\n    return {\n      x: Math.cos(angle),\n      y: Math.sin(angle),\n    };\n  }\n\n  /**\n   * Random point in rectangle\n   */\n  pointInRect(width: number, height: number): { x: number; y: number } {\n    return {\n      x: this.next() * width,\n      y: this.next() * height,\n    };\n  }\n\n  // ==================== UTILITY METHODS ====================\n\n  /**\n   * Get current state for serialization\n   */\n  getState(): { seed: number; initialSeed: number } {\n    return {\n      seed: this._seed,\n      initialSeed: this._initialSeed,\n    };\n  }\n\n  /**\n   * Restore state from serialized data\n   */\n  setState(state: { seed: number; initialSeed: number }): void {\n    this._seed = state.seed;\n    this._initialSeed = state.initialSeed;\n  }\n\n  /**\n   * Advance the seed by n steps without generating values\n   * Useful for skipping ahead in the sequence\n   */\n  skip(n: number): void {\n    this._seed += n;\n  }\n\n  /**\n   * Create a new SeededRandom with a random seed\n   */\n  static random(): SeededRandom {\n    return new SeededRandom(Math.random() * 100000);\n  }\n\n  /**\n   * Create from a string (hashes the string to get a seed)\n   */\n  static fromString(str: string): SeededRandom {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n    return new SeededRandom(Math.abs(hash));\n  }\n}\n\n// ==================== LEGACY COMPATIBILITY ====================\n\n/**\n * Seeded pseudo-random number generator function\n * Returns a value between 0 and 1\n * Compatible with existing code\n */\nexport function seededRandom(seed: number): number {\n  const x = Math.sin(seed * 9999) * 10000;\n  return x - Math.floor(x);\n}\n\n/**\n * Create a seeded random function that auto-increments\n * Compatible with existing createRandom pattern\n */\nexport function createRandom(initialSeed: number): () => number {\n  let seed = initialSeed;\n  return () => seededRandom(seed++);\n}\n\n/**\n * Pick a random item from an array using seeded random\n * Compatible with existing pickRandom pattern\n */\nexport function pickRandom<T>(array: readonly T[], rand: () => number): T {\n  return array[Math.floor(rand() * array.length)];\n}\n\n/**\n * Pick a random number in range using seeded random\n * Compatible with existing randomRange pattern\n */\nexport function randomRange(min: number, max: number, rand: () => number): number {\n  return min + rand() * (max - min);\n}\n","/**\n * CanvasHelper - Canvas drawing utilities for common operations\n * Provides a fluent API for common canvas drawing patterns\n */\n\nimport { GEOMETRY, CANVAS_STYLE } from './constants';\n\n/**\n * Common drawing context type\n */\ntype Ctx = CanvasRenderingContext2D;\n\n/**\n * Stem drawing result with end position\n */\nexport interface StemResult {\n  endX: number;\n  endY: number;\n}\n\n/**\n * Reusable stem result to avoid allocations in hot paths\n */\nconst _stemResult: StemResult = { endX: 0, endY: 0 };\n\n/**\n * CanvasHelper class - Provides common canvas drawing utilities\n *\n * Usage:\n * ```typescript\n * const helper = new CanvasHelper(ctx);\n *\n * // Draw a stem and get end position\n * const end = helper.drawStem(x, baseY, height, thickness, color, lean, growth);\n *\n * // Draw leaf pair\n * helper.drawLeafPair(x, y, leftAngle, rightAngle, size, color);\n *\n * // Draw with state management\n * helper.withState(() => {\n *   helper.translate(x, y);\n *   helper.rotate(angle);\n *   helper.drawEllipse(0, 0, rx, ry, color);\n * });\n * ```\n */\nexport class CanvasHelper {\n  private readonly ctx: Ctx;\n\n  constructor(ctx: Ctx) {\n    this.ctx = ctx;\n  }\n\n  // ==================== STATE MANAGEMENT ====================\n\n  /**\n   * Execute a function with saved canvas state\n   * Automatically saves and restores\n   */\n  withState(fn: () => void): void {\n    this.ctx.save();\n    try {\n      fn();\n    } finally {\n      this.ctx.restore();\n    }\n  }\n\n  /**\n   * Save canvas state\n   */\n  save(): this {\n    this.ctx.save();\n    return this;\n  }\n\n  /**\n   * Restore canvas state\n   */\n  restore(): this {\n    this.ctx.restore();\n    return this;\n  }\n\n  // ==================== TRANSFORMS ====================\n\n  /**\n   * Translate origin\n   */\n  translate(x: number, y: number): this {\n    this.ctx.translate(x, y);\n    return this;\n  }\n\n  /**\n   * Rotate canvas\n   * @param angle Angle in radians\n   */\n  rotate(angle: number): this {\n    this.ctx.rotate(angle);\n    return this;\n  }\n\n  /**\n   * Scale canvas\n   */\n  scale(x: number, y: number = x): this {\n    this.ctx.scale(x, y);\n    return this;\n  }\n\n  /**\n   * Reset transform to identity\n   */\n  resetTransform(): this {\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    return this;\n  }\n\n  // ==================== STYLE SETTERS ====================\n\n  /**\n   * Set fill style\n   */\n  setFill(color: string): this {\n    this.ctx.fillStyle = color;\n    return this;\n  }\n\n  /**\n   * Set stroke style\n   */\n  setStroke(color: string, width?: number): this {\n    this.ctx.strokeStyle = color;\n    if (width !== undefined) {\n      this.ctx.lineWidth = width;\n    }\n    return this;\n  }\n\n  /**\n   * Set line width\n   */\n  setLineWidth(width: number): this {\n    this.ctx.lineWidth = width;\n    return this;\n  }\n\n  /**\n   * Set line cap\n   */\n  setLineCap(cap: CanvasLineCap): this {\n    this.ctx.lineCap = cap;\n    return this;\n  }\n\n  /**\n   * Set global alpha\n   */\n  setAlpha(alpha: number): this {\n    this.ctx.globalAlpha = alpha;\n    return this;\n  }\n\n  /**\n   * Set composite operation\n   */\n  setComposite(operation: GlobalCompositeOperation): this {\n    this.ctx.globalCompositeOperation = operation;\n    return this;\n  }\n\n  // ==================== BASIC SHAPES ====================\n\n  /**\n   * Fill a rectangle\n   */\n  fillRect(x: number, y: number, width: number, height: number, color?: string): this {\n    if (color) {\n      this.ctx.fillStyle = color;\n    }\n    this.ctx.fillRect(x, y, width, height);\n    return this;\n  }\n\n  /**\n   * Stroke a rectangle\n   */\n  strokeRect(x: number, y: number, width: number, height: number, color?: string): this {\n    if (color) {\n      this.ctx.strokeStyle = color;\n    }\n    this.ctx.strokeRect(x, y, width, height);\n    return this;\n  }\n\n  /**\n   * Fill a circle\n   */\n  fillCircle(x: number, y: number, radius: number, color?: string): this {\n    if (radius <= 0) return this;\n\n    this.ctx.beginPath();\n    this.ctx.arc(x, y, radius, 0, GEOMETRY.TWO_PI);\n    if (color) {\n      this.ctx.fillStyle = color;\n    }\n    this.ctx.fill();\n    return this;\n  }\n\n  /**\n   * Stroke a circle\n   */\n  strokeCircle(x: number, y: number, radius: number, color?: string): this {\n    if (radius <= 0) return this;\n\n    this.ctx.beginPath();\n    this.ctx.arc(x, y, radius, 0, GEOMETRY.TWO_PI);\n    if (color) {\n      this.ctx.strokeStyle = color;\n    }\n    this.ctx.stroke();\n    return this;\n  }\n\n  /**\n   * Fill an ellipse\n   */\n  fillEllipse(\n    x: number,\n    y: number,\n    radiusX: number,\n    radiusY: number,\n    rotation: number = 0,\n    color?: string\n  ): this {\n    if (radiusX <= 0 || radiusY <= 0) return this;\n\n    this.ctx.beginPath();\n    this.ctx.ellipse(x, y, radiusX, radiusY, rotation, 0, GEOMETRY.TWO_PI);\n    if (color) {\n      this.ctx.fillStyle = color;\n    }\n    this.ctx.fill();\n    return this;\n  }\n\n  /**\n   * Draw a line\n   */\n  line(x1: number, y1: number, x2: number, y2: number, color?: string, width?: number): this {\n    this.ctx.beginPath();\n    this.ctx.moveTo(x1, y1);\n    this.ctx.lineTo(x2, y2);\n    if (color) {\n      this.ctx.strokeStyle = color;\n    }\n    if (width !== undefined) {\n      this.ctx.lineWidth = width;\n    }\n    this.ctx.stroke();\n    return this;\n  }\n\n  // ==================== PLANT-SPECIFIC DRAWING ====================\n\n  /**\n   * Draw a curved stem and return the end position\n   * Uses output parameter to avoid allocation\n   * @returns The end position of the stem, or null if growth <= 0\n   */\n  drawStem(\n    x: number,\n    y: number,\n    height: number,\n    thickness: number,\n    color: string,\n    lean: number,\n    growth: number,\n    result: StemResult = _stemResult\n  ): StemResult | null {\n    if (growth <= 0) return null;\n\n    const h = height * Math.min(1, growth);\n\n    this.ctx.beginPath();\n    this.ctx.moveTo(x, y);\n\n    // Control points for natural curve\n    const cp1x = x + lean * h * GEOMETRY.STEM_CP1_LEAN;\n    const cp1y = y - h * GEOMETRY.STEM_CP1_HEIGHT;\n    const cp2x = x + lean * h * GEOMETRY.STEM_CP2_LEAN;\n    const cp2y = y - h * GEOMETRY.STEM_CP2_HEIGHT;\n    const endX = x + lean * h;\n    const endY = y - h;\n\n    this.ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);\n    this.ctx.strokeStyle = color;\n    this.ctx.lineWidth = thickness;\n    this.ctx.lineCap = CANVAS_STYLE.LINE_CAP;\n    this.ctx.stroke();\n\n    result.endX = endX;\n    result.endY = endY;\n    return result;\n  }\n\n  /**\n   * Draw a leaf shape\n   */\n  drawLeaf(x: number, y: number, angle: number, size: number, color: string): this {\n    if (size < 1) return this;\n\n    this.withState(() => {\n      this.ctx.translate(x, y);\n      this.ctx.rotate(angle);\n\n      this.ctx.beginPath();\n      this.ctx.moveTo(0, 0);\n      this.ctx.bezierCurveTo(\n        size * 0.3, -size * 0.15,\n        size * 0.7, -size * 0.15,\n        size, 0\n      );\n      this.ctx.bezierCurveTo(\n        size * 0.7, size * 0.15,\n        size * 0.3, size * 0.15,\n        0, 0\n      );\n      this.ctx.fillStyle = color;\n      this.ctx.fill();\n    });\n\n    return this;\n  }\n\n  /**\n   * Draw a pair of leaves at the same height\n   * Reduces duplication in flowering plant renderers\n   */\n  drawLeafPair(\n    x: number,\n    y: number,\n    leftAngle: number,\n    rightAngle: number,\n    leftSize: number,\n    rightSize: number,\n    color: string,\n    offsetX: number = 3\n  ): this {\n    this.drawLeaf(x - offsetX, y, leftAngle, leftSize, color);\n    this.drawLeaf(x + offsetX, y, rightAngle, rightSize, color);\n    return this;\n  }\n\n  /**\n   * Draw leaves along a stem at specified positions\n   */\n  drawLeavesAlongStem(\n    baseX: number,\n    baseY: number,\n    plantHeight: number,\n    stemGrowth: number,\n    lean: number,\n    leafPositions: number[], // Array of t values (0-1) along stem\n    leafSize: number,\n    leafGrowth: number,\n    color: string\n  ): this {\n    for (let i = 0; i < leafPositions.length; i++) {\n      const t = leafPositions[i];\n      const leafY = baseY - plantHeight * t * stemGrowth;\n      const leafX = baseX + lean * plantHeight * t;\n      const side = i % 2 === 0 ? -1 : 1;\n      const angle = side * 0.6;\n      this.drawLeaf(leafX, leafY, angle, leafSize * leafGrowth, color);\n    }\n    return this;\n  }\n\n  /**\n   * Draw petals in a radial pattern\n   */\n  drawRadialPetals(\n    x: number,\n    y: number,\n    count: number,\n    radiusX: number,\n    radiusY: number,\n    offset: number,\n    color: string,\n    angleOffset: number = 0\n  ): this {\n    for (let i = 0; i < count; i++) {\n      const angle = (i / count) * GEOMETRY.TWO_PI + angleOffset;\n      this.withState(() => {\n        this.ctx.translate(x, y);\n        this.ctx.rotate(angle);\n        this.ctx.beginPath();\n        this.ctx.ellipse(offset, 0, radiusX, radiusY, 0, 0, GEOMETRY.TWO_PI);\n        this.ctx.fillStyle = color;\n        this.ctx.fill();\n      });\n    }\n    return this;\n  }\n\n  /**\n   * Draw a flower center (common pattern)\n   */\n  drawFlowerCenter(x: number, y: number, size: number, color: string): this {\n    return this.fillCircle(x, y, size, color);\n  }\n\n  // ==================== PATH HELPERS ====================\n\n  /**\n   * Begin a new path\n   */\n  beginPath(): this {\n    this.ctx.beginPath();\n    return this;\n  }\n\n  /**\n   * Move to a point\n   */\n  moveTo(x: number, y: number): this {\n    this.ctx.moveTo(x, y);\n    return this;\n  }\n\n  /**\n   * Line to a point\n   */\n  lineTo(x: number, y: number): this {\n    this.ctx.lineTo(x, y);\n    return this;\n  }\n\n  /**\n   * Quadratic curve to a point\n   */\n  quadraticCurveTo(cpx: number, cpy: number, x: number, y: number): this {\n    this.ctx.quadraticCurveTo(cpx, cpy, x, y);\n    return this;\n  }\n\n  /**\n   * Bezier curve to a point\n   */\n  bezierCurveTo(\n    cp1x: number, cp1y: number,\n    cp2x: number, cp2y: number,\n    x: number, y: number\n  ): this {\n    this.ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    return this;\n  }\n\n  /**\n   * Close current path\n   */\n  closePath(): this {\n    this.ctx.closePath();\n    return this;\n  }\n\n  /**\n   * Fill current path\n   */\n  fill(color?: string): this {\n    if (color) {\n      this.ctx.fillStyle = color;\n    }\n    this.ctx.fill();\n    return this;\n  }\n\n  /**\n   * Stroke current path\n   */\n  stroke(color?: string): this {\n    if (color) {\n      this.ctx.strokeStyle = color;\n    }\n    this.ctx.stroke();\n    return this;\n  }\n\n  // ==================== GRADIENT HELPERS ====================\n\n  /**\n   * Create a linear gradient\n   */\n  createLinearGradient(x0: number, y0: number, x1: number, y1: number): CanvasGradient {\n    return this.ctx.createLinearGradient(x0, y0, x1, y1);\n  }\n\n  /**\n   * Create a radial gradient\n   */\n  createRadialGradient(\n    x0: number, y0: number, r0: number,\n    x1: number, y1: number, r1: number\n  ): CanvasGradient {\n    return this.ctx.createRadialGradient(x0, y0, r0, x1, y1, r1);\n  }\n\n  // ==================== TEXT HELPERS ====================\n\n  /**\n   * Set font\n   */\n  setFont(font: string): this {\n    this.ctx.font = font;\n    return this;\n  }\n\n  /**\n   * Set text align\n   */\n  setTextAlign(align: CanvasTextAlign): this {\n    this.ctx.textAlign = align;\n    return this;\n  }\n\n  /**\n   * Fill text\n   */\n  fillText(text: string, x: number, y: number, color?: string): this {\n    if (color) {\n      this.ctx.fillStyle = color;\n    }\n    this.ctx.fillText(text, x, y);\n    return this;\n  }\n\n  /**\n   * Stroke text\n   */\n  strokeText(text: string, x: number, y: number, color?: string): this {\n    if (color) {\n      this.ctx.strokeStyle = color;\n    }\n    this.ctx.strokeText(text, x, y);\n    return this;\n  }\n\n  // ==================== CLEAR ====================\n\n  /**\n   * Clear the entire canvas\n   */\n  clear(color?: string): this {\n    if (color) {\n      this.ctx.fillStyle = color;\n      this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    } else {\n      this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    }\n    return this;\n  }\n\n  /**\n   * Clear a rectangle\n   */\n  clearRect(x: number, y: number, width: number, height: number): this {\n    this.ctx.clearRect(x, y, width, height);\n    return this;\n  }\n\n  // ==================== UTILITY ====================\n\n  /**\n   * Get the underlying context\n   */\n  getContext(): Ctx {\n    return this.ctx;\n  }\n\n  /**\n   * Get canvas dimensions\n   */\n  getDimensions(): { width: number; height: number } {\n    return {\n      width: this.ctx.canvas.width,\n      height: this.ctx.canvas.height,\n    };\n  }\n}\n\n// ==================== STANDALONE HELPER FUNCTIONS ====================\n\n/**\n * Draw a curved stem and return the end position\n * Standalone function for backward compatibility\n */\nexport function drawStem(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  height: number,\n  thickness: number,\n  color: string,\n  lean: number,\n  growth: number\n): { x: number; y: number } | null {\n  if (growth <= 0) return null;\n\n  const h = height * Math.min(1, growth);\n\n  ctx.beginPath();\n  ctx.moveTo(x, y);\n\n  const cp1x = x + lean * h * GEOMETRY.STEM_CP1_LEAN;\n  const cp1y = y - h * GEOMETRY.STEM_CP1_HEIGHT;\n  const cp2x = x + lean * h * GEOMETRY.STEM_CP2_LEAN;\n  const cp2y = y - h * GEOMETRY.STEM_CP2_HEIGHT;\n  const endX = x + lean * h;\n  const endY = y - h;\n\n  ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);\n  ctx.strokeStyle = color;\n  ctx.lineWidth = thickness;\n  ctx.lineCap = CANVAS_STYLE.LINE_CAP;\n  ctx.stroke();\n\n  return { x: endX, y: endY };\n}\n\n/**\n * Draw a leaf shape\n * Standalone function for backward compatibility\n */\nexport function drawLeaf(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  angle: number,\n  size: number,\n  color: string\n): void {\n  if (size < 1) return;\n\n  ctx.save();\n  ctx.translate(x, y);\n  ctx.rotate(angle);\n\n  ctx.beginPath();\n  ctx.moveTo(0, 0);\n  ctx.bezierCurveTo(size * 0.3, -size * 0.15, size * 0.7, -size * 0.15, size, 0);\n  ctx.bezierCurveTo(size * 0.7, size * 0.15, size * 0.3, size * 0.15, 0, 0);\n  ctx.fillStyle = color;\n  ctx.fill();\n\n  ctx.restore();\n}\n\n/**\n * Draw a pair of leaves\n * Standalone function for use in renderers\n */\nexport function drawLeafPair(\n  ctx: Ctx,\n  x: number,\n  y: number,\n  leftAngle: number,\n  rightAngle: number,\n  leftSize: number,\n  rightSize: number,\n  color: string,\n  offsetX: number = 3\n): void {\n  drawLeaf(ctx, x - offsetX, y, leftAngle, leftSize, color);\n  drawLeaf(ctx, x + offsetX, y, rightAngle, rightSize, color);\n}\n","/**\n * EventEmitter - Type-safe event emitter for Garden\n * Provides a pub/sub pattern for garden events\n */\n\nimport type { GardenEventType, GardenEventData, GardenEventHandler } from './types';\n\n/**\n * Type-safe event listener entry\n */\ninterface Listener<T> {\n  handler: GardenEventHandler<T>;\n  once: boolean;\n}\n\n/**\n * EventEmitter class - Type-safe event emitter\n *\n * Usage:\n * ```typescript\n * const emitter = new EventEmitter();\n *\n * // Subscribe to events\n * const unsubscribe = emitter.on('progress', ({ progress, elapsedTime }) => {\n *   console.log(`Progress: ${progress * 100}%`);\n * });\n *\n * // Emit events\n * emitter.emit('progress', { progress: 0.5, elapsedTime: 300 });\n *\n * // Unsubscribe\n * unsubscribe();\n *\n * // Or use once for single-fire events\n * emitter.once('complete', () => {\n *   console.log('Animation complete!');\n * });\n * ```\n */\nexport class EventEmitter {\n  private listeners: Map<GardenEventType, Set<Listener<unknown>>> = new Map();\n\n  /**\n   * Subscribe to an event\n   * @param event Event type to listen for\n   * @param handler Handler function\n   * @returns Unsubscribe function\n   */\n  on<K extends GardenEventType>(\n    event: K,\n    handler: GardenEventHandler<GardenEventData[K]>\n  ): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    const listener: Listener<GardenEventData[K]> = { handler, once: false };\n    this.listeners.get(event)!.add(listener as Listener<unknown>);\n\n    // Return unsubscribe function\n    return () => {\n      this.off(event, handler);\n    };\n  }\n\n  /**\n   * Subscribe to an event for one occurrence only\n   * @param event Event type to listen for\n   * @param handler Handler function\n   * @returns Unsubscribe function\n   */\n  once<K extends GardenEventType>(\n    event: K,\n    handler: GardenEventHandler<GardenEventData[K]>\n  ): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    const listener: Listener<GardenEventData[K]> = { handler, once: true };\n    this.listeners.get(event)!.add(listener as Listener<unknown>);\n\n    return () => {\n      this.off(event, handler);\n    };\n  }\n\n  /**\n   * Unsubscribe from an event\n   * @param event Event type\n   * @param handler Handler to remove\n   */\n  off<K extends GardenEventType>(\n    event: K,\n    handler: GardenEventHandler<GardenEventData[K]>\n  ): void {\n    const listeners = this.listeners.get(event);\n    if (!listeners) return;\n\n    for (const listener of listeners) {\n      if (listener.handler === handler) {\n        listeners.delete(listener);\n        break;\n      }\n    }\n\n    // Clean up empty sets\n    if (listeners.size === 0) {\n      this.listeners.delete(event);\n    }\n  }\n\n  /**\n   * Emit an event\n   * @param event Event type\n   * @param data Event data\n   */\n  emit<K extends GardenEventType>(event: K, data: GardenEventData[K]): void {\n    const listeners = this.listeners.get(event);\n    if (!listeners) return;\n\n    const toRemove: Listener<unknown>[] = [];\n\n    for (const listener of listeners) {\n      try {\n        (listener.handler as GardenEventHandler<GardenEventData[K]>)(data);\n      } catch (error) {\n        console.error(`Error in event handler for \"${event}\":`, error);\n      }\n\n      if (listener.once) {\n        toRemove.push(listener);\n      }\n    }\n\n    // Remove once listeners\n    for (const listener of toRemove) {\n      listeners.delete(listener);\n    }\n\n    if (listeners.size === 0) {\n      this.listeners.delete(event);\n    }\n  }\n\n  /**\n   * Check if there are any listeners for an event\n   */\n  hasListeners(event: GardenEventType): boolean {\n    const listeners = this.listeners.get(event);\n    return listeners !== undefined && listeners.size > 0;\n  }\n\n  /**\n   * Get the number of listeners for an event\n   */\n  listenerCount(event: GardenEventType): number {\n    const listeners = this.listeners.get(event);\n    return listeners ? listeners.size : 0;\n  }\n\n  /**\n   * Remove all listeners for a specific event or all events\n   */\n  removeAllListeners(event?: GardenEventType): void {\n    if (event) {\n      this.listeners.delete(event);\n    } else {\n      this.listeners.clear();\n    }\n  }\n\n  /**\n   * Get all registered event types\n   */\n  eventNames(): GardenEventType[] {\n    return Array.from(this.listeners.keys());\n  }\n}\n\n/**\n * Create a simple event emitter for basic use cases\n * Not tied to GardenEventType for general-purpose usage\n */\nexport class SimpleEventEmitter<EventMap extends Record<string, unknown>> {\n  private listeners: Map<keyof EventMap, Set<Listener<unknown>>> = new Map();\n\n  on<K extends keyof EventMap>(\n    event: K,\n    handler: (data: EventMap[K]) => void\n  ): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    const listener: Listener<EventMap[K]> = {\n      handler: handler as GardenEventHandler<unknown>,\n      once: false,\n    };\n    this.listeners.get(event)!.add(listener as Listener<unknown>);\n\n    return () => this.off(event, handler);\n  }\n\n  once<K extends keyof EventMap>(\n    event: K,\n    handler: (data: EventMap[K]) => void\n  ): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n\n    const listener: Listener<EventMap[K]> = {\n      handler: handler as GardenEventHandler<unknown>,\n      once: true,\n    };\n    this.listeners.get(event)!.add(listener as Listener<unknown>);\n\n    return () => this.off(event, handler);\n  }\n\n  off<K extends keyof EventMap>(\n    event: K,\n    handler: (data: EventMap[K]) => void\n  ): void {\n    const listeners = this.listeners.get(event);\n    if (!listeners) return;\n\n    for (const listener of listeners) {\n      if (listener.handler === handler) {\n        listeners.delete(listener);\n        break;\n      }\n    }\n\n    if (listeners.size === 0) {\n      this.listeners.delete(event);\n    }\n  }\n\n  emit<K extends keyof EventMap>(event: K, data: EventMap[K]): void {\n    const listeners = this.listeners.get(event);\n    if (!listeners) return;\n\n    const toRemove: Listener<unknown>[] = [];\n\n    for (const listener of listeners) {\n      try {\n        listener.handler(data);\n      } catch (error) {\n        console.error(`Error in event handler for \"${String(event)}\":`, error);\n      }\n\n      if (listener.once) {\n        toRemove.push(listener);\n      }\n    }\n\n    for (const listener of toRemove) {\n      listeners.delete(listener);\n    }\n\n    if (listeners.size === 0) {\n      this.listeners.delete(event);\n    }\n  }\n\n  removeAllListeners(event?: keyof EventMap): void {\n    if (event) {\n      this.listeners.delete(event);\n    } else {\n      this.listeners.clear();\n    }\n  }\n}\n","/**\n * Environment Detection - Centralized browser capability checks\n * Detects device capabilities and user preferences\n */\n\n/**\n * Environment capabilities\n */\nexport interface EnvironmentCapabilities {\n  /** Whether we're in a browser environment */\n  isBrowser: boolean;\n  /** Whether Canvas 2D is supported */\n  hasCanvas: boolean;\n  /** Whether ResizeObserver is available */\n  hasResizeObserver: boolean;\n  /** Whether requestAnimationFrame is available */\n  hasRAF: boolean;\n  /** Whether high DPI screens are detected */\n  isHighDPI: boolean;\n  /** Device pixel ratio */\n  pixelRatio: number;\n  /** Whether touch is supported */\n  hasTouch: boolean;\n  /** Whether the device is likely mobile */\n  isMobile: boolean;\n  /** Whether reduced motion is preferred */\n  prefersReducedMotion: boolean;\n  /** Whether dark mode is preferred */\n  prefersDarkMode: boolean;\n  /** Whether the page is currently visible */\n  isPageVisible: boolean;\n}\n\n/**\n * Environment class - Centralized capability detection\n *\n * Usage:\n * ```typescript\n * const env = Environment.detect();\n *\n * if (env.prefersReducedMotion) {\n *   // Skip animation\n * }\n *\n * const dpr = env.getClampedPixelRatio(2);\n *\n * // Listen for visibility changes\n * const cleanup = Environment.onVisibilityChange((visible) => {\n *   if (visible) garden.play();\n *   else garden.pause();\n * });\n * ```\n */\nexport class Environment {\n  private static _cached: EnvironmentCapabilities | null = null;\n  private static _visibilityListeners: Set<(visible: boolean) => void> = new Set();\n  private static _visibilityHandler: (() => void) | null = null;\n\n  // ==================== DETECTION ====================\n\n  /**\n   * Detect current environment capabilities\n   * Results are cached for performance\n   */\n  static detect(): EnvironmentCapabilities {\n    if (this._cached) {\n      return this._cached;\n    }\n\n    const isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\n\n    if (!isBrowser) {\n      this._cached = {\n        isBrowser: false,\n        hasCanvas: false,\n        hasResizeObserver: false,\n        hasRAF: false,\n        isHighDPI: false,\n        pixelRatio: 1,\n        hasTouch: false,\n        isMobile: false,\n        prefersReducedMotion: false,\n        prefersDarkMode: false,\n        isPageVisible: true,\n      };\n      return this._cached;\n    }\n\n    const pixelRatio = window.devicePixelRatio || 1;\n\n    this._cached = {\n      isBrowser: true,\n      hasCanvas: this.checkCanvasSupport(),\n      hasResizeObserver: typeof ResizeObserver !== 'undefined',\n      hasRAF: typeof requestAnimationFrame !== 'undefined',\n      isHighDPI: pixelRatio > 1,\n      pixelRatio,\n      hasTouch: this.checkTouchSupport(),\n      isMobile: this.checkMobile(),\n      prefersReducedMotion: this.checkReducedMotion(),\n      prefersDarkMode: this.checkDarkMode(),\n      isPageVisible: this.checkPageVisibility(),\n    };\n\n    return this._cached;\n  }\n\n  /**\n   * Clear cached detection (useful for testing)\n   */\n  static clearCache(): void {\n    this._cached = null;\n  }\n\n  // ==================== INDIVIDUAL CHECKS ====================\n\n  /**\n   * Check if Canvas 2D is supported\n   */\n  private static checkCanvasSupport(): boolean {\n    try {\n      const canvas = document.createElement('canvas');\n      return !!(canvas.getContext && canvas.getContext('2d'));\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Check if touch is supported\n   */\n  private static checkTouchSupport(): boolean {\n    return 'ontouchstart' in window ||\n      navigator.maxTouchPoints > 0 ||\n      // @ts-expect-error - msMaxTouchPoints is IE-specific\n      (navigator.msMaxTouchPoints || 0) > 0;\n  }\n\n  /**\n   * Check if device is likely mobile\n   */\n  private static checkMobile(): boolean {\n    // Check user agent\n    const ua = navigator.userAgent.toLowerCase();\n    const mobileKeywords = ['android', 'webos', 'iphone', 'ipad', 'ipod', 'blackberry', 'windows phone'];\n    const isMobileUA = mobileKeywords.some(keyword => ua.includes(keyword));\n\n    // Check screen size\n    const isSmallScreen = window.innerWidth <= 768;\n\n    // Check touch capability\n    const hasTouch = this.checkTouchSupport();\n\n    return isMobileUA || (hasTouch && isSmallScreen);\n  }\n\n  /**\n   * Check if user prefers reduced motion\n   */\n  private static checkReducedMotion(): boolean {\n    if (typeof window === 'undefined') return false;\n    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n  }\n\n  /**\n   * Check if user prefers dark mode\n   */\n  private static checkDarkMode(): boolean {\n    if (typeof window === 'undefined') return false;\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\n  }\n\n  /**\n   * Check if page is currently visible\n   */\n  private static checkPageVisibility(): boolean {\n    if (typeof document === 'undefined') return true;\n    return !document.hidden;\n  }\n\n  // ==================== PUBLIC UTILITY METHODS ====================\n\n  /**\n   * Check if reduced motion is preferred\n   */\n  static prefersReducedMotion(): boolean {\n    return this.detect().prefersReducedMotion;\n  }\n\n  /**\n   * Check if dark mode is preferred\n   */\n  static prefersDarkMode(): boolean {\n    return this.detect().prefersDarkMode;\n  }\n\n  /**\n   * Get device pixel ratio, clamped to a maximum\n   */\n  static getPixelRatio(max: number = 2): number {\n    const env = this.detect();\n    return Math.min(env.pixelRatio, max);\n  }\n\n  /**\n   * Check if page is visible\n   */\n  static isPageVisible(): boolean {\n    if (typeof document === 'undefined') return true;\n    return !document.hidden;\n  }\n\n  /**\n   * Check if the environment supports all required features\n   */\n  static isSupported(): boolean {\n    const env = this.detect();\n    return env.isBrowser && env.hasCanvas && env.hasRAF;\n  }\n\n  /**\n   * Get recommended settings based on device capabilities\n   */\n  static getRecommendedSettings(): {\n    maxPixelRatio: number;\n    targetFPS: number;\n    density: 'sparse' | 'normal' | 'dense';\n  } {\n    const env = this.detect();\n\n    // Low-end mobile device\n    if (env.isMobile && env.pixelRatio > 2) {\n      return {\n        maxPixelRatio: 1.5,\n        targetFPS: 24,\n        density: 'sparse',\n      };\n    }\n\n    // Standard mobile\n    if (env.isMobile) {\n      return {\n        maxPixelRatio: 2,\n        targetFPS: 30,\n        density: 'normal',\n      };\n    }\n\n    // High DPI desktop\n    if (env.isHighDPI) {\n      return {\n        maxPixelRatio: 2,\n        targetFPS: 30,\n        density: 'normal',\n      };\n    }\n\n    // Standard desktop\n    return {\n      maxPixelRatio: 1,\n      targetFPS: 30,\n      density: 'dense',\n    };\n  }\n\n  // ==================== EVENT LISTENERS ====================\n\n  /**\n   * Listen for page visibility changes\n   * @returns Cleanup function\n   */\n  static onVisibilityChange(callback: (visible: boolean) => void): () => void {\n    if (typeof document === 'undefined') {\n      return () => {};\n    }\n\n    this._visibilityListeners.add(callback);\n\n    // Set up handler if not already done\n    if (!this._visibilityHandler) {\n      this._visibilityHandler = () => {\n        const visible = !document.hidden;\n        for (const listener of this._visibilityListeners) {\n          try {\n            listener(visible);\n          } catch (error) {\n            console.error('Error in visibility change handler:', error);\n          }\n        }\n      };\n      document.addEventListener('visibilitychange', this._visibilityHandler);\n    }\n\n    // Return cleanup function\n    return () => {\n      this._visibilityListeners.delete(callback);\n\n      // Clean up handler if no more listeners\n      if (this._visibilityListeners.size === 0 && this._visibilityHandler) {\n        document.removeEventListener('visibilitychange', this._visibilityHandler);\n        this._visibilityHandler = null;\n      }\n    };\n  }\n\n  /**\n   * Listen for reduced motion preference changes\n   * @returns Cleanup function\n   */\n  static onReducedMotionChange(callback: (prefersReduced: boolean) => void): () => void {\n    if (typeof window === 'undefined') {\n      return () => {};\n    }\n\n    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n\n    const handler = (e: MediaQueryListEvent) => {\n      // Invalidate cache\n      this._cached = null;\n      callback(e.matches);\n    };\n\n    // Modern browsers\n    if (mediaQuery.addEventListener) {\n      mediaQuery.addEventListener('change', handler);\n      return () => mediaQuery.removeEventListener('change', handler);\n    }\n\n    // Legacy browsers - addListener/removeListener are deprecated but needed for older browsers\n    mediaQuery.addListener(handler);\n    return () => mediaQuery.removeListener(handler);\n  }\n\n  /**\n   * Listen for dark mode preference changes\n   * @returns Cleanup function\n   */\n  static onDarkModeChange(callback: (prefersDark: boolean) => void): () => void {\n    if (typeof window === 'undefined') {\n      return () => {};\n    }\n\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n    const handler = (e: MediaQueryListEvent) => {\n      // Invalidate cache\n      this._cached = null;\n      callback(e.matches);\n    };\n\n    if (mediaQuery.addEventListener) {\n      mediaQuery.addEventListener('change', handler);\n      return () => mediaQuery.removeEventListener('change', handler);\n    }\n\n    // Legacy browsers - addListener/removeListener are deprecated but needed for older browsers\n    mediaQuery.addListener(handler);\n    return () => mediaQuery.removeListener(handler);\n  }\n\n  /**\n   * Listen for window resize\n   * @returns Cleanup function\n   */\n  static onResize(callback: (width: number, height: number) => void): () => void {\n    if (typeof window === 'undefined') {\n      return () => {};\n    }\n\n    const handler = () => {\n      callback(window.innerWidth, window.innerHeight);\n    };\n\n    window.addEventListener('resize', handler);\n    return () => window.removeEventListener('resize', handler);\n  }\n}\n\n// ==================== STANDALONE FUNCTIONS FOR BACKWARD COMPATIBILITY ====================\n\n/**\n * Check if prefers-reduced-motion is enabled\n * Backward compatible with existing utils.ts function\n */\nexport function prefersReducedMotion(): boolean {\n  return Environment.prefersReducedMotion();\n}\n\n/**\n * Get device pixel ratio, clamped to max\n * Backward compatible with existing utils.ts function\n */\nexport function getPixelRatio(max: number): number {\n  return Environment.getPixelRatio(max);\n}\n\n/**\n * Check if running in a browser environment\n */\nexport function isBrowser(): boolean {\n  return Environment.detect().isBrowser;\n}\n\n/**\n * Check if Canvas 2D is supported\n */\nexport function hasCanvasSupport(): boolean {\n  return Environment.detect().hasCanvas;\n}\n","/**\n * Presets and Themes - Pre-configured garden setups\n * Provides ready-to-use configurations for common use cases\n */\n\nimport type { GardenOptions, GardenPreset, GardenTheme, ColorOptions, Density } from './types';\nimport { COLORS } from './constants';\n\n// ==================== THEMES ====================\n\n/**\n * Built-in themes for garden visual styling\n */\nexport const themes: Record<string, GardenTheme> = {\n  /**\n   * Natural garden with balanced, realistic colors\n   */\n  natural: {\n    name: 'Natural',\n    palette: 'natural',\n    accent: COLORS.DEFAULT_ACCENT,\n  },\n\n  /**\n   * Warm sunset garden with oranges, reds, and yellows\n   */\n  sunset: {\n    name: 'Sunset',\n    palette: 'warm',\n    accent: '#FF6B35',\n    fadeColor: '#FFF5EB',\n  },\n\n  /**\n   * Cool ocean-inspired garden with blues and greens\n   */\n  ocean: {\n    name: 'Ocean',\n    palette: 'cool',\n    accent: '#0077B6',\n    fadeColor: '#F0F8FF',\n  },\n\n  /**\n   * Elegant monochrome garden\n   */\n  monochrome: {\n    name: 'Monochrome',\n    palette: 'monochrome',\n    accent: '#666666',\n    fadeColor: '#F5F5F5',\n  },\n\n  /**\n   * Vibrant, high-saturation garden\n   */\n  vibrant: {\n    name: 'Vibrant',\n    palette: 'vibrant',\n    accent: '#FF1493',\n  },\n\n  /**\n   * Cherry blossom inspired pink garden\n   */\n  sakura: {\n    name: 'Sakura',\n    palette: 'natural',\n    accent: '#FFB7C5',\n    flowerColors: ['#FFB7C5', '#FFDCE5', '#FFC0CB', '#FF69B4', '#FFFFFF'],\n    fadeColor: '#FFF5F7',\n  },\n\n  /**\n   * Lavender field inspired garden\n   */\n  lavender: {\n    name: 'Lavender',\n    palette: 'cool',\n    accent: '#9370DB',\n    flowerColors: ['#9370DB', '#E6E6FA', '#DDA0DD', '#BA55D3', '#8B008B'],\n    foliageColors: ['#556B2F', '#6B8E23', '#808000'],\n    fadeColor: '#F5F0FF',\n  },\n\n  /**\n   * Autumn-inspired garden with warm earth tones\n   */\n  autumn: {\n    name: 'Autumn',\n    palette: 'warm',\n    accent: '#D2691E',\n    flowerColors: ['#D2691E', '#CD853F', '#DAA520', '#B8860B', '#8B4513', '#FF8C00'],\n    foliageColors: ['#8B4513', '#A0522D', '#CD853F', '#D2691E'],\n    fadeColor: '#FFF8DC',\n  },\n\n  /**\n   * Night garden with deep, cool colors\n   */\n  midnight: {\n    name: 'Midnight',\n    palette: 'cool',\n    accent: '#4169E1',\n    flowerColors: ['#4169E1', '#6A5ACD', '#9932CC', '#8A2BE2', '#483D8B'],\n    foliageColors: ['#2F4F4F', '#006400', '#228B22'],\n    fadeColor: '#1A1A2E',\n  },\n\n  /**\n   * Tropical paradise garden\n   */\n  tropical: {\n    name: 'Tropical',\n    palette: 'vibrant',\n    accent: '#FF4500',\n    flowerColors: ['#FF4500', '#FF6347', '#FFD700', '#00CED1', '#FF1493', '#32CD32'],\n    foliageColors: ['#006400', '#228B22', '#32CD32'],\n  },\n\n  /**\n   * Minimalist zen garden\n   */\n  zen: {\n    name: 'Zen',\n    palette: 'monochrome',\n    accent: '#8B8B83',\n    flowerColors: ['#FFFFFF', '#F5F5F5', '#E8E8E8', '#98FB98'],\n    foliageColors: ['#556B2F', '#6B8E23'],\n    fadeColor: '#FAFAFA',\n  },\n};\n\n// ==================== PRESETS ====================\n\n/**\n * Built-in presets for common garden configurations\n */\nexport const presets: Record<string, GardenPreset> = {\n  /**\n   * Default balanced garden\n   */\n  default: {\n    name: 'Default',\n    description: 'Balanced garden with moderate density and natural colors',\n    options: {\n      duration: 600,\n      generations: 47,\n      density: 'normal',\n      maxHeight: 0.35,\n    },\n  },\n\n  /**\n   * Quick demo garden (faster animation)\n   */\n  demo: {\n    name: 'Demo',\n    description: 'Fast 30-second animation for demonstrations',\n    options: {\n      duration: 30,\n      generations: 10,\n      density: 'normal',\n      maxHeight: 0.35,\n      speed: 1,\n    },\n  },\n\n  /**\n   * Subtle background garden\n   */\n  subtle: {\n    name: 'Subtle',\n    description: 'Sparse, low-opacity garden for website backgrounds',\n    options: {\n      duration: 900,\n      generations: 30,\n      density: 'sparse',\n      maxHeight: 0.25,\n      opacity: 0.6,\n      fadeHeight: 0.15,\n    },\n  },\n\n  /**\n   * Lush full garden\n   */\n  lush: {\n    name: 'Lush',\n    description: 'Dense, vibrant garden with maximum plant coverage',\n    options: {\n      duration: 600,\n      generations: 60,\n      density: 'lush',\n      maxHeight: 0.45,\n    },\n  },\n\n  /**\n   * Forest garden with tall plants\n   */\n  forest: {\n    name: 'Forest',\n    description: 'Tall garden with trees, climbers, and tall flowers',\n    options: {\n      duration: 900,\n      generations: 50,\n      density: 'dense',\n      maxHeight: 0.8,\n      categories: ['small-tree', 'conifer', 'climber', 'giant-grass', 'fern', 'bush'],\n    },\n  },\n\n  /**\n   * Meadow garden (only ground flowers)\n   */\n  meadow: {\n    name: 'Meadow',\n    description: 'Low wildflower meadow with grasses',\n    options: {\n      duration: 600,\n      generations: 50,\n      density: 'dense',\n      maxHeight: 0.25,\n      categories: ['wildflower', 'daisy', 'grass', 'simple-flower'],\n    },\n  },\n\n  /**\n   * Rose garden\n   */\n  roseGarden: {\n    name: 'Rose Garden',\n    description: 'Elegant garden focused on roses',\n    options: {\n      duration: 600,\n      generations: 40,\n      density: 'normal',\n      maxHeight: 0.35,\n      categories: ['rose', 'bush', 'fern'],\n    },\n  },\n\n  /**\n   * Tropical paradise\n   */\n  tropical: {\n    name: 'Tropical',\n    description: 'Lush tropical garden with palms and exotic flowers',\n    options: {\n      duration: 600,\n      generations: 40,\n      density: 'dense',\n      maxHeight: 0.7,\n      categories: ['tropical', 'orchid', 'lily', 'bird-of-paradise', 'fern'],\n    },\n  },\n\n  /**\n   * Herb garden\n   */\n  herbs: {\n    name: 'Herb Garden',\n    description: 'Fragrant herb garden with lavender and sage',\n    options: {\n      duration: 600,\n      generations: 35,\n      density: 'normal',\n      maxHeight: 0.25,\n      categories: ['herb', 'bush', 'grass'],\n    },\n  },\n\n  /**\n   * Succulent garden\n   */\n  succulent: {\n    name: 'Succulent Garden',\n    description: 'Low-maintenance succulent arrangement',\n    options: {\n      duration: 300,\n      generations: 25,\n      density: 'dense',\n      maxHeight: 0.15,\n      categories: ['succulent'],\n    },\n  },\n\n  /**\n   * Long ambient animation\n   */\n  ambient: {\n    name: 'Ambient',\n    description: 'Very slow, continuous background animation',\n    options: {\n      duration: 3600, // 1 hour\n      generations: 100,\n      density: 'sparse',\n      maxHeight: 0.3,\n      loop: true,\n      opacity: 0.5,\n      fadeHeight: 0.1,\n    },\n  },\n\n  /**\n   * Performance-optimized preset\n   */\n  performance: {\n    name: 'Performance',\n    description: 'Optimized for lower-end devices',\n    options: {\n      duration: 600,\n      generations: 30,\n      density: 'sparse',\n      maxHeight: 0.3,\n      targetFPS: 24,\n      maxPixelRatio: 1,\n    },\n  },\n};\n\n// ==================== HELPER FUNCTIONS ====================\n\n/**\n * Apply a theme to garden options\n * @param theme Theme name or GardenTheme object\n * @param options Base options to merge with\n */\nexport function applyTheme(\n  theme: string | GardenTheme,\n  options: Partial<GardenOptions> = {}\n): Partial<GardenOptions> {\n  const themeConfig = typeof theme === 'string' ? themes[theme] : theme;\n\n  if (!themeConfig) {\n    console.warn(`Theme \"${theme}\" not found, using natural`);\n    return options;\n  }\n\n  const colors: ColorOptions = {\n    palette: themeConfig.palette,\n    accent: themeConfig.accent,\n    flowerColors: themeConfig.flowerColors,\n    foliageColors: themeConfig.foliageColors,\n    ...options.colors,\n  };\n\n  return {\n    ...options,\n    colors,\n    fadeColor: themeConfig.fadeColor ?? options.fadeColor,\n  };\n}\n\n/**\n * Apply a preset to garden options\n * @param preset Preset name or GardenPreset object\n * @param options Additional options to merge\n */\nexport function applyPreset(\n  preset: string | GardenPreset,\n  options: Partial<GardenOptions> = {}\n): Partial<GardenOptions> {\n  const presetConfig = typeof preset === 'string' ? presets[preset] : preset;\n\n  if (!presetConfig) {\n    console.warn(`Preset \"${preset}\" not found, using default`);\n    return options;\n  }\n\n  return {\n    ...presetConfig.options,\n    ...options,\n  };\n}\n\n/**\n * Combine a preset and theme\n * @param presetName Preset to apply\n * @param themeName Theme to apply\n * @param options Additional options\n */\nexport function createConfig(\n  presetName: string,\n  themeName: string = 'natural',\n  options: Partial<GardenOptions> = {}\n): Partial<GardenOptions> {\n  const presetOptions = applyPreset(presetName, {});\n  const themedOptions = applyTheme(themeName, presetOptions);\n  return {\n    ...themedOptions,\n    ...options,\n  };\n}\n\n/**\n * Get list of available theme names\n */\nexport function getThemeNames(): string[] {\n  return Object.keys(themes);\n}\n\n/**\n * Get list of available preset names\n */\nexport function getPresetNames(): string[] {\n  return Object.keys(presets);\n}\n\n/**\n * Create a custom theme\n */\nexport function createTheme(\n  name: string,\n  config: Omit<GardenTheme, 'name'>\n): GardenTheme {\n  return { name, ...config };\n}\n\n/**\n * Create a custom preset\n */\nexport function createPreset(\n  name: string,\n  options: Partial<GardenOptions>,\n  description?: string\n): GardenPreset {\n  return { name, options, description };\n}\n\n/**\n * Preset for specific density levels\n */\nexport function densityPreset(density: Density): Partial<GardenOptions> {\n  const configs: Record<Density, Partial<GardenOptions>> = {\n    sparse: { density: 'sparse', generations: 30 },\n    normal: { density: 'normal', generations: 47 },\n    dense: { density: 'dense', generations: 55 },\n    lush: { density: 'lush', generations: 65 },\n  };\n  return configs[density];\n}\n\n/**\n * Speed presets for different animation tempos\n */\nexport function speedPreset(speed: 'slow' | 'normal' | 'fast' | 'instant'): Partial<GardenOptions> {\n  const configs: Record<string, Partial<GardenOptions>> = {\n    slow: { speed: 0.5, duration: 1200 },\n    normal: { speed: 1, duration: 600 },\n    fast: { speed: 2, duration: 300 },\n    instant: { speed: 10, duration: 60 },\n  };\n  return configs[speed];\n}\n"],"mappings":"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","names":["index_exports","__export","ANIMATION","CANVAS_STYLE","COLORS","COMPLEXITY","CanvasHelper","Color","Environment","EventEmitter","GEOMETRY","GROWTH_PHASES","Garten","GrowthProgress","LAYOUT","MutableVec2","OPTION_BOUNDS","PETAL_COUNTS","PLANTS_PER_GENERATION","PLANT_CATEGORIES","PLANT_SIZES","PlantCategory","PlantType","SeededRandom","SimpleEventEmitter","VARIATION_DEFAULTS","Vec2","applyPreset","applyTheme","calculateGrowthPhases","calculateRawProgress","createConfig","createPreset","createRandom","createTheme","darkenColor","densityPreset","drawLeaf","drawLeafPair","drawStem","flowerPalettes","foliagePalettes","getPixelRatio","getPlantCategory","getPlantVariation","getPresetNames","getThemeNames","hasCanvasSupport","hexToRgb","isBrowser","isPlantActive","lightenColor","prefersReducedMotion","presets","rgbToHex","seededRandom","speedPreset","themes","defaultColorOptions","defaultEvents","defaultOptions","numericBounds","clampOption","value","key","min","max","plantsPerGeneration","isValidSelector","selector","resolveOptions","options","container","el","colors","events","PlantCategory","PlantType","seededRandom","seed","x","createRandom","initialSeed","hexToRgb","hex","result","rgbToHex","r","g","b","x","lightenColor","amount","rgb","darkenColor","randomRange","min","max","rand","prefersReducedMotion","getPixelRatio","debounce","fn","delay","timeoutId","debounced","args","getTimingExponent","curve","applyTimingCurve","generation","totalGenerations","normalizedGen","t","exponent","flowerPalettes","foliagePalettes","generateAccentVariants","accent","lightenColor","darkenColor","buildFlowerColors","options","baseColors","accentVariants","totalColors","accentCount","baseCount","result","i","buildFoliageColors","c","PLANT_SIZES","GROWTH_PHASES","COLORS","ANIMATION","LAYOUT","PETAL_COUNTS","VARIATION_DEFAULTS","COMPLEXITY","CANVAS_STYLE","GEOMETRY","OPTION_BOUNDS","PLANTS_PER_GENERATION","defaultVariation","VARIATION_DEFAULTS","variationOverrides","getPlantVariation","type","overrides","categoryNameToEnum","PLANT_CATEGORIES","parseCategoryFilter","categories","result","name","category","categoryWeights","plantTypesByCategory","categoryHeightRanges","plantTypeToCategory","types","type","tallCategories","selectCategory","rand","maxHeight","categoryFilter","availableCategories","minH","tallBoostFactor","totalWeight","adjustedWeights","weight","adjustedWeight","roll","cumulative","selectPlantType","getHeightRange","min","max","generatePlantHeight","maxH","range","biasFactor","biasedRand","generatePlants","options","duration","generations","density","seed","colors","timingCurve","minPlantsPerGen","maxPlantsPerGen","plantsPerGeneration","flowerColors","buildFlowerColors","foliageColors","buildFoliageColors","avgPlantsPerGen","estimatedTotal","plants","plantId","actualCount","gen","warpedStart","applyTimingCurve","warpedEnd","genDelay","genDuration","genRand","createRandom","plantsInGen","randomRange","p","plantRand","x","plantHeight","flowerColorIdx","leafColorIdx","stemColorIdx","delay","growDuration","petals","lean","scale","variation","getPlantVariation","a","b","didGenerationComplete","prevTime","currentTime","duration","generations","timePerGen","prevGen","currentGen","getPlantCategory","type","plantTypeToCategory","calculateGrowthPhases","time","delay","growDuration","progress","createFloweringContext","plant","width","height","variation","phases","drawStem","ctx","x","y","thickness","color","lean","growth","h","cp1x","cp1y","cp2x","cp2y","endX","endY","drawLeaf","angle","size","drawSimpleFlower","petals","s","p","i","drawTulip","drawDaisy","petalCount","drawWildflower","count","dist","fx","fy","drawGrass","seed","blades","seededRandom","rand","bladeH","plumeGrowth","plumeX","plumeY","drawFern","frondCount","t","side","frondLen","curlFactor","drawBush","leafColor","flowerColor","leafCount","lx","ly","flowerThreshold","flowerGrowth","flowerCount","drawRose","petalLayers","layer","layerSize","petalsInLayer","angleOffset","drawLily","drawOrchid","drawSucculent","layers","leavesPerLayer","drawLavender","spikeHeight","spikeY","spikeX","buds","by","bx","drawPoppy","drawSunflower","drawIris","drawPeony","drawHydrangea","floretCount","rand1","rand2","pa","drawDahlia","categoryRenderers","rc","baseY","plantHeight","top","leafY","leafX","stemGrowth","numLeaves","numFlowers","flowerY","flowerX","flowerSize","numCulms","createRandom","c","offsetX","culmHeight","culmLean","segments","segmentHeight","currentY","currentX","nextY","nextX","leafGrowth","l","prevX","prevY","targetY","wave","targetX","leafSize","f","trunkGrowth","foliageGrowth","trunkHeight","trunkWidth","foliageY","foliageRadius","clusters","cx","cy","clusterSize","frondGrowth","numFronds","crownY","crownX","frondLength","droop","cpX","cpY","leaflets","leafletSize","baseWidth","layerY","layerWidth","layerHeight","drawPlant","category","getPlantCategory","getPlantVariation","renderer","Renderer","options","ctx","debounce","getPixelRatio","rect","fadeHeight","fadeColor","maxHeight","rgb","hexToRgb","plantTopY","fadeStartY","fadeEndY","gradient","plants","time","plant","drawPlant","progress","staticTime","Garten","options","timestamp","previousElapsed","completedGen","didGenerationComplete","progress","resolveOptions","prefersReducedMotion","Renderer","generatePlants","time","clampedTime","currentGen","speed","wasPlaying","newOptions","needsRegeneration","_Color","r","g","b","a","hex","cleaned","rgb","alpha","h","s","l","sNorm","lNorm","c","x","m","str","rgbMatch","hslMatch","includeAlpha","forceAlpha","max","min","d","amount","other","t","hsl","degrees","rsRGB","gsRGB","bsRGB","l1","l2","lighter","darker","tolerance","Color","hexToRgb","color","rgbToHex","lightenColor","darkenColor","_Vec2","x","y","point","arr","angle","length","a","b","t","dx","dy","other","scalar","len","maxLength","cos","sin","normal","d","lenSq","target","maxDistance","distSq","dist","minX","minY","maxX","maxY","epsilon","Vec2","MutableVec2","_GrowthProgress","progress","config","GROWTH_PHASES","time","delay","duration","fullConfig","min","max","start","end","easing","t","value","other","epsilon","GrowthProgress","calculateGrowthPhases","growDuration","isPlantActive","calculateRawProgress","SeededRandom","_SeededRandom","seed","x","rng","min","max","range","center","probability","array","count","result","indices","idx","items","totalWeight","sum","item","roll","j","copy","mean","stdDev","u1","u2","lambda","exponent","v","angle","radius","width","height","state","n","str","hash","i","char","_stemResult","CanvasHelper","ctx","fn","x","y","angle","color","width","cap","alpha","operation","height","radius","GEOMETRY","radiusX","radiusY","rotation","x1","y1","x2","y2","thickness","lean","growth","result","cp1x","cp1y","cp2x","cp2y","endX","endY","CANVAS_STYLE","size","leftAngle","rightAngle","leftSize","rightSize","offsetX","baseX","baseY","plantHeight","stemGrowth","leafPositions","leafSize","leafGrowth","i","t","leafY","leafX","count","offset","angleOffset","cpx","cpy","x0","y0","r0","r1","font","align","text","drawStem","h","drawLeaf","drawLeafPair","EventEmitter","event","handler","listener","listeners","data","toRemove","error","SimpleEventEmitter","Environment","pixelRatio","canvas","ua","isMobileUA","keyword","isSmallScreen","hasTouch","max","env","callback","visible","listener","error","mediaQuery","handler","e","prefersReducedMotion","getPixelRatio","isBrowser","hasCanvasSupport","themes","COLORS","presets","applyTheme","theme","options","themeConfig","colors","applyPreset","preset","presetConfig","createConfig","presetName","themeName","presetOptions","getThemeNames","getPresetNames","createTheme","name","config","createPreset","description","densityPreset","density","speedPreset","speed"]}